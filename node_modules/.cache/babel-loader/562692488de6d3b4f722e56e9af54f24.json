{"ast":null,"code":"import{BotCommandConfigurationEvent,BotRemoveComposer,BotSkillSaveComposer,RequestBotCommandConfigurationComposer,RoomObjectCategory,RoomObjectType}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{GetConfiguration,GetNitroInstance,LocalizeText,RoomWidgetUpdateRentableBotChatEvent,SendMessageComposer}from'../../../../api';import{Button,Column,Flex,Text}from'../../../../common';import{UseMessageEventHook}from'../../../../hooks';import{useRoomContext}from'../../RoomContext';import{ContextMenuHeaderView}from'../context-menu/ContextMenuHeaderView';import{ContextMenuListItemView}from'../context-menu/ContextMenuListItemView';import{ContextMenuView}from'../context-menu/ContextMenuView';import{BotSkillsEnum}from'./common/BotSkillsEnum';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const MODE_NORMAL=0;const MODE_CHANGE_NAME=1;const MODE_CHANGE_MOTTO=2;export const AvatarInfoWidgetRentableBotView=props=>{const{rentableBotData=null,close=null}=props;const[mode,setMode]=useState(MODE_NORMAL);const[newName,setNewName]=useState('');const[newMotto,setNewMotto]=useState('');const{eventDispatcher=null}=useRoomContext();const onBotCommandConfigurationEvent=useCallback(event=>{const parser=event.getParser();if(parser.botId!==rentableBotData.webID)return;switch(parser.commandId){case BotSkillsEnum.CHANGE_BOT_NAME:setNewName(parser.data);setMode(MODE_CHANGE_NAME);return;case BotSkillsEnum.CHANGE_BOT_MOTTO:setNewMotto(parser.data);setMode(MODE_CHANGE_MOTTO);return;case BotSkillsEnum.SETUP_CHAT:{const data=parser.data;const pieces=data.split(data.indexOf(';#;')===-1?';':';#;');if(pieces.length===3||pieces.length===4){eventDispatcher.dispatchEvent(new RoomWidgetUpdateRentableBotChatEvent(rentableBotData.roomIndex,RoomObjectCategory.UNIT,rentableBotData.webID,pieces[0],pieces[1].toLowerCase()==='true'||pieces[1]==='1',parseInt(pieces[2]),pieces[3]?pieces[3].toLowerCase()==='true'||pieces[3]==='1':false));close();}return;}}},[rentableBotData,eventDispatcher,close]);UseMessageEventHook(BotCommandConfigurationEvent,onBotCommandConfigurationEvent);const requestBotCommandConfiguration=skillType=>SendMessageComposer(new RequestBotCommandConfigurationComposer(rentableBotData.webID,skillType));const processAction=name=>{let hideMenu=true;if(name){switch(name){case'donate_to_all':requestBotCommandConfiguration(BotSkillsEnum.DONATE_TO_ALL);SendMessageComposer(new BotSkillSaveComposer(rentableBotData.webID,BotSkillsEnum.DONATE_TO_ALL,''));break;case'donate_to_user':requestBotCommandConfiguration(BotSkillsEnum.DONATE_TO_USER);SendMessageComposer(new BotSkillSaveComposer(rentableBotData.webID,BotSkillsEnum.DONATE_TO_USER,''));break;case'change_bot_name':requestBotCommandConfiguration(BotSkillsEnum.CHANGE_BOT_NAME);hideMenu=false;break;case'save_bot_name':SendMessageComposer(new BotSkillSaveComposer(rentableBotData.webID,BotSkillsEnum.CHANGE_BOT_NAME,newName));break;case'change_bot_motto':requestBotCommandConfiguration(BotSkillsEnum.CHANGE_BOT_MOTTO);hideMenu=false;break;case'save_bot_motto':SendMessageComposer(new BotSkillSaveComposer(rentableBotData.webID,BotSkillsEnum.CHANGE_BOT_MOTTO,newMotto));break;case'dress_up':SendMessageComposer(new BotSkillSaveComposer(rentableBotData.webID,BotSkillsEnum.DRESS_UP,''));break;case'random_walk':SendMessageComposer(new BotSkillSaveComposer(rentableBotData.webID,BotSkillsEnum.RANDOM_WALK,''));break;case'setup_chat':requestBotCommandConfiguration(BotSkillsEnum.SETUP_CHAT);hideMenu=false;break;case'dance':SendMessageComposer(new BotSkillSaveComposer(rentableBotData.webID,BotSkillsEnum.DANCE,''));break;case'nux_take_tour':GetNitroInstance().createLinkEvent('help/tour');SendMessageComposer(new BotSkillSaveComposer(rentableBotData.webID,BotSkillsEnum.NUX_TAKE_TOUR,''));break;case'pick':SendMessageComposer(new BotRemoveComposer(rentableBotData.webID));break;default:break;}}if(hideMenu)close();};useEffect(()=>{setMode(MODE_NORMAL);},[rentableBotData]);const canControl=rentableBotData.amIOwner||rentableBotData.amIAnyRoomController;return/*#__PURE__*/_jsxs(ContextMenuView,{objectId:rentableBotData.roomIndex,category:RoomObjectCategory.UNIT,userType:RoomObjectType.RENTABLE_BOT,close:close,collapsable:true,children:[/*#__PURE__*/_jsx(ContextMenuHeaderView,{children:rentableBotData.name}),mode===MODE_NORMAL&&canControl&&/*#__PURE__*/_jsxs(_Fragment,{children:[rentableBotData.botSkills.indexOf(BotSkillsEnum.DONATE_TO_ALL)>=0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('donate_to_all'),children:LocalizeText('avatar.widget.donate_to_all')}),rentableBotData.botSkills.indexOf(BotSkillsEnum.DONATE_TO_USER)>=0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('donate_to_user'),children:LocalizeText('avatar.widget.donate_to_user')}),rentableBotData.botSkills.indexOf(BotSkillsEnum.CHANGE_BOT_NAME)>=0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('change_bot_name'),children:LocalizeText('avatar.widget.change_bot_name')}),rentableBotData.botSkills.indexOf(BotSkillsEnum.CHANGE_BOT_MOTTO)>=0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('change_bot_motto'),children:LocalizeText('avatar.widget.change_bot_motto')}),rentableBotData.botSkills.indexOf(BotSkillsEnum.DRESS_UP)>=0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('dress_up'),children:LocalizeText('avatar.widget.dress_up')}),rentableBotData.botSkills.indexOf(BotSkillsEnum.RANDOM_WALK)>=0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('random_walk'),children:LocalizeText('avatar.widget.random_walk')}),rentableBotData.botSkills.indexOf(BotSkillsEnum.SETUP_CHAT)>=0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('setup_chat'),children:LocalizeText('avatar.widget.setup_chat')}),rentableBotData.botSkills.indexOf(BotSkillsEnum.DANCE)>=0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('dance'),children:LocalizeText('avatar.widget.dance')}),rentableBotData.botSkills.indexOf(BotSkillsEnum.NO_PICK_UP)===-1&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('pick'),children:LocalizeText('avatar.widget.pick_up')})]}),mode===MODE_CHANGE_NAME&&/*#__PURE__*/_jsxs(Column,{className:\"menu-item context-input-bg\",onClick:null,gap:1,children:[/*#__PURE__*/_jsx(Text,{variant:\"white\",children:LocalizeText('bot.skill.name.configuration.new.name')}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-sm\",value:newName,maxLength:GetConfiguration('bot.name.max.length',15),onChange:event=>setNewName(event.target.value)}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"between\",gap:1,children:[/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"secondary\",onClick:event=>processAction(null),children:LocalizeText('cancel')}),/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"success\",onClick:event=>processAction('save_bot_name'),children:LocalizeText('save')})]})]}),mode===MODE_CHANGE_MOTTO&&/*#__PURE__*/_jsxs(Column,{className:\"menu-item context-input-bg\",onClick:null,gap:1,children:[/*#__PURE__*/_jsx(Text,{variant:\"white\",children:LocalizeText('bot.skill.name.configuration.new.motto')}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-sm\",value:newMotto,maxLength:GetConfiguration('motto.max.length',38),onChange:event=>setNewMotto(event.target.value)}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"between\",gap:1,children:[/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"secondary\",onClick:event=>processAction(null),children:LocalizeText('cancel')}),/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"success\",onClick:event=>processAction('save_bot_motto'),children:LocalizeText('save')})]})]})]});};","map":null,"metadata":{},"sourceType":"module"}