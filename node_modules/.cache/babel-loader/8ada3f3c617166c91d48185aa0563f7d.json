{"ast":null,"code":"import{Texture}from'@pixi/core';import{Point}from'@pixi/math';import{NitroSprite}from'../../../core';import{RoomId}from'../../../room/utils/RoomId';import{Vector3d}from'../../../room/utils/Vector3d';import{FloorHeightMapMessageParser}from'../../communication/messages/parser/room/mapping/FloorHeightMapMessageParser';import{Nitro}from'../../Nitro';import{RoomEngineEvent}from'../events/RoomEngineEvent';import{RoomEngineObjectEvent}from'../events/RoomEngineObjectEvent';import{ObjectRoomMapUpdateMessage}from'../messages/ObjectRoomMapUpdateMessage';import{LegacyDataType}from'../object/data/type/LegacyDataType';import{RoomObjectCategory}from'../object/RoomObjectCategory';import{RoomObjectUserType}from'../object/RoomObjectUserType';import{RoomObjectVariable}from'../object/RoomObjectVariable';import{RoomPlaneParser}from'../object/RoomPlaneParser';import{RoomEngine}from'../RoomEngine';import{LegacyWallGeometry}from'../utils/LegacyWallGeometry';export class RoomPreviewer{constructor(roomEngine){let roomId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this._roomEngine=void 0;this._planeParser=void 0;this._previewRoomId=1;this._currentPreviewObjectType=0;this._currentPreviewObjectCategory=0;this._currentPreviewObjectData='';this._currentPreviewRectangle=null;this._currentPreviewCanvasWidth=0;this._currentPreviewCanvasHeight=0;this._currentPreviewScale=64;this._currentPreviewNeedsZoomOut=void 0;this._automaticStateChange=void 0;this._previousAutomaticStateChangeTime=void 0;this._addViewOffset=void 0;this._backgroundColor=305148561;this._backgroundSprite=null;this._disableUpdate=false;this._roomEngine=roomEngine;this._planeParser=new RoomPlaneParser();this._previewRoomId=RoomId.makeRoomPreviewerId(roomId);this._addViewOffset=new Point(0,0);this.onRoomObjectAdded=this.onRoomObjectAdded.bind(this);this.onRoomInitializedonRoomInitialized=this.onRoomInitializedonRoomInitialized.bind(this);if(this.isRoomEngineReady&&this._roomEngine.events){this._roomEngine.events.addEventListener(RoomEngineObjectEvent.ADDED,this.onRoomObjectAdded);this._roomEngine.events.addEventListener(RoomEngineObjectEvent.CONTENT_UPDATED,this.onRoomObjectAdded);this._roomEngine.events.addEventListener(RoomEngineEvent.INITIALIZED,this.onRoomInitializedonRoomInitialized);}this.createRoomForPreview();}dispose(){this.reset(true);if(this.isRoomEngineReady&&this._roomEngine.events){this._roomEngine.events.removeEventListener(RoomEngineObjectEvent.ADDED,this.onRoomObjectAdded);this._roomEngine.events.removeEventListener(RoomEngineObjectEvent.CONTENT_UPDATED,this.onRoomObjectAdded);this._roomEngine.events.removeEventListener(RoomEngineEvent.INITIALIZED,this.onRoomInitializedonRoomInitialized);}if(this._backgroundSprite){this._backgroundSprite.destroy();this._backgroundSprite=null;}if(this._planeParser){this._planeParser.dispose();this._planeParser=null;}}createRoomForPreview(){if(this.isRoomEngineReady){const size=7;const planeParser=new RoomPlaneParser();planeParser.initializeTileMap(size+2,size+2);let y=1;while(y<1+size){let x=1;while(x<1+size){planeParser.setTileHeight(x,y,0);x++;}y++;}planeParser.initializeFromTileData();this._roomEngine.createRoomInstance(this._previewRoomId,planeParser.getMapData());planeParser.dispose();}}reset(k){if(this.isRoomEngineReady){this._roomEngine.removeRoomObjectFloor(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID);this._roomEngine.removeRoomObjectWall(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID);this._roomEngine.removeRoomObjectUser(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID);if(!k)this.updatePreviewRoomView();}this._currentPreviewObjectCategory=RoomObjectCategory.MINIMUM;}updatePreviewModel(model,wallHeight){let scale=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;const parser=new FloorHeightMapMessageParser();parser.flush();parser.parseModel(model,wallHeight,scale);//@ts-ignore\nconst wallGeometry=this._roomEngine.getLegacyWallGeometry(this._previewRoomId);if(!wallGeometry)return;this._planeParser.reset();const width=parser.width;const height=parser.height;this._planeParser.initializeTileMap(width,height);const entryTile=null;let doorX=-1;let doorY=-1;let doorZ=0;let doorDirection=0;let y=0;while(y<height){let x=0;while(x<width){const tileHeight=parser.getHeight(x,y);if((y>0&&y<height-1||x>0&&x<width-1)&&!(tileHeight==RoomPlaneParser.TILE_BLOCKED)&&(entryTile==null||x==entryTile.x&&y==entryTile.y)){if(parser.getHeight(x,y-1)==RoomPlaneParser.TILE_BLOCKED&&parser.getHeight(x-1,y)==RoomPlaneParser.TILE_BLOCKED&&parser.getHeight(x,y+1)==RoomPlaneParser.TILE_BLOCKED){doorX=x+0.5;doorY=y;doorZ=tileHeight;doorDirection=90;}if(parser.getHeight(x,y-1)==RoomPlaneParser.TILE_BLOCKED&&parser.getHeight(x-1,y)==RoomPlaneParser.TILE_BLOCKED&&parser.getHeight(x+1,y)==RoomPlaneParser.TILE_BLOCKED){doorX=x;doorY=y+0.5;doorZ=tileHeight;doorDirection=180;}}this._planeParser.setTileHeight(x,y,tileHeight);x++;}y++;}this._planeParser.setTileHeight(Math.floor(doorX),Math.floor(doorY),doorZ);this._planeParser.initializeFromTileData(parser.wallHeight);this._planeParser.setTileHeight(Math.floor(doorX),Math.floor(doorY),doorZ+this._planeParser.wallHeight);wallGeometry.scale=LegacyWallGeometry.DEFAULT_SCALE;wallGeometry.initialize(width,height,this._planeParser.floorHeight);let heightIterator=parser.height-1;while(heightIterator>=0){let widthIterator=parser.width-1;while(widthIterator>=0){wallGeometry.setHeight(widthIterator,heightIterator,this._planeParser.getTileHeight(widthIterator,heightIterator));widthIterator--;}heightIterator--;}const roomMap=this._planeParser.getMapData();roomMap.doors.push({x:doorX,y:doorY,z:doorZ,dir:doorDirection});const roomObject=this.getRoomPreviewOwnRoomObject();if(roomObject)roomObject.processUpdateMessage(new ObjectRoomMapUpdateMessage(roomMap));}addFurnitureIntoRoom(classId,direction){let objectData=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let extra=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!objectData)objectData=new LegacyDataType();if(this.isRoomEngineReady){this.reset(false);this._currentPreviewObjectType=classId;this._currentPreviewObjectCategory=RoomObjectCategory.FLOOR;this._currentPreviewObjectData='';if(this._roomEngine.addFurnitureFloor(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,classId,new Vector3d(RoomPreviewer.PREVIEW_OBJECT_LOCATION_X,RoomPreviewer.PREVIEW_OBJECT_LOCATION_Y,0),direction,0,objectData,NaN,-1,0,-1,'',true,false)){this._previousAutomaticStateChangeTime=Nitro.instance.time;this._automaticStateChange=true;const roomObject=this._roomEngine.getRoomObject(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);if(roomObject&&extra)roomObject.model.setValue(RoomObjectVariable.FURNITURE_EXTRAS,extra);this.updatePreviewRoomView();return RoomPreviewer.PREVIEW_OBJECT_ID;}}return-1;}addWallItemIntoRoom(classId,direction,objectData){if(this.isRoomEngineReady){if(this._currentPreviewObjectCategory===RoomObjectCategory.WALL&&this._currentPreviewObjectType===classId&&this._currentPreviewObjectData===objectData)return RoomPreviewer.PREVIEW_OBJECT_ID;this.reset(false);this._currentPreviewObjectType=classId;this._currentPreviewObjectCategory=RoomObjectCategory.WALL;this._currentPreviewObjectData=objectData;if(this._roomEngine.addFurnitureWall(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,classId,new Vector3d(0.5,2.3,1.8),direction,0,objectData,0,0,-1,'',false)){this._previousAutomaticStateChangeTime=Nitro.instance.time;this._automaticStateChange=true;this.updatePreviewRoomView();return RoomPreviewer.PREVIEW_OBJECT_ID;}}return-1;}addAvatarIntoRoom(figure,effect){if(this.isRoomEngineReady){this.reset(false);this._currentPreviewObjectType=1;this._currentPreviewObjectCategory=RoomObjectCategory.UNIT;this._currentPreviewObjectData=figure;if(this._roomEngine.addRoomObjectUser(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,new Vector3d(RoomPreviewer.PREVIEW_OBJECT_LOCATION_X,RoomPreviewer.PREVIEW_OBJECT_LOCATION_Y,0),new Vector3d(90,0,0),135,RoomObjectUserType.getTypeNumber(RoomObjectUserType.USER),figure)){this._previousAutomaticStateChangeTime=Nitro.instance.time;this._automaticStateChange=true;this.updateUserGesture(1);this.updateUserEffect(effect);this.updateUserPosture('std');}this.updatePreviewRoomView();return RoomPreviewer.PREVIEW_OBJECT_ID;}return-1;}addPetIntoRoom(figure){if(this.isRoomEngineReady){this.reset(false);this._currentPreviewObjectType=1;this._currentPreviewObjectCategory=RoomObjectCategory.UNIT;this._currentPreviewObjectData=figure;if(this._roomEngine.addRoomObjectUser(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,new Vector3d(RoomPreviewer.PREVIEW_OBJECT_LOCATION_X,RoomPreviewer.PREVIEW_OBJECT_LOCATION_Y,0),new Vector3d(90,0,0),90,RoomObjectUserType.getTypeNumber(RoomObjectUserType.PET),figure)){this._previousAutomaticStateChangeTime=Nitro.instance.time;this._automaticStateChange=false;this.updateUserGesture(1);this.updateUserPosture('std');}this.updatePreviewRoomView();return RoomPreviewer.PREVIEW_OBJECT_ID;}return-1;}updateUserPosture(type){let parameter=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';if(this.isRoomEngineReady)this._roomEngine.updateRoomObjectUserPosture(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,type,parameter);}updateUserGesture(gestureId){if(this.isRoomEngineReady)this._roomEngine.updateRoomObjectUserGesture(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,gestureId);}updateUserEffect(effectId){if(this.isRoomEngineReady)this._roomEngine.updateRoomObjectUserEffect(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,effectId);}updateObjectUserFigure(figure){let gender=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let subType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let isRiding=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(this.isRoomEngineReady)return this._roomEngine.updateRoomObjectUserFigure(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,figure,gender,subType,isRiding);return false;}updateObjectUserAction(action,value){let parameter=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(this.isRoomEngineReady)this._roomEngine.updateRoomObjectUserAction(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,action,value,parameter);}updateObjectStuffData(stuffData){if(this.isRoomEngineReady)this._roomEngine.updateRoomObjectFloor(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,null,null,stuffData.state,stuffData);}changeRoomObjectState(){if(this.isRoomEngineReady){this._automaticStateChange=false;if(this._currentPreviewObjectCategory!==RoomObjectCategory.UNIT)this._roomEngine.changeObjectState(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);}}changeRoomObjectDirection(){if(this.isRoomEngineReady){const roomObject=this._roomEngine.getRoomObject(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);if(!roomObject)return;const direction=this._roomEngine.objectEventHandler.getValidRoomObjectDirection(roomObject,true);switch(this._currentPreviewObjectCategory){case RoomObjectCategory.FLOOR:{const floorLocation=new Vector3d(RoomPreviewer.PREVIEW_OBJECT_LOCATION_X,RoomPreviewer.PREVIEW_OBJECT_LOCATION_Y);const floorDirection=new Vector3d(direction,direction,direction);this._roomEngine.updateRoomObjectFloor(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,floorLocation,floorDirection,null,null);return;}case RoomObjectCategory.WALL://this._roomEngine.updateRoomObjectWall(this._previewRoomId, RoomPreviewer.PREVIEW_OBJECT_ID, null, direction, null, null);\nreturn;}}}checkAutomaticRoomObjectStateChange(){if(this._automaticStateChange){const time=Nitro.instance.time;if(time>this._previousAutomaticStateChangeTime+RoomPreviewer.AUTOMATIC_STATE_CHANGE_INTERVAL){this._previousAutomaticStateChangeTime=time;if(this.isRoomEngineReady)this._roomEngine.changeObjectState(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);}}}getRoomCanvas(width,height){if(this.isRoomEngineReady){const displayObject=this._roomEngine.getRoomInstanceDisplay(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID,width,height,this._currentPreviewScale);if(displayObject&&this._backgroundColor!==null){let backgroundSprite=this._backgroundSprite;if(!backgroundSprite){backgroundSprite=new NitroSprite(Texture.WHITE);displayObject.addChildAt(backgroundSprite,0);}backgroundSprite.width=width;backgroundSprite.height=height;backgroundSprite.tint=this._backgroundColor;}this._roomEngine.setRoomInstanceRenderingCanvasMask(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID,true);const geometry=this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID);if(geometry)geometry.adjustLocation(new Vector3d(RoomPreviewer.PREVIEW_OBJECT_LOCATION_X,RoomPreviewer.PREVIEW_OBJECT_LOCATION_Y,0),30);this._currentPreviewCanvasWidth=width;this._currentPreviewCanvasHeight=height;return displayObject;}return null;}modifyRoomCanvas(width,height){if(this.isRoomEngineReady){this._currentPreviewCanvasWidth=width;this._currentPreviewCanvasHeight=height;if(this._backgroundSprite){this._backgroundSprite.width=width;this._backgroundSprite.height=height;}this._roomEngine.initializeRoomInstanceRenderingCanvas(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID,width,height);}}set addViewOffset(point){this._addViewOffset=point;}get addViewOffset(){return this._addViewOffset;}updatePreviewObjectBoundingRectangle(point){const objectBounds=this._roomEngine.getRoomObjectBoundingRectangle(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory,RoomPreviewer.PREVIEW_CANVAS_ID);if(objectBounds&&point){objectBounds.x+=-(this._currentPreviewCanvasWidth>>1);objectBounds.y+=-(this._currentPreviewCanvasHeight>>1);objectBounds.x+=-point.x;objectBounds.y+=-point.y;if(!this._currentPreviewRectangle){this._currentPreviewRectangle=objectBounds;}else{const bounds=this._currentPreviewRectangle.clone().enlarge(objectBounds);if(bounds.width-this._currentPreviewRectangle.width>this._currentPreviewCanvasWidth-this._currentPreviewRectangle.width>>1||bounds.height-this._currentPreviewRectangle.height>this._currentPreviewCanvasHeight-this._currentPreviewRectangle.height>>1||this._currentPreviewRectangle.width<1||this._currentPreviewRectangle.height<1)this._currentPreviewRectangle=bounds;}}}validatePreviewSize(point){if(this._currentPreviewRectangle.width<1||this._currentPreviewRectangle.height<1){return point;}if(this.isRoomEngineReady){const geometry=this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID);if(this._currentPreviewRectangle.width>this._currentPreviewCanvasWidth*(1+RoomPreviewer.ALLOWED_IMAGE_CUT)||this._currentPreviewRectangle.height>this._currentPreviewCanvasHeight*(1+RoomPreviewer.ALLOWED_IMAGE_CUT)){if(RoomPreviewer.ZOOM_ENABLED){if(this._roomEngine.getRoomInstanceRenderingCanvasScale(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID)!==0.5){this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID,0.5,null,null);this._currentPreviewScale=RoomPreviewer.SCALE_SMALL;this._currentPreviewNeedsZoomOut=true;point.x=point.x>>1;point.y=point.y>>1;this._currentPreviewRectangle.x=this._currentPreviewRectangle.x>>2;this._currentPreviewRectangle.y=this._currentPreviewRectangle.y>>2;this._currentPreviewRectangle.width=this._currentPreviewRectangle.width>>2;this._currentPreviewRectangle.height=this._currentPreviewRectangle.height>>2;}}else{if(geometry.isZoomedIn()){geometry.performZoomOut();this._currentPreviewScale=RoomPreviewer.SCALE_SMALL;this._currentPreviewNeedsZoomOut=true;}}}else if(!this._currentPreviewNeedsZoomOut){if(RoomPreviewer.ZOOM_ENABLED){if(this._roomEngine.getRoomInstanceRenderingCanvasScale(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID)!==1){this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID,1,null,null);this._currentPreviewScale=RoomPreviewer.SCALE_NORMAL;}}else{if(!geometry.isZoomedIn()){geometry.performZoomIn();this._currentPreviewScale=RoomPreviewer.SCALE_NORMAL;}}}}return point;}zoomIn(){if(this.isRoomEngineReady){if(RoomPreviewer.ZOOM_ENABLED){this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID,1);}else{const geometry=this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID);geometry.performZoomIn();}}this._currentPreviewScale=RoomPreviewer.SCALE_NORMAL;}zoomOut(){if(this.isRoomEngineReady){if(RoomPreviewer.ZOOM_ENABLED){this._roomEngine.setRoomInstanceRenderingCanvasScale(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID,0.5);}else{const geometry=this._roomEngine.getRoomInstanceGeometry(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID);geometry.performZoomOut();}}this._currentPreviewScale=RoomPreviewer.SCALE_SMALL;}updateAvatarDirection(direction,headDirection){if(this.isRoomEngineReady){this._roomEngine.updateRoomObjectUserLocation(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,new Vector3d(RoomPreviewer.PREVIEW_OBJECT_LOCATION_X,RoomPreviewer.PREVIEW_OBJECT_LOCATION_Y,0),new Vector3d(RoomPreviewer.PREVIEW_OBJECT_LOCATION_X,RoomPreviewer.PREVIEW_OBJECT_LOCATION_Y,0),false,0,new Vector3d(direction*45,0,0),headDirection*45);}}updateObjectRoom(){let floorType=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;let wallType=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let landscapeType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let _arg_4=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(this.isRoomEngineReady)return this._roomEngine.updateRoomInstancePlaneType(this._previewRoomId,floorType,wallType,landscapeType,_arg_4);return false;}updateRoomWallsAndFloorVisibility(wallsVisible){let floorsVisible=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(this.isRoomEngineReady)this._roomEngine.updateRoomInstancePlaneVisibility(this._previewRoomId,wallsVisible,floorsVisible);}getCanvasOffset(point){if(this._currentPreviewRectangle.width<1||this._currentPreviewRectangle.height<1)return point;let x=-(this._currentPreviewRectangle.left+this._currentPreviewRectangle.right)>>1;let y=-(this._currentPreviewRectangle.top+this._currentPreviewRectangle.bottom)>>1;const height=this._currentPreviewCanvasHeight-this._currentPreviewRectangle.height>>1;if(height>10){y=y+Math.min(15,height-10);}else{if(this._currentPreviewObjectCategory!==RoomObjectCategory.UNIT){y=y+(5-Math.max(0,height/2));}else{y=y-(5-Math.min(0,height/2));}}y=y+this._addViewOffset.y;x=x+this._addViewOffset.x;const offsetX=x-point.x;const offsetY=y-point.y;if(offsetX!==0||offsetY!==0){const _local_7=Math.sqrt(offsetX*offsetX+offsetY*offsetY);if(_local_7>10){x=point.x+offsetX*10/_local_7;y=point.y+offsetY*10/_local_7;}return new Point(x,y);}return null;}updatePreviewRoomView(){let k=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this._disableUpdate&&!k)return;this.checkAutomaticRoomObjectStateChange();if(this.isRoomEngineReady){let offset=this._roomEngine.getRoomInstanceRenderingCanvasOffset(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID);if(offset){this.updatePreviewObjectBoundingRectangle(offset);if(this._currentPreviewRectangle){const scale=this._currentPreviewScale;offset=this.validatePreviewSize(offset);const canvasOffset=this.getCanvasOffset(offset);if(canvasOffset){this._roomEngine.setRoomInstanceRenderingCanvasOffset(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID,canvasOffset);}if(this._currentPreviewScale!==scale)this._currentPreviewRectangle=null;}}}}set disableUpdate(flag){this._disableUpdate=flag;}set disableRoomEngineUpdate(flag){if(this.isRoomEngineReady)this._roomEngine.disableUpdate(flag);}onRoomInitializedonRoomInitialized(event){if(!event)return;switch(event.type){case RoomEngineEvent.INITIALIZED:if(event.roomId===this._previewRoomId&&this.isRoomEngineReady){this._roomEngine.updateRoomInstancePlaneType(this._previewRoomId,'110','99999');}return;}}onRoomObjectAdded(event){if(event.roomId===this._previewRoomId&&event.objectId===RoomPreviewer.PREVIEW_OBJECT_ID&&event.category===this._currentPreviewObjectCategory){this._currentPreviewRectangle=null;this._currentPreviewNeedsZoomOut=false;const roomObject=this._roomEngine.getRoomObject(event.roomId,event.objectId,event.category);if(roomObject&&roomObject.model&&event.category===RoomObjectCategory.WALL){const sizeZ=roomObject.model.getValue(RoomObjectVariable.FURNITURE_SIZE_Z);const centerZ=roomObject.model.getValue(RoomObjectVariable.FURNITURE_CENTER_Z);if(sizeZ!==null||centerZ!==null){this._roomEngine.updateRoomObjectWallLocation(event.roomId,event.objectId,new Vector3d(0.5,2.3,(3.6-sizeZ)/2+centerZ));}}}}updateRoomEngine(){if(this.isRoomEngineReady)this._roomEngine.runUpdate();}getRenderingCanvas(){const renderingCanvas=this._roomEngine.getRoomInstanceRenderingCanvas(this._previewRoomId,RoomPreviewer.PREVIEW_CANVAS_ID);if(!renderingCanvas)return null;return renderingCanvas;}getGenericRoomObjectImage(type,value,direction,scale,listener){let bgColor=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;let extras=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;let objectData=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;let state=arguments.length>8&&arguments[8]!==undefined?arguments[8]:-1;let frame=arguments.length>9&&arguments[9]!==undefined?arguments[9]:-1;let posture=arguments.length>10&&arguments[10]!==undefined?arguments[10]:null;if(this.isRoomEngineReady){return this._roomEngine.getGenericRoomObjectImage(type,value,direction,scale,listener,bgColor,extras,objectData,state,frame,posture);}return null;}getRoomObjectImage(direction,scale,listener){let bgColor=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;if(this.isRoomEngineReady){return this._roomEngine.getRoomObjectImage(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory,direction,scale,listener,bgColor);}return null;}getRoomObjectCurrentImage(){if(this.isRoomEngineReady){const roomObject=this._roomEngine.getRoomObject(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);if(roomObject&&roomObject.visualization)return roomObject.visualization.getImage(0xFFFFFF,-1);}return null;}getRoomPreviewObject(){if(this.isRoomEngineReady){const roomObject=this._roomEngine.getRoomObject(this._previewRoomId,RoomPreviewer.PREVIEW_OBJECT_ID,this._currentPreviewObjectCategory);if(roomObject)return roomObject;}return null;}getRoomPreviewOwnRoomObject(){if(this.isRoomEngineReady){const roomObject=this._roomEngine.getRoomObject(this._previewRoomId,RoomEngine.ROOM_OBJECT_ID,RoomObjectCategory.ROOM);if(roomObject)return roomObject;}return null;}get isRoomEngineReady(){return this._roomEngine&&this._roomEngine.ready;}get roomId(){return this._previewRoomId;}get backgroundColor(){return this._backgroundColor;}set backgroundColor(color){this._backgroundColor=color;}get width(){return this._currentPreviewCanvasWidth;}get height(){return this._currentPreviewCanvasHeight;}}RoomPreviewer.SCALE_NORMAL=64;RoomPreviewer.SCALE_SMALL=32;RoomPreviewer.PREVIEW_COUNTER=0;RoomPreviewer.PREVIEW_CANVAS_ID=1;RoomPreviewer.PREVIEW_OBJECT_ID=1;RoomPreviewer.PREVIEW_OBJECT_LOCATION_X=2;RoomPreviewer.PREVIEW_OBJECT_LOCATION_Y=2;RoomPreviewer.ALLOWED_IMAGE_CUT=0.25;RoomPreviewer.AUTOMATIC_STATE_CHANGE_INTERVAL=2500;RoomPreviewer.ZOOM_ENABLED=true;","map":null,"metadata":{},"sourceType":"module"}