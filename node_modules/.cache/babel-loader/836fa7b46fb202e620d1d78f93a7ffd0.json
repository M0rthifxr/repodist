{"ast":null,"code":"import{FloorHeightMapEvent,NitroPoint,RoomEngineEvent,RoomVisualizationSettingsEvent,UpdateFloorPropertiesMessageComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{AddEventLinkTracker,LocalizeText,RemoveLinkEventTracker,SendMessageComposer}from'../../api';import{Button,ButtonGroup,Flex,NitroCardContentView,NitroCardHeaderView,NitroCardView}from'../../common';import{UseMessageEventHook,UseRoomEngineEvent}from'../../hooks';import{FloorplanEditor}from'./common/FloorplanEditor';import{convertNumbersForSaving,convertSettingToNumber}from'./common/Utils';import{FloorplanEditorContextProvider}from'./FloorplanEditorContext';import{FloorplanCanvasView}from'./views/FloorplanCanvasView';import{FloorplanImportExportView}from'./views/FloorplanImportExportView';import{FloorplanOptionsView}from'./views/FloorplanOptionsView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const FloorplanEditorView=props=>{const[isVisible,setIsVisible]=useState(false);const[importExportVisible,setImportExportVisible]=useState(false);const[originalFloorplanSettings,setOriginalFloorplanSettings]=useState({tilemap:'',reservedTiles:[],entryPoint:[0,0],entryPointDir:2,wallHeight:-1,thicknessWall:1,thicknessFloor:1});const[visualizationSettings,setVisualizationSettings]=useState({entryPointDir:2,wallHeight:-1,thicknessWall:1,thicknessFloor:1});const saveFloorChanges=()=>{SendMessageComposer(new UpdateFloorPropertiesMessageComposer(FloorplanEditor.instance.getCurrentTilemapString(),FloorplanEditor.instance.doorLocation.x,FloorplanEditor.instance.doorLocation.y,visualizationSettings.entryPointDir,convertNumbersForSaving(visualizationSettings.thicknessWall),convertNumbersForSaving(visualizationSettings.thicknessFloor),visualizationSettings.wallHeight-1));};const revertChanges=()=>{setVisualizationSettings({wallHeight:originalFloorplanSettings.wallHeight,thicknessWall:originalFloorplanSettings.thicknessWall,thicknessFloor:originalFloorplanSettings.thicknessFloor,entryPointDir:originalFloorplanSettings.entryPointDir});FloorplanEditor.instance.doorLocation=new NitroPoint(originalFloorplanSettings.entryPoint[0],originalFloorplanSettings.entryPoint[1]);FloorplanEditor.instance.setTilemap(originalFloorplanSettings.tilemap,originalFloorplanSettings.reservedTiles);FloorplanEditor.instance.renderTiles();};const onRoomEngineEvent=useCallback(event=>{setIsVisible(false);},[]);UseRoomEngineEvent(RoomEngineEvent.DISPOSED,onRoomEngineEvent);const onFloorHeightMapEvent=useCallback(event=>{const parser=event.getParser();setOriginalFloorplanSettings(prevValue=>{const newValue={...prevValue};newValue.tilemap=parser.model;newValue.wallHeight=parser.wallHeight+1;return newValue;});setVisualizationSettings(prevValue=>{const newValue={...prevValue};newValue.wallHeight=parser.wallHeight+1;return newValue;});},[]);UseMessageEventHook(FloorHeightMapEvent,onFloorHeightMapEvent);const onRoomVisualizationSettingsEvent=useCallback(event=>{const parser=event.getParser();setOriginalFloorplanSettings(prevValue=>{const newValue={...prevValue};newValue.thicknessFloor=convertSettingToNumber(parser.thicknessFloor);newValue.thicknessWall=convertSettingToNumber(parser.thicknessWall);return newValue;});setVisualizationSettings(prevValue=>{const newValue={...prevValue};newValue.thicknessFloor=convertSettingToNumber(parser.thicknessFloor);newValue.thicknessWall=convertSettingToNumber(parser.thicknessWall);return newValue;});},[]);UseMessageEventHook(RoomVisualizationSettingsEvent,onRoomVisualizationSettingsEvent);useEffect(()=>{const linkTracker={linkReceived:url=>{const parts=url.split('/');if(parts.length<2)return;switch(parts[1]){case'show':setIsVisible(true);return;case'hide':setIsVisible(false);return;case'toggle':setIsVisible(prevValue=>!prevValue);return;}},eventUrlPrefix:'floor-editor/'};AddEventLinkTracker(linkTracker);return()=>RemoveLinkEventTracker(linkTracker);},[]);useEffect(()=>{FloorplanEditor.instance.initialize();},[]);return/*#__PURE__*/_jsxs(FloorplanEditorContextProvider,{value:{originalFloorplanSettings:originalFloorplanSettings,setOriginalFloorplanSettings:setOriginalFloorplanSettings,visualizationSettings:visualizationSettings,setVisualizationSettings:setVisualizationSettings},children:[isVisible&&/*#__PURE__*/_jsxs(NitroCardView,{uniqueKey:\"floorpan-editor\",className:\"nitro-floorplan-editor\",theme:\"primary\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('floor.plan.editor.title'),onCloseClick:()=>setIsVisible(false)}),/*#__PURE__*/_jsxs(NitroCardContentView,{overflow:\"hidden\",children:[/*#__PURE__*/_jsx(FloorplanOptionsView,{}),/*#__PURE__*/_jsx(FloorplanCanvasView,{overflow:\"hidden\"}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",children:[/*#__PURE__*/_jsx(Button,{onClick:revertChanges,children:LocalizeText('floor.plan.editor.reload')}),/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{disabled:true,children:LocalizeText('floor.plan.editor.preview')}),/*#__PURE__*/_jsx(Button,{onClick:event=>setImportExportVisible(true),children:LocalizeText('floor.plan.editor.import.export')}),/*#__PURE__*/_jsx(Button,{onClick:saveFloorChanges,children:LocalizeText('floor.plan.editor.save')})]})]})]})]}),importExportVisible&&/*#__PURE__*/_jsx(FloorplanImportExportView,{onCloseClick:()=>setImportExportVisible(false)})]});};","map":null,"metadata":{},"sourceType":"module"}