{"ast":null,"code":"import{PetCustomPart,PetFigureData,RoomObjectCategory,RoomObjectVariable}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{FurniCategory,GetFurnitureDataForRoomObject,GetRoomEngine,LocalizeText,RoomWidgetUseProductMessage}from'../../../../api';import{Base,Button,Column,Flex,LayoutPetImageView,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../../../common';import{useRoomContext}from'../../RoomContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const _Str_5091=-1;const _Str_11906=0;const _Str_11214=1;const _Str_11733=2;const _Str_11369=3;const _Str_8759=4;const _Str_8432=5;const _Str_9653=6;export const AvatarInfoUseProductConfirmView=props=>{const{item=null,close=null}=props;const[mode,setMode]=useState(_Str_5091);const[petData,setPetData]=useState(null);const[furniData,setFurniData]=useState(null);const{roomSession=null,widgetHandler=null}=useRoomContext();const selectRoomObject=useCallback(()=>{if(!petData)return;GetRoomEngine().selectRoomObject(roomSession.roomId,petData.roomIndex,RoomObjectCategory.UNIT);},[roomSession,petData]);const useProduct=useCallback(()=>{widgetHandler.processWidgetMessage(new RoomWidgetUseProductMessage(RoomWidgetUseProductMessage.PET_PRODUCT,item.requestRoomObjectId,petData.webID));close();},[widgetHandler,item,petData,close]);const getPetImage=useMemo(()=>{if(!petData||!furniData)return null;const petFigureData=new PetFigureData(petData.figure);const customParts=furniData.customParams.split(' ');const petIndex=parseInt(customParts[0]);switch(furniData.specialType){case FurniCategory.PET_SHAMPOO:{if(customParts.length<2)return null;const currentPalette=GetRoomEngine().getPetColorResult(petIndex,petFigureData.paletteId);const possiblePalettes=GetRoomEngine().getPetColorResultsForTag(petIndex,customParts[1]);let paletteId=-1;for(const result of possiblePalettes){if(result.breed===currentPalette.breed){paletteId=parseInt(result.id);break;}}return/*#__PURE__*/_jsx(LayoutPetImageView,{typeId:petFigureData.typeId,paletteId:paletteId,petColor:petFigureData.color,customParts:petFigureData.customParts,direction:2});}case FurniCategory.PET_CUSTOM_PART:{if(customParts.length<4)return null;const newCustomParts=[];const _local_6=customParts[1].split(',').map(piece=>parseInt(piece));const _local_7=customParts[2].split(',').map(piece=>parseInt(piece));const _local_8=customParts[3].split(',').map(piece=>parseInt(piece));let _local_10=0;while(_local_10<_local_6.length){const _local_13=_local_6[_local_10];const _local_15=petFigureData.getCustomPart(_local_13);let _local_12=_local_8[_local_10];if(_local_15!=null)_local_12=_local_15.paletteId;newCustomParts.push(new PetCustomPart(_local_13,_local_7[_local_10],_local_12));_local_10++;}return/*#__PURE__*/_jsx(LayoutPetImageView,{typeId:petFigureData.typeId,paletteId:petFigureData.paletteId,petColor:petFigureData.color,customParts:newCustomParts,direction:2});}case FurniCategory.PET_CUSTOM_PART_SHAMPOO:{if(customParts.length<3)return null;const newCustomParts=[];const _local_6=customParts[1].split(',').map(piece=>parseInt(piece));const _local_8=customParts[2].split(',').map(piece=>parseInt(piece));let _local_10=0;while(_local_10<_local_6.length){const _local_13=_local_6[_local_10];const _local_15=petFigureData.getCustomPart(_local_13);let _local_14=-1;if(_local_15!=null)_local_14=_local_15.partId;newCustomParts.push(new PetCustomPart(_local_6[_local_10],_local_14,_local_8[_local_10]));_local_10++;}return/*#__PURE__*/_jsx(LayoutPetImageView,{typeId:petFigureData.typeId,paletteId:petFigureData.paletteId,petColor:petFigureData.color,customParts:newCustomParts,direction:2});}case FurniCategory.PET_SADDLE:{if(customParts.length<4)return null;const newCustomParts=[];const _local_6=customParts[1].split(',').map(piece=>parseInt(piece));const _local_7=customParts[2].split(',').map(piece=>parseInt(piece));const _local_8=customParts[3].split(',').map(piece=>parseInt(piece));let _local_10=0;while(_local_10<_local_6.length){newCustomParts.push(new PetCustomPart(_local_6[_local_10],_local_7[_local_10],_local_8[_local_10]));_local_10++;}for(const _local_21 of petFigureData.customParts){if(_local_6.indexOf(_local_21.layerId)===-1){newCustomParts.push(_local_21);}}return/*#__PURE__*/_jsx(LayoutPetImageView,{typeId:petFigureData.typeId,paletteId:petFigureData.paletteId,petColor:petFigureData.color,customParts:newCustomParts,direction:2});}case FurniCategory.MONSTERPLANT_REBREED:case FurniCategory.MONSTERPLANT_REVIVAL:case FurniCategory.MONSTERPLANT_FERTILIZE:{let posture='rip';const roomObject=GetRoomEngine().getRoomObject(roomSession.roomId,petData.roomIndex,RoomObjectCategory.UNIT);if(roomObject){posture=roomObject.model.getValue(RoomObjectVariable.FIGURE_POSTURE);if(posture==='rip'){const level=petData.petLevel;if(level<7)posture=`grw${level}`;else posture='std';}}return/*#__PURE__*/_jsx(LayoutPetImageView,{typeId:petFigureData.typeId,paletteId:petFigureData.paletteId,petColor:petFigureData.color,customParts:petFigureData.customParts,posture:posture,direction:2});}}},[petData,furniData,roomSession]);useEffect(()=>{const userData=roomSession.userDataManager.getUserDataByIndex(item.id);setPetData(userData);const furniData=GetFurnitureDataForRoomObject(roomSession.roomId,item.requestRoomObjectId,RoomObjectCategory.FLOOR);if(!furniData)return;setFurniData(furniData);let mode=_Str_5091;switch(furniData.specialType){case FurniCategory.PET_SHAMPOO:mode=_Str_11906;break;case FurniCategory.PET_CUSTOM_PART:mode=_Str_11214;break;case FurniCategory.PET_CUSTOM_PART_SHAMPOO:mode=_Str_11733;break;case FurniCategory.PET_SADDLE:mode=_Str_11369;break;case FurniCategory.MONSTERPLANT_REVIVAL:mode=_Str_8759;break;case FurniCategory.MONSTERPLANT_REBREED:mode=_Str_8432;break;case FurniCategory.MONSTERPLANT_FERTILIZE:mode=_Str_9653;break;}setMode(mode);},[roomSession,item]);if(!petData)return null;return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-use-product-confirmation\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('useproduct.widget.title',['name'],[petData.name]),onCloseClick:close}),/*#__PURE__*/_jsx(NitroCardContentView,{center:true,children:/*#__PURE__*/_jsxs(Flex,{gap:2,overflow:\"hidden\",children:[/*#__PURE__*/_jsx(Column,{children:/*#__PURE__*/_jsx(Base,{pointer:true,className:\"product-preview\",onClick:selectRoomObject,children:getPetImage})}),/*#__PURE__*/_jsxs(Column,{justifyContent:\"between\",overflow:\"auto\",children:[/*#__PURE__*/_jsxs(Column,{gap:2,children:[mode===_Str_11906&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.shampoo',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.shampoo')})]}),mode===_Str_11214&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.custompart',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.custompart')})]}),mode===_Str_11733&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.custompartshampoo',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.custompartshampoo')})]}),mode===_Str_11369&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.saddle',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.saddle')})]}),mode===_Str_8759&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.revive_monsterplant',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.revive_monsterplant')})]}),mode===_Str_8432&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.rebreed_monsterplant',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.rebreed_monsterplant')})]}),mode===_Str_9653&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.text.fertilize_monsterplant',['productName'],[furniData.name])}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('useproduct.widget.info.fertilize_monsterplant')})]})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"between\",children:[/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:close,children:LocalizeText('useproduct.widget.cancel')}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:useProduct,children:LocalizeText('useproduct.widget.use')})]})]})]})})]});};","map":null,"metadata":{},"sourceType":"module"}