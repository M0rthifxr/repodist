{"ast":null,"code":"import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{RoomCameraWidgetSelectedEffect}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import ReactSlider from'react-slider';import{GetRoomCameraWidgetManager,LocalizeText}from'../../../../api';import{Button,ButtonGroup,Column,Flex,Grid,LayoutImage,NitroCardContentView,NitroCardHeaderView,NitroCardTabsItemView,NitroCardTabsView,NitroCardView,Text}from'../../../../common';import{CameraEditorTabs}from'../../common/CameraEditorTabs';import{CameraPictureThumbnail}from'../../common/CameraPictureThumbnail';import{CameraWidgetEffectListView}from'./effect-list/CameraWidgetEffectListView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const TABS=[CameraEditorTabs.COLORMATRIX,CameraEditorTabs.COMPOSITE];export const CameraWidgetEditorView=props=>{const{picture=null,availableEffects=null,myLevel=1,onClose=null,onCancel=null,onCheckout=null}=props;const[currentTab,setCurrentTab]=useState(TABS[0]);const[selectedEffectName,setSelectedEffectName]=useState(null);const[selectedEffects,setSelectedEffects]=useState([]);const[effectsThumbnails,setEffectsThumbnails]=useState([]);const[isZoomed,setIsZoomed]=useState(false);const getColorMatrixEffects=useMemo(()=>{return availableEffects.filter(effect=>effect.colorMatrix);},[availableEffects]);const getCompositeEffects=useMemo(()=>{return availableEffects.filter(effect=>effect.texture);},[availableEffects]);const getEffectList=useCallback(()=>{if(currentTab===CameraEditorTabs.COLORMATRIX){return getColorMatrixEffects;}return getCompositeEffects;},[currentTab,getColorMatrixEffects,getCompositeEffects]);const getSelectedEffectIndex=useCallback(name=>{if(!name||!name.length||!selectedEffects||!selectedEffects.length)return-1;return selectedEffects.findIndex(effect=>effect.effect.name===name);},[selectedEffects]);const getCurrentEffectIndex=useMemo(()=>{return getSelectedEffectIndex(selectedEffectName);},[selectedEffectName,getSelectedEffectIndex]);const getCurrentEffect=useMemo(()=>{if(!selectedEffectName)return null;return selectedEffects[getCurrentEffectIndex]||null;},[selectedEffectName,getCurrentEffectIndex,selectedEffects]);const setSelectedEffectAlpha=useCallback(alpha=>{const index=getCurrentEffectIndex;if(index===-1)return;setSelectedEffects(prevValue=>{const clone=[...prevValue];const currentEffect=clone[index];clone[getCurrentEffectIndex]=new RoomCameraWidgetSelectedEffect(currentEffect.effect,alpha);return clone;});},[getCurrentEffectIndex,setSelectedEffects]);const getCurrentPictureUrl=useMemo(()=>{return GetRoomCameraWidgetManager().applyEffects(picture.texture,selectedEffects,isZoomed).src;},[picture,selectedEffects,isZoomed]);const processAction=useCallback(function(type){let effectName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;switch(type){case'close':onClose();return;case'cancel':onCancel();return;case'checkout':onCheckout(getCurrentPictureUrl);return;case'change_tab':setCurrentTab(String(effectName));return;case'select_effect':{let existingIndex=getSelectedEffectIndex(effectName);if(existingIndex>=0)return;const effect=availableEffects.find(effect=>effect.name===effectName);if(!effect)return;setSelectedEffects(prevValue=>{return[...prevValue,new RoomCameraWidgetSelectedEffect(effect,1)];});setSelectedEffectName(effect.name);return;}case'remove_effect':{let existingIndex=getSelectedEffectIndex(effectName);if(existingIndex===-1)return;setSelectedEffects(prevValue=>{const clone=[...prevValue];clone.splice(existingIndex,1);return clone;});if(selectedEffectName===effectName)setSelectedEffectName(null);return;}case'clear_effects':setSelectedEffectName(null);setSelectedEffects([]);return;case'download':{const image=new Image();image.src=getCurrentPictureUrl;const newWindow=window.open('');newWindow.document.write(image.outerHTML);return;}case'zoom':setIsZoomed(!isZoomed);return;}},[isZoomed,availableEffects,selectedEffectName,getCurrentPictureUrl,getSelectedEffectIndex,onCancel,onCheckout,onClose,setIsZoomed,setSelectedEffects]);useEffect(()=>{const thumbnails=[];for(const effect of availableEffects){thumbnails.push(new CameraPictureThumbnail(effect.name,GetRoomCameraWidgetManager().applyEffects(picture.texture,[new RoomCameraWidgetSelectedEffect(effect,1)],false).src));}setEffectsThumbnails(thumbnails);},[picture,availableEffects]);return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-camera-editor\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('camera.editor.button.text'),onCloseClick:event=>processAction('close')}),/*#__PURE__*/_jsx(NitroCardTabsView,{children:TABS.map(tab=>{return/*#__PURE__*/_jsx(NitroCardTabsItemView,{isActive:currentTab===tab,onClick:event=>processAction('change_tab',tab),children:/*#__PURE__*/_jsx(\"i\",{className:'icon icon-camera-'+tab})},tab);})}),/*#__PURE__*/_jsx(NitroCardContentView,{children:/*#__PURE__*/_jsxs(Grid,{children:[/*#__PURE__*/_jsx(Column,{size:5,overflow:\"hidden\",children:/*#__PURE__*/_jsx(CameraWidgetEffectListView,{myLevel:myLevel,selectedEffects:selectedEffects,effects:getEffectList(),thumbnails:effectsThumbnails,processAction:processAction})}),/*#__PURE__*/_jsxs(Column,{size:7,justifyContent:\"between\",overflow:\"hidden\",children:[/*#__PURE__*/_jsxs(Column,{center:true,children:[/*#__PURE__*/_jsx(LayoutImage,{imageUrl:getCurrentPictureUrl,className:\"picture-preview\"}),selectedEffectName&&/*#__PURE__*/_jsxs(Column,{center:true,fullWidth:true,gap:1,children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('camera.effect.name.'+selectedEffectName)}),/*#__PURE__*/_jsx(ReactSlider,{className:'nitro-slider',min:0,max:1,step:0.01,value:getCurrentEffect.alpha,onChange:event=>setSelectedEffectAlpha(event),renderThumb:(props,state)=>/*#__PURE__*/_jsx(\"div\",{...props,children:state.valueNow})})]})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",children:[/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{onClick:event=>processAction('clear_effects'),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"trash\"})}),/*#__PURE__*/_jsx(Button,{onClick:event=>processAction('download'),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"save\"})}),/*#__PURE__*/_jsx(Button,{onClick:event=>processAction('zoom'),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:isZoomed?'search-minus':'search-plus'})})]}),/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Button,{onClick:event=>processAction('cancel'),children:LocalizeText('generic.cancel')}),/*#__PURE__*/_jsx(Button,{onClick:event=>processAction('checkout'),children:LocalizeText('camera.preview.button.text')})]})]})]})]})})]});};","map":null,"metadata":{},"sourceType":"module"}