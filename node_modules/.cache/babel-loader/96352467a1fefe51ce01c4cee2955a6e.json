{"ast":null,"code":"import{GroupInformationComposer,GroupInformationEvent,RoomControllerLevel,RoomObjectCategory,RoomObjectVariable,RoomWidgetEnumItemExtradataParameter,RoomWidgetFurniInfoUsagePolicyEnum,SetObjectDataMessageComposer,StringDataType}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{CreateLinkEvent,GetGroupInformation,GetRoomEngine,LocalizeText,RoomWidgetFurniActionMessage,SendMessageComposer}from'../../../../api';import{Button,Column,Flex,LayoutBadgeImageView,LayoutLimitedEditionCompactPlateView,LayoutRarityLevelView,Text,UserProfileIconView}from'../../../../common';import{UseMessageEventHook}from'../../../../hooks';import{useRoomContext}from'../../RoomContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const PICKUP_MODE_NONE=0;const PICKUP_MODE_EJECT=1;const PICKUP_MODE_FULL=2;export const InfoStandWidgetFurniView=props=>{const{furniData=null,close=null}=props;const{roomSession=null,eventDispatcher=null,widgetHandler=null}=useRoomContext();const[pickupMode,setPickupMode]=useState(0);const[canMove,setCanMove]=useState(false);const[canRotate,setCanRotate]=useState(false);const[canUse,setCanUse]=useState(false);const[furniKeys,setFurniKeys]=useState([]);const[furniValues,setFurniValues]=useState([]);const[customKeys,setCustomKeys]=useState([]);const[customValues,setCustomValues]=useState([]);const[isCrackable,setIsCrackable]=useState(false);const[crackableHits,setCrackableHits]=useState(0);const[crackableTarget,setCrackableTarget]=useState(0);const[godMode,setGodMode]=useState(false);const[canSeeFurniId,setCanSeeFurniId]=useState(false);const[groupName,setGroupName]=useState(null);useEffect(()=>{let pickupMode=PICKUP_MODE_NONE;let canMove=false;let canRotate=false;let canUse=false;let furniKeyss=[];let furniValuess=[];let customKeyss=[];let customValuess=[];let isCrackable=false;let crackableHits=0;let crackableTarget=0;let godMode=false;let canSeeFurniId=false;const isValidController=furniData.roomControllerLevel>=RoomControllerLevel.GUEST;if(isValidController||furniData.isOwner||furniData.isRoomOwner||furniData.isAnyRoomController){canMove=true;canRotate=!furniData.isWallItem;if(furniData.roomControllerLevel>=RoomControllerLevel.MODERATOR)godMode=true;}if(furniData.isAnyRoomController){canSeeFurniId=true;}if(furniData.usagePolicy===RoomWidgetFurniInfoUsagePolicyEnum.EVERYBODY||furniData.usagePolicy===RoomWidgetFurniInfoUsagePolicyEnum.CONTROLLER&&isValidController||furniData.extraParam===RoomWidgetEnumItemExtradataParameter.JUKEBOX&&isValidController||furniData.extraParam===RoomWidgetEnumItemExtradataParameter.USABLE_PRODUCT&&isValidController)canUse=true;if(furniData.extraParam){if(furniData.extraParam===RoomWidgetEnumItemExtradataParameter.CRACKABLE_FURNI){const stuffData=furniData.stuffData;canUse=true;isCrackable=true;crackableHits=stuffData.hits;crackableTarget=stuffData.target;}if(godMode){const extraParam=furniData.extraParam.substr(RoomWidgetEnumItemExtradataParameter.BRANDING_OPTIONS.length);if(extraParam){const parts=extraParam.split('\\t');for(const part of parts){const value=part.split('=');if(value&&value.length===2){furniKeyss.push(value[0]);furniValuess.push(value[1]);}}}}}if(godMode){const roomObject=GetRoomEngine().getRoomObject(roomSession.roomId,furniData.id,furniData.isWallItem?RoomObjectCategory.WALL:RoomObjectCategory.FLOOR);if(roomObject){const customVariables=roomObject.model.getValue(RoomObjectVariable.FURNITURE_CUSTOM_VARIABLES);const furnitureData=roomObject.model.getValue(RoomObjectVariable.FURNITURE_DATA);if(customVariables&&customVariables.length){for(const customVariable of customVariables){customKeyss.push(customVariable);customValuess.push(furnitureData[customVariable]||'');}}}}if(furniData.isOwner||furniData.isAnyRoomController)pickupMode=PICKUP_MODE_FULL;else if(furniData.isRoomOwner||furniData.roomControllerLevel>=RoomControllerLevel.GUILD_ADMIN)pickupMode=PICKUP_MODE_EJECT;if(furniData.isStickie)pickupMode=PICKUP_MODE_NONE;setPickupMode(pickupMode);setCanMove(canMove);setCanRotate(canRotate);setCanUse(canUse);setFurniKeys(furniKeyss);setFurniValues(furniValuess);setCustomKeys(customKeyss);setCustomValues(customValuess);setIsCrackable(isCrackable);setCrackableHits(crackableHits);setCrackableTarget(crackableTarget);setGodMode(godMode);setCanSeeFurniId(canSeeFurniId);setGroupName(null);if(furniData.groupId)SendMessageComposer(new GroupInformationComposer(furniData.groupId,false));},[roomSession,furniData]);const onGroupInformationEvent=useCallback(event=>{const parser=event.getParser();if(!furniData||furniData.groupId!==parser.id||parser.flag)return;if(groupName)setGroupName(null);setGroupName(parser.title);},[furniData,groupName]);UseMessageEventHook(GroupInformationEvent,onGroupInformationEvent);const onFurniSettingChange=useCallback((index,value)=>{const clone=Array.from(furniValues);clone[index]=value;setFurniValues(clone);},[furniValues]);const onCustomVariableChange=useCallback((index,value)=>{const clone=Array.from(customValues);clone[index]=value;setCustomValues(clone);},[customValues]);const getFurniSettingsAsString=useCallback(()=>{if(furniKeys.length===0||furniValues.length===0)return'';let data='';let i=0;while(i<furniKeys.length){const key=furniKeys[i];const value=furniValues[i];data=data+(key+'='+value+'\\t');i++;}return data;},[furniKeys,furniValues]);const processButtonAction=useCallback(action=>{if(!action||action==='')return;let messageType=null;let objectData=null;switch(action){case'buy_one':CreateLinkEvent(`catalog/open/offerId/${furniData.purchaseOfferId}`);return;case'move':messageType=RoomWidgetFurniActionMessage.MOVE;break;case'rotate':messageType=RoomWidgetFurniActionMessage.ROTATE;break;case'pickup':if(pickupMode===PICKUP_MODE_FULL)messageType=RoomWidgetFurniActionMessage.PICKUP;else messageType=RoomWidgetFurniActionMessage.EJECT;break;case'use':messageType=RoomWidgetFurniActionMessage.USE;break;case'save_branding_configuration':messageType=RoomWidgetFurniActionMessage.SAVE_STUFF_DATA;objectData=getFurniSettingsAsString();break;case'save_custom_variables':const map=new Map();for(let i=0;i<customKeys.length;i++){const key=customKeys[i];const value=customValues[i];if(key&&key.length&&value&&value.length)map.set(key,value);}SendMessageComposer(new SetObjectDataMessageComposer(furniData.id,map));break;}if(!messageType)return;widgetHandler.processWidgetMessage(new RoomWidgetFurniActionMessage(messageType,furniData.id,furniData.category,furniData.purchaseOfferId,objectData));},[widgetHandler,furniData,pickupMode,customKeys,customValues,getFurniSettingsAsString]);const getGroupBadgeCode=useCallback(()=>{const stringDataType=furniData.stuffData;if(!stringDataType||!(stringDataType instanceof StringDataType))return null;return stringDataType.getValue(2);},[furniData]);if(!furniData)return null;return/*#__PURE__*/_jsxs(Column,{gap:1,alignItems:\"end\",children:[/*#__PURE__*/_jsx(Column,{className:\"nitro-infostand\",children:/*#__PURE__*/_jsxs(Column,{overflow:\"visible\",className:\"container-fluid content-area\",gap:1,children:[/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"between\",gap:1,children:[/*#__PURE__*/_jsx(Text,{gfbold:true,variant:\"white\",wrap:true,children:furniData.name}),/*#__PURE__*/_jsx(\"i\",{className:\"infostand-close\",onClick:close})]}),/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsxs(Flex,{position:\"relative\",gap:1,children:[furniData.stuffData.isUnique&&/*#__PURE__*/_jsx(\"div\",{className:\"position-absolute end-0\",children:/*#__PURE__*/_jsx(LayoutLimitedEditionCompactPlateView,{uniqueNumber:furniData.stuffData.uniqueNumber,uniqueSeries:furniData.stuffData.uniqueSeries})}),furniData.stuffData.rarityLevel>-1&&/*#__PURE__*/_jsx(\"div\",{className:\"position-absolute end-0\",children:/*#__PURE__*/_jsx(LayoutRarityLevelView,{level:furniData.stuffData.rarityLevel})}),furniData.image&&furniData.image.src.length&&/*#__PURE__*/_jsx(\"img\",{className:\"d-block mx-auto\",src:furniData.image.src,alt:\"\"})]}),/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{fullWidth:true,wrap:true,textBreak:true,variant:\"white\",children:furniData.description}),/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:1,children:[/*#__PURE__*/_jsx(UserProfileIconView,{userId:furniData.ownerId}),/*#__PURE__*/_jsx(Text,{variant:\"white\",wrap:true,children:[furniData.ownerName]})]}),furniData.purchaseOfferId>0&&/*#__PURE__*/_jsx(Flex,{children:/*#__PURE__*/_jsx(Button,{className:\"volter-button\",onClick:event=>processButtonAction('buy_one'),children:LocalizeText('infostand.button.buy')})})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[isCrackable&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"}),/*#__PURE__*/_jsx(Text,{variant:\"white\",wrap:true,children:LocalizeText('infostand.crackable_furni.hits_remaining',['hits','target'],[crackableHits.toString(),crackableTarget.toString()])})]}),furniData.groupId>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"}),/*#__PURE__*/_jsxs(Flex,{pointer:true,alignItems:\"center\",gap:2,onClick:()=>GetGroupInformation(furniData.groupId),children:[/*#__PURE__*/_jsx(LayoutBadgeImageView,{badgeCode:getGroupBadgeCode(),isGroup:true}),/*#__PURE__*/_jsx(Text,{variant:\"white\",underline:true,children:groupName})]})]}),godMode&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"}),canSeeFurniId&&/*#__PURE__*/_jsxs(Text,{wrap:true,variant:\"white\",children:[\"ID: \",furniData.id]}),furniKeys.length>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{className:\"m-0\"}),/*#__PURE__*/_jsx(Column,{gap:1,children:furniKeys.map((key,index)=>{return/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:1,children:[/*#__PURE__*/_jsx(Text,{wrap:true,align:\"end\",variant:\"white\",className:\"col-4\",children:key}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-sm\",value:furniValues[index],onChange:event=>onFurniSettingChange(index,event.target.value)})]},index);})})]})]}),customKeys.length>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{className:\"m-0 my-1\"}),/*#__PURE__*/_jsx(Column,{gap:1,children:customKeys.map((key,index)=>{return/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:1,children:[/*#__PURE__*/_jsx(Text,{small:true,wrap:true,align:\"end\",variant:\"white\",className:\"col-4\",children:key}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-sm\",value:customValues[index],onChange:event=>onCustomVariableChange(index,event.target.value)})]},index);})})]})]})]})}),/*#__PURE__*/_jsxs(Flex,{gap:2,justifyContent:\"end\",children:[canMove&&/*#__PURE__*/_jsx(Button,{className:\"infostand-buttons px-2\",onClick:event=>processButtonAction('move'),children:LocalizeText('infostand.button.move')}),canRotate&&/*#__PURE__*/_jsx(Button,{className:\"infostand-buttons px-2\",onClick:event=>processButtonAction('rotate'),children:LocalizeText('infostand.button.rotate')}),pickupMode!==PICKUP_MODE_NONE&&/*#__PURE__*/_jsx(Button,{className:\"infostand-buttons px-2\",onClick:event=>processButtonAction('pickup'),children:LocalizeText(pickupMode===PICKUP_MODE_EJECT?'infostand.button.eject':'infostand.button.pickup')}),canUse&&/*#__PURE__*/_jsx(Button,{className:\"infostand-buttons px-2\",onClick:event=>processButtonAction('use'),children:LocalizeText('infostand.button.use')}),furniKeys.length>0&&furniValues.length>0&&furniKeys.length===furniValues.length&&/*#__PURE__*/_jsx(Button,{className:\"infostand-buttons px-2\",onClick:()=>processButtonAction('save_branding_configuration'),children:LocalizeText('save')}),customKeys.length>0&&customValues.length>0&&customKeys.length===customValues.length&&/*#__PURE__*/_jsx(Button,{className:\"infostand-buttons px-2\",onClick:()=>processButtonAction('save_custom_variables'),children:LocalizeText('save')})]})]});};","map":null,"metadata":{},"sourceType":"module"}