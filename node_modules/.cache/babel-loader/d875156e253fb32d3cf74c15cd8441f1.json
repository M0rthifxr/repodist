{"ast":null,"code":"import{RoomObjectSamplePlaybackEvent}from'../../../events/RoomObjectSamplePlaybackEvent';import{ObjectDataUpdateMessage}from'../../../messages/ObjectDataUpdateMessage';import{RoomObjectVariable}from'../../RoomObjectVariable';import{FurnitureMultiStateLogic}from'./FurnitureMultiStateLogic';export class FurnitureSoundBlockLogic extends FurnitureMultiStateLogic{constructor(){super(...arguments);this._state=-1;this._sampleId=-1;this._noPitch=false;this._lastLocZ=0;}getEventTypes(){const types=[RoomObjectSamplePlaybackEvent.ROOM_OBJECT_INITIALIZED,RoomObjectSamplePlaybackEvent.ROOM_OBJECT_DISPOSED,RoomObjectSamplePlaybackEvent.PLAY_SAMPLE,RoomObjectSamplePlaybackEvent.CHANGE_PITCH];return this.mergeTypes(super.getEventTypes(),types);}initialize(asset){super.initialize(asset);if(asset.logic){if(asset.logic.soundSample){this._sampleId=asset.logic.soundSample.id;this._noPitch=asset.logic.soundSample.noPitch;}}this.object.model.setValue(RoomObjectVariable.FURNITURE_SOUNDBLOCK_RELATIVE_ANIMATION_SPEED,1);}onDispose(){if(this._state!==FurnitureSoundBlockLogic.STATE_UNINITIALIZED){this.eventDispatcher.dispatchEvent(new RoomObjectSamplePlaybackEvent(RoomObjectSamplePlaybackEvent.ROOM_OBJECT_DISPOSED,this.object,this._sampleId));}super.onDispose();}processUpdateMessage(message){super.processUpdateMessage(message);if(message instanceof ObjectDataUpdateMessage)this.updateSoundBlockMessage(message);}updateSoundBlockMessage(message){if(!message)return;const model=this.object&&this.object.model;const location=this.object&&this.object.location;if(!model||!location)return;if(this._state===FurnitureSoundBlockLogic.STATE_UNINITIALIZED&&model.getValue(RoomObjectVariable.FURNITURE_REAL_ROOM_OBJECT)===1){this._lastLocZ=location.z;this.eventDispatcher.dispatchEvent(new RoomObjectSamplePlaybackEvent(RoomObjectSamplePlaybackEvent.ROOM_OBJECT_INITIALIZED,this.object,this._sampleId,this.getPitchForHeight(location.z)));}if(this._state!==FurnitureSoundBlockLogic.STATE_UNINITIALIZED&&model.getValue(RoomObjectVariable.FURNITURE_REAL_ROOM_OBJECT)===1){if(this._lastLocZ!==location.z){this._lastLocZ=location.z;this.eventDispatcher.dispatchEvent(new RoomObjectSamplePlaybackEvent(RoomObjectSamplePlaybackEvent.CHANGE_PITCH,this.object,this._sampleId,this.getPitchForHeight(location.z)));}}if(this._state!==FurnitureSoundBlockLogic.STATE_UNINITIALIZED&&message.state!==this._state){this.playSoundAt(location.z);}this._state=message.state;}playSoundAt(height){if(!this.object)return;const pitch=this.getPitchForHeight(height);this.object.model.setValue(RoomObjectVariable.FURNITURE_SOUNDBLOCK_RELATIVE_ANIMATION_SPEED,pitch);this.eventDispatcher.dispatchEvent(new RoomObjectSamplePlaybackEvent(RoomObjectSamplePlaybackEvent.PLAY_SAMPLE,this.object,this._sampleId,pitch));}getPitchForHeight(height){if(this._noPitch)return 1;let heightScaled=height*2;if(heightScaled>FurnitureSoundBlockLogic.HIGHEST_SEMITONE){heightScaled=Math.min(0,FurnitureSoundBlockLogic.LOWEST_SEMITONE+(heightScaled-FurnitureSoundBlockLogic.HIGHEST_SEMITONE-1));}return Math.pow(2,heightScaled/12);}}FurnitureSoundBlockLogic.HIGHEST_SEMITONE=12;FurnitureSoundBlockLogic.LOWEST_SEMITONE=-12;FurnitureSoundBlockLogic.STATE_UNINITIALIZED=-1;","map":null,"metadata":{},"sourceType":"module"}