{"ast":null,"code":"import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{RoomControllerLevel,RoomObjectCategory,RoomObjectVariable}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{CreateLinkEvent,GetOwnRoomObject,GetUserProfile,LocalizeText,RoomWidgetUserActionMessage}from'../../../../api';import{Base,Flex}from'../../../../common';import{useFriends}from'../../../../hooks';import{useRoomContext}from'../../RoomContext';import{ContextMenuHeaderView}from'../context-menu/ContextMenuHeaderView';import{ContextMenuListItemView}from'../context-menu/ContextMenuListItemView';import{ContextMenuView}from'../context-menu/ContextMenuView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const MODE_NORMAL=0;const MODE_MODERATE=1;const MODE_MODERATE_BAN=2;const MODE_MODERATE_MUTE=3;const MODE_AMBASSADOR=4;const MODE_AMBASSADOR_MUTE=5;const MODE_RELATIONSHIP=6;export const AvatarInfoWidgetAvatarView=props=>{const{userData=null,close=null}=props;const[mode,setMode]=useState(MODE_NORMAL);const[respectsLeft,setRespectsLeft]=useState(0);const{canRequestFriend=null}=useFriends();const{widgetHandler=null}=useRoomContext();const isShowGiveRights=useMemo(()=>{return userData.amIOwner&&userData.targetRoomControllerLevel<RoomControllerLevel.GUEST&&!userData.isGuildRoom;},[userData]);const isShowRemoveRights=useMemo(()=>{return userData.amIOwner&&userData.targetRoomControllerLevel===RoomControllerLevel.GUEST&&!userData.isGuildRoom;},[userData]);const moderateMenuHasContent=useMemo(()=>{return userData.canBeKicked||userData.canBeBanned||userData.canBeMuted||isShowGiveRights||isShowRemoveRights;},[isShowGiveRights,isShowRemoveRights,userData]);const canGiveHandItem=useMemo(()=>{let flag=false;const roomObject=GetOwnRoomObject();if(roomObject){const carryId=roomObject.model.getValue(RoomObjectVariable.FIGURE_CARRY_OBJECT);if(carryId>0&&carryId<999999)flag=true;}return flag;},[]);const processAction=useCallback(name=>{let messageType=null;let message=null;let hideMenu=true;if(name){switch(name){case'moderate':hideMenu=false;setMode(MODE_MODERATE);break;case'ban':hideMenu=false;setMode(MODE_MODERATE_BAN);break;case'mute':hideMenu=false;setMode(MODE_MODERATE_MUTE);break;case'ambassador':hideMenu=false;setMode(MODE_AMBASSADOR);break;case'ambassador_mute':hideMenu=false;setMode(MODE_AMBASSADOR_MUTE);break;case'back_moderate':hideMenu=false;setMode(MODE_MODERATE);break;case'back_ambassador':hideMenu=false;setMode(MODE_AMBASSADOR);break;case'back':hideMenu=false;setMode(MODE_NORMAL);break;case'whisper':messageType=RoomWidgetUserActionMessage.WHISPER_USER;break;case'friend':CreateLinkEvent(`friends/request/${userData.webID}/${userData.name}`);break;case'relationship':hideMenu=false;setMode(MODE_RELATIONSHIP);break;case'respect':{let newRespectsLeft=respectsLeft-1;setRespectsLeft(newRespectsLeft);messageType=RoomWidgetUserActionMessage.RESPECT_USER;if(newRespectsLeft>0)hideMenu=false;break;}case'ignore':messageType=RoomWidgetUserActionMessage.IGNORE_USER;break;case'unignore':messageType=RoomWidgetUserActionMessage.UNIGNORE_USER;break;case'kick':messageType=RoomWidgetUserActionMessage.KICK_USER;break;case'ban_hour':messageType=RoomWidgetUserActionMessage.BAN_USER_HOUR;break;case'ban_day':messageType=RoomWidgetUserActionMessage.BAN_USER_DAY;break;case'perm_ban':messageType=RoomWidgetUserActionMessage.BAN_USER_PERM;break;case'mute_2min':messageType=RoomWidgetUserActionMessage.MUTE_USER_2MIN;break;case'mute_5min':messageType=RoomWidgetUserActionMessage.MUTE_USER_5MIN;break;case'mute_10min':messageType=RoomWidgetUserActionMessage.MUTE_USER_10MIN;break;case'give_rights':messageType=RoomWidgetUserActionMessage.GIVE_RIGHTS;break;case'remove_rights':messageType=RoomWidgetUserActionMessage.TAKE_RIGHTS;break;case'trade':messageType=RoomWidgetUserActionMessage.START_TRADING;break;case'report':messageType=RoomWidgetUserActionMessage.REPORT_CFH_OTHER;break;case'pass_hand_item':messageType=RoomWidgetUserActionMessage.PASS_CARRY_ITEM;break;case'ambassador_alert':messageType=RoomWidgetUserActionMessage.AMBASSADOR_ALERT_USER;break;case'ambassador_kick':messageType=RoomWidgetUserActionMessage.AMBASSADOR_KICK_USER;break;case'ambassador_mute_2min':messageType=RoomWidgetUserActionMessage.MUTE_USER_2MIN;break;case'ambassador_mute_10min':messageType=RoomWidgetUserActionMessage.AMBASSADOR_MUTE_USER_10MIN;break;case'ambassador_mute_60min':messageType=RoomWidgetUserActionMessage.AMBASSADOR_MUTE_USER_60MIN;break;case'ambassador_mute_18hour':messageType=RoomWidgetUserActionMessage.AMBASSADOR_MUTE_USER_18HOUR;break;case'rship_heart':messageType=RoomWidgetUserActionMessage.RELATIONSHIP_HEART;break;case'rship_smile':messageType=RoomWidgetUserActionMessage.RELATIONSHIP_SMILE;break;case'rship_bobba':messageType=RoomWidgetUserActionMessage.RELATIONSHIP_BOBBA;break;case'rship_none':messageType=RoomWidgetUserActionMessage.RELATIONSHIP_NONE;break;}if(messageType)message=new RoomWidgetUserActionMessage(messageType,userData.webID);if(message)widgetHandler.processWidgetMessage(message);}if(hideMenu)close();},[userData,respectsLeft,widgetHandler,close]);useEffect(()=>{setMode(MODE_NORMAL);setRespectsLeft(userData.respectLeft);},[userData]);return/*#__PURE__*/_jsxs(ContextMenuView,{objectId:userData.roomIndex,category:RoomObjectCategory.UNIT,userType:userData.userType,close:close,collapsable:true,children:[/*#__PURE__*/_jsx(ContextMenuHeaderView,{className:\"cursor-pointer\",onClick:event=>GetUserProfile(userData.webID),children:userData.name}),mode===MODE_NORMAL&&/*#__PURE__*/_jsxs(_Fragment,{children:[canRequestFriend(userData.webID)&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('friend'),children:LocalizeText('infostand.button.friend')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('trade'),children:LocalizeText('infostand.button.trade')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('whisper'),children:LocalizeText('infostand.button.whisper')}),respectsLeft>0&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('respect'),children:LocalizeText('infostand.button.respect',['count'],[respectsLeft.toString()])}),!canRequestFriend(userData.webID)&&/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('relationship'),children:[LocalizeText('infostand.link.relationship'),/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"})]}),!userData.isIgnored&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ignore'),children:LocalizeText('infostand.button.ignore')}),userData.isIgnored&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('unignore'),children:LocalizeText('infostand.button.unignore')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('report'),children:LocalizeText('infostand.button.report')}),moderateMenuHasContent&&/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('moderate'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"}),LocalizeText('infostand.link.moderate')]}),userData.isAmbassador&&/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('ambassador'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"}),LocalizeText('infostand.link.ambassador')]}),canGiveHandItem&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('pass_hand_item'),children:LocalizeText('avatar.widget.pass_hand_item')})]}),mode===MODE_MODERATE&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('kick'),children:LocalizeText('infostand.button.kick')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('mute'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"}),LocalizeText('infostand.button.mute')]}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('ban'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"}),LocalizeText('infostand.button.ban')]}),isShowGiveRights&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('give_rights'),children:LocalizeText('infostand.button.giverights')}),isShowRemoveRights&&/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('remove_rights'),children:LocalizeText('infostand.button.removerights')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]}),mode===MODE_MODERATE_BAN&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ban_hour'),children:LocalizeText('infostand.button.ban_hour')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ban_day'),children:LocalizeText('infostand.button.ban_day')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ban_perm'),children:LocalizeText('infostand.button.perm_ban')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back_moderate'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]}),mode===MODE_MODERATE_MUTE&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('mute_2min'),children:LocalizeText('infostand.button.mute_2min')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('mute_5min'),children:LocalizeText('infostand.button.mute_5min')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('mute_10min'),children:LocalizeText('infostand.button.mute_10min')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back_moderate'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]}),mode===MODE_AMBASSADOR&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_alert'),children:LocalizeText('infostand.button.alert')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_kick'),children:LocalizeText('infostand.button.kick')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('ambassador_mute'),children:[LocalizeText('infostand.button.mute'),/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\",className:\"right\"})]}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]}),mode===MODE_AMBASSADOR_MUTE&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_mute_2min'),children:LocalizeText('infostand.button.mute_2min')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_mute_10min'),children:LocalizeText('infostand.button.mute_10min')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_mute_60min'),children:LocalizeText('infostand.button.mute_60min')}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('ambassador_mute_18hr'),children:LocalizeText('infostand.button.mute_18hour')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back_ambassador'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]}),mode===MODE_RELATIONSHIP&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Flex,{className:\"menu-list-split-3\",children:[/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('rship_heart'),children:/*#__PURE__*/_jsx(Base,{pointer:true,className:\"nitro-friends-spritesheet icon-heart\"})}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('rship_smile'),children:/*#__PURE__*/_jsx(Base,{pointer:true,className:\"nitro-friends-spritesheet icon-smile\"})}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('rship_bobba'),children:/*#__PURE__*/_jsx(Base,{pointer:true,className:\"nitro-friends-spritesheet icon-bobba\"})})]}),/*#__PURE__*/_jsx(ContextMenuListItemView,{onClick:event=>processAction('rship_none'),children:LocalizeText('avatar.widget.clear_relationship')}),/*#__PURE__*/_jsxs(ContextMenuListItemView,{onClick:event=>processAction('back'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\",className:\"left\"}),LocalizeText('generic.back')]})]})]});};","map":null,"metadata":{},"sourceType":"module"}