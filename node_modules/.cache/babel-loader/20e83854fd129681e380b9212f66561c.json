{"ast":null,"code":"import{Application}from'@pixi/app';import{SCALE_MODES}from'@pixi/constants';import{settings}from'@pixi/settings';import{Ticker}from'@pixi/ticker';import{ConfigurationEvent}from'../core/configuration/ConfigurationEvent';import{EventDispatcher}from'../core/events/EventDispatcher';import{NitroEvent}from'../core/events/NitroEvent';import{NitroCore}from'../core/NitroCore';import{NitroTimer}from'../core/utils/NitroTimer';import{RoomManager}from'../room/RoomManager';import{AvatarRenderManager}from'./avatar/AvatarRenderManager';import{RoomCameraWidgetManager}from'./camera/RoomCameraWidgetManager';import{NitroCommunicationManager}from'./communication/NitroCommunicationManager';import{LegacyExternalInterface}from'./externalInterface/LegacyExternalInterface';import{GameMessageHandler}from'./game/GameMessageHandler';import{NitroLocalizationManager}from'./localization/NitroLocalizationManager';import'./Plugins';import{RoomEngineEvent}from'./room/events/RoomEngineEvent';import{RoomEngine}from'./room/RoomEngine';import{RoomSessionManager}from'./session/RoomSessionManager';import{SessionDataManager}from'./session/SessionDataManager';import{SoundManager}from'./sound/SoundManager';import{HabboWebTools}from'./utils/HabboWebTools';LegacyExternalInterface.available;settings.SCALE_MODE=!(window.devicePixelRatio%1)?SCALE_MODES.NEAREST:SCALE_MODES.LINEAR;settings.ROUND_PIXELS=true;export class Nitro extends Application{constructor(core,options){super(options);this._nitroTimer=void 0;this._worker=void 0;this._core=void 0;this._events=void 0;this._communication=void 0;this._localization=void 0;this._avatar=void 0;this._roomEngine=void 0;this._sessionDataManager=void 0;this._roomSessionManager=void 0;this._roomManager=void 0;this._cameraManager=void 0;this._soundManager=void 0;this._linkTrackers=void 0;this._workerTrackers=void 0;this._isReady=void 0;this._isDisposed=void 0;if(!Nitro.INSTANCE)Nitro.INSTANCE=this;this._nitroTimer=new NitroTimer();this._worker=null;this._core=core;this._events=new EventDispatcher();this._communication=new NitroCommunicationManager(core.communication);this._localization=new NitroLocalizationManager(this._communication);this._avatar=new AvatarRenderManager();this._roomEngine=new RoomEngine(this._communication);this._sessionDataManager=new SessionDataManager(this._communication);this._roomSessionManager=new RoomSessionManager(this._communication,this._roomEngine);this._roomManager=new RoomManager(this._roomEngine,this._roomEngine.visualizationFactory,this._roomEngine.logicFactory);this._cameraManager=new RoomCameraWidgetManager();this._soundManager=new SoundManager();this._linkTrackers=[];this._workerTrackers=[];this._isReady=false;this._isDisposed=false;this._core.configuration.events.addEventListener(ConfigurationEvent.LOADED,this.onConfigurationLoadedEvent.bind(this));this._roomEngine.events.addEventListener(RoomEngineEvent.ENGINE_INITIALIZED,this.onRoomEngineReady.bind(this));if(this._worker)this._worker.onmessage=this.createWorkerEvent.bind(this);}static bootstrap(){if(Nitro.INSTANCE){Nitro.INSTANCE.dispose();Nitro.INSTANCE=null;}const canvas=document.createElement('canvas');const instance=new this(new NitroCore(),{autoDensity:false,resolution:window.devicePixelRatio,width:window.innerWidth,height:window.innerHeight,view:canvas});canvas.addEventListener('webglcontextlost',()=>instance.events.dispatchEvent(new NitroEvent(Nitro.WEBGL_CONTEXT_LOST)));}init(){if(this._isReady||this._isDisposed)return;if(this._avatar)this._avatar.init();if(this._soundManager)this._soundManager.init();if(this._roomEngine){this._roomEngine.sessionDataManager=this._sessionDataManager;this._roomEngine.roomSessionManager=this._roomSessionManager;this._roomEngine.roomManager=this._roomManager;if(this._sessionDataManager)this._sessionDataManager.init();if(this._roomSessionManager)this._roomSessionManager.init();this._roomEngine.init();}if(!this._communication.connection){throw new Error('No connection found');}new GameMessageHandler(this._communication.connection);this._isReady=true;}dispose(){if(this._isDisposed)return;if(this._roomManager){this._roomManager.dispose();this._roomManager=null;}if(this._roomSessionManager){this._roomSessionManager.dispose();this._roomSessionManager=null;}if(this._sessionDataManager){this._sessionDataManager.dispose();this._sessionDataManager=null;}if(this._roomEngine){this._roomEngine.dispose();this._roomEngine=null;}if(this._avatar){this._avatar.dispose();this._avatar=null;}if(this._soundManager){this._soundManager.dispose();this._soundManager=null;}if(this._communication){this._communication.dispose();this._communication=null;}super.destroy();this._isDisposed=true;this._isReady=false;}onConfigurationLoadedEvent(event){const animationFPS=this.getConfiguration('system.animation.fps',24);const limitsFPS=this.getConfiguration('system.limits.fps',true);if(limitsFPS)Nitro.instance.ticker.maxFPS=animationFPS;}onRoomEngineReady(event){this.startSendingHeartBeat();}getConfiguration(key){let value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this._core.configuration.getValue(key,value);}getLocalization(key){return this._localization.getValue(key);}getLocalizationWithParameter(key,parameter,replacement){return this._localization.getValueWithParameter(key,parameter,replacement);}getLocalizationWithParameters(key,parameters,replacements){return this._localization.getValueWithParameters(key,parameters,replacements);}addWorkerEventTracker(tracker){if(this._workerTrackers.indexOf(tracker)>=0)return;this._workerTrackers.push(tracker);}removeWorkerEventTracker(tracker){const index=this._workerTrackers.indexOf(tracker);if(index===-1)return;this._workerTrackers.splice(index,1);}createWorkerEvent(message){if(!message)return;const data=message.data;for(const tracker of this._workerTrackers){if(!tracker)continue;tracker.workerMessageReceived(data);}}sendWorkerEvent(message){if(!message||!this._worker)return;this._worker.postMessage(message);}addLinkEventTracker(tracker){if(this._linkTrackers.indexOf(tracker)>=0)return;this._linkTrackers.push(tracker);}removeLinkEventTracker(tracker){const index=this._linkTrackers.indexOf(tracker);if(index===-1)return;this._linkTrackers.splice(index,1);}createLinkEvent(link){if(!link||link==='')return;for(const tracker of this._linkTrackers){if(!tracker)continue;const prefix=tracker.eventUrlPrefix;if(prefix.length>0){if(link.substr(0,prefix.length)===prefix)tracker.linkReceived(link);}else{tracker.linkReceived(link);}}}startSendingHeartBeat(){this.sendHeartBeat();setInterval(this.sendHeartBeat,10000);}sendHeartBeat(){HabboWebTools.sendHeartBeat();}setWorker(val){this._worker=val;this._worker.onmessage=this.createWorkerEvent.bind(this);}get nitroTimer(){return this._nitroTimer;}get core(){return this._core;}get events(){return this._events;}get localization(){return this._localization;}get communication(){return this._communication;}get avatar(){return this._avatar;}get roomEngine(){return this._roomEngine;}get sessionDataManager(){return this._sessionDataManager;}get roomSessionManager(){return this._roomSessionManager;}get roomManager(){return this._roomManager;}get cameraManager(){return this._cameraManager;}get soundManager(){return this._soundManager;}get width(){return this.renderer.width;}get height(){return this.renderer.height;}get ticker(){return Ticker.shared;}get time(){return this.ticker.lastTime;}get isReady(){return this._isReady;}get isDisposed(){return this._isDisposed;}static get instance(){return this.INSTANCE||null;}}Nitro.WEBGL_CONTEXT_LOST='NE_WEBGL_CONTEXT_LOST';Nitro.WEBGL_UNAVAILABLE='NE_WEBGL_UNAVAILABLE';Nitro.READY='NE_READY!';Nitro.INSTANCE=null;","map":null,"metadata":{},"sourceType":"module"}