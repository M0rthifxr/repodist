{"ast":null,"code":"import{NitroRectangle,TextureUtils}from'@nitrots/nitro-renderer';import{useCallback,useRef}from'react';import{GetRoomEngine,GetRoomSession,LocalizeText,NotificationUtilities,PlaySound,SoundNames}from'../../../../api';import{Column,DraggableWindow,Flex}from'../../../../common';import{useCameraWidgetContext}from'../../CameraWidgetContext';import{CameraPicture}from'../../common/CameraPicture';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const CAMERA_ROLL_LIMIT=5;export const CameraWidgetCaptureView=props=>{const{onClose=null,onEdit=null,onDelete=null}=props;const{cameraRoll=null,setCameraRoll=null,selectedPictureIndex=-1,setSelectedPictureIndex=null}=useCameraWidgetContext();const elementRef=useRef();const selectedPicture=selectedPictureIndex>-1?cameraRoll[selectedPictureIndex]:null;const getCameraBounds=useCallback(()=>{if(!elementRef||!elementRef.current)return null;const frameBounds=elementRef.current.getBoundingClientRect();return new NitroRectangle(Math.floor(frameBounds.x),Math.floor(frameBounds.y),Math.floor(frameBounds.width),Math.floor(frameBounds.height));},[]);const takePicture=useCallback(()=>{if(selectedPictureIndex>-1){setSelectedPictureIndex(-1);return;}const texture=GetRoomEngine().createTextureFromRoom(GetRoomSession().roomId,1,getCameraBounds());const clone=[...cameraRoll];if(clone.length>=CAMERA_ROLL_LIMIT){NotificationUtilities.simpleAlert(LocalizeText('camera.full.body'));clone.pop();}PlaySound(SoundNames.CAMERA_SHUTTER);clone.push(new CameraPicture(texture,TextureUtils.generateImageUrl(texture)));setCameraRoll(clone);},[cameraRoll,selectedPictureIndex,getCameraBounds,setCameraRoll,setSelectedPictureIndex]);return/*#__PURE__*/_jsx(DraggableWindow,{uniqueKey:\"nitro-camera-capture\",children:/*#__PURE__*/_jsxs(Column,{center:true,className:\"nitro-camera-capture\",gap:0,children:[selectedPicture&&/*#__PURE__*/_jsx(\"img\",{alt:\"\",className:\"camera-area\",src:selectedPicture.imageUrl}),/*#__PURE__*/_jsxs(\"div\",{className:\"camera-canvas drag-handler\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"position-absolute header-close\",onClick:onClose}),!selectedPicture&&/*#__PURE__*/_jsx(\"div\",{ref:elementRef,className:\"camera-area camera-view-finder\"}),selectedPicture&&/*#__PURE__*/_jsx(\"div\",{className:\"camera-area camera-frame\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"camera-frame-preview-actions w-100 position-absolute bottom-0 py-2 text-center\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-success me-3\",title:LocalizeText('camera.editor.button.tooltip'),onClick:onEdit,children:LocalizeText('camera.editor.button.text')}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-danger\",onClick:onDelete,children:LocalizeText('camera.delete.button.text')})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"camera-button\",title:LocalizeText('camera.take.photo.button.tooltip'),onClick:takePicture})})]}),cameraRoll.length>0&&/*#__PURE__*/_jsx(Flex,{gap:2,justifyContent:\"center\",className:\"camera-roll d-flex justify-content-center py-2\",children:cameraRoll.map((picture,index)=>{return/*#__PURE__*/_jsx(\"img\",{alt:\"\",src:picture.imageUrl,onClick:event=>setSelectedPictureIndex(index)},index);})})]})});};","map":null,"metadata":{},"sourceType":"module"}