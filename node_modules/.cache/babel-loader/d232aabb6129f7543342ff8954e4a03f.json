{"ast":null,"code":"import{NitroManager}from'../../core/common/NitroManager';import{FigureUpdateEvent,MysteryBoxKeysEvent}from'../communication';import{AvailabilityStatusMessageEvent}from'../communication/messages/incoming/availability/AvailabilityStatusMessageEvent';import{ChangeUserNameResultMessageEvent}from'../communication/messages/incoming/avatar/ChangeUserNameResultMessageEvent';import{NoobnessLevelMessageEvent}from'../communication/messages/incoming/handshake/NoobnessLevelMessageEvent';import{RoomReadyMessageEvent}from'../communication/messages/incoming/room/mapping/RoomReadyMessageEvent';import{UserPermissionsEvent}from'../communication/messages/incoming/user/access/UserPermissionsEvent';import{UserInfoEvent}from'../communication/messages/incoming/user/data/UserInfoEvent';import{UserNameChangeMessageEvent}from'../communication/messages/incoming/user/data/UserNameChangeMessageEvent';import{InClientLinkEvent}from'../communication/messages/incoming/user/InClientLinkEvent';import{PetRespectComposer}from'../communication/messages/outgoing/pet/PetRespectComposer';import{RoomUnitChatComposer}from'../communication/messages/outgoing/room/unit/chat/RoomUnitChatComposer';import{RoomUnitChatStyleComposer}from'../communication/messages/outgoing/room/unit/chat/RoomUnitChatStyleComposer';import{UserRespectComposer}from'../communication/messages/outgoing/user/UserRespectComposer';import{NitroSettingsEvent}from'../events/NitroSettingsEvent';import{Nitro}from'../Nitro';import{HabboWebTools}from'../utils/HabboWebTools';import{BadgeImageManager}from'./badge/BadgeImageManager';import{NoobnessLevelEnum}from'./enum/NoobnessLevelEnum';import{SecurityLevel}from'./enum/SecurityLevel';import{MysteryBoxKeysUpdateEvent}from'./events';import{SessionDataPreferencesEvent}from'./events/SessionDataPreferencesEvent';import{UserNameUpdateEvent}from'./events/UserNameUpdateEvent';import{FurnitureDataLoader}from'./furniture/FurnitureDataLoader';import{GroupInformationManager}from'./GroupInformationManager';import{IgnoredUsersManager}from'./IgnoredUsersManager';import{ProductDataLoader}from'./product/ProductDataLoader';export class SessionDataManager extends NitroManager{constructor(communication){super();this._communication=void 0;this._userId=void 0;this._name=void 0;this._figure=void 0;this._gender=void 0;this._realName=void 0;this._respectsReceived=void 0;this._respectsLeft=void 0;this._respectsPetLeft=void 0;this._canChangeName=void 0;this._ignoredUsersManager=void 0;this._groupInformationManager=void 0;this._clubLevel=void 0;this._securityLevel=void 0;this._isAmbassador=void 0;this._noobnessLevel=void 0;this._systemOpen=void 0;this._systemShutdown=void 0;this._isAuthenticHabbo=void 0;this._isRoomCameraFollowDisabled=void 0;this._chatStyle=void 0;this._uiFlags=void 0;this._floorItems=void 0;this._wallItems=void 0;this._products=void 0;this._furnitureData=void 0;this._productData=void 0;this._furnitureReady=void 0;this._productsReady=void 0;this._furnitureListenersNotified=void 0;this._pendingFurnitureListeners=void 0;this._pendingProductListeners=void 0;this._badgeImageManager=void 0;this._communication=communication;this.resetUserInfo();this._ignoredUsersManager=new IgnoredUsersManager(this);this._groupInformationManager=new GroupInformationManager(this);this._clubLevel=0;this._securityLevel=0;this._isAmbassador=false;this._noobnessLevel=-1;this._systemOpen=false;this._systemShutdown=false;this._isAuthenticHabbo=false;this._isRoomCameraFollowDisabled=false;this._chatStyle=0;this._uiFlags=0;this._floorItems=new Map();this._wallItems=new Map();this._products=new Map();this._furnitureData=null;this._furnitureReady=false;this._productsReady=false;this._furnitureListenersNotified=false;this._pendingFurnitureListeners=[];this._pendingProductListeners=[];this._badgeImageManager=null;this.onFurnitureDataReadyEvent=this.onFurnitureDataReadyEvent.bind(this);this.onProductDataReadyEvent=this.onProductDataReadyEvent.bind(this);this.onNitroSettingsEvent=this.onNitroSettingsEvent.bind(this);}onInit(){this.loadFurnitureData();this.loadProductData();this.loadBadgeImageManager();this._ignoredUsersManager&&this._ignoredUsersManager.init();this._groupInformationManager&&this._groupInformationManager.init();this._communication.registerMessageEvent(new FigureUpdateEvent(this.onUserFigureEvent.bind(this)));this._communication.registerMessageEvent(new UserInfoEvent(this.onUserInfoEvent.bind(this)));this._communication.registerMessageEvent(new UserPermissionsEvent(this.onUserPermissionsEvent.bind(this)));this._communication.registerMessageEvent(new AvailabilityStatusMessageEvent(this.onAvailabilityStatusMessageEvent.bind(this)));this._communication.registerMessageEvent(new ChangeUserNameResultMessageEvent(this.onChangeNameUpdateEvent.bind(this)));this._communication.registerMessageEvent(new UserNameChangeMessageEvent(this.onUserNameChangeMessageEvent.bind(this)));this._communication.registerMessageEvent(new RoomReadyMessageEvent(this.onRoomModelNameEvent.bind(this)));this._communication.registerMessageEvent(new InClientLinkEvent(this.onInClientLinkEvent.bind(this)));this._communication.registerMessageEvent(new MysteryBoxKeysEvent(this.onMysteryBoxKeysEvent.bind(this)));this._communication.registerMessageEvent(new NoobnessLevelMessageEvent(this.onNoobnessLevelMessageEvent.bind(this)));Nitro.instance.events.addEventListener(NitroSettingsEvent.SETTINGS_UPDATED,this.onNitroSettingsEvent);}onDispose(){this.destroyFurnitureData();if(this._ignoredUsersManager){this._ignoredUsersManager.dispose();this._ignoredUsersManager=null;}if(this._groupInformationManager){this._groupInformationManager.dispose();this._groupInformationManager=null;}Nitro.instance.events.removeEventListener(NitroSettingsEvent.SETTINGS_UPDATED,this.onNitroSettingsEvent);super.onDispose();}resetUserInfo(){this._userId=0;this._name=null;this._figure=null;this._gender=null;this._realName=null;this._canChangeName=false;}loadFurnitureData(){this.destroyFurnitureData();this._furnitureData=new FurnitureDataLoader(this._floorItems,this._wallItems,Nitro.instance.localization);this._furnitureData.addEventListener(FurnitureDataLoader.FURNITURE_DATA_READY,this.onFurnitureDataReadyEvent);this._furnitureData.loadFurnitureData(Nitro.instance.getConfiguration('furnidata.url'));}loadProductData(){this.destroyProductData();this._productData=new ProductDataLoader(this._products);this._productData.addEventListener(ProductDataLoader.PDP_PRODUCT_DATA_READY,this.onProductDataReadyEvent);this._productData.loadProductData(Nitro.instance.getConfiguration('productdata.url'));}loadBadgeImageManager(){if(this._badgeImageManager)return;this._badgeImageManager=new BadgeImageManager(Nitro.instance.core.asset,this);this._badgeImageManager.init();}hasProductData(listener){if(this._productsReady)return true;if(listener&&this._pendingProductListeners.indexOf(listener)===-1)this._pendingProductListeners.push(listener);return false;}getAllFurnitureData(listener){if(!this._furnitureReady){if(this._pendingFurnitureListeners.indexOf(listener)===-1)this._pendingFurnitureListeners.push(listener);return null;}const furnitureData=[];for(const data of this._floorItems.values()){if(!data)continue;furnitureData.push(data);}for(const data of this._wallItems.values()){if(!data)continue;furnitureData.push(data);}return furnitureData;}removePendingFurniDataListener(listener){if(!this._pendingFurnitureListeners)return;const index=this._pendingFurnitureListeners.indexOf(listener);if(index===-1)return;this._pendingFurnitureListeners.splice(index,1);}onUserFigureEvent(event){if(!event||!event.connection)return;this._figure=event.getParser().figure;this._gender=event.getParser().gender;HabboWebTools.updateFigure(this._figure);}onUserInfoEvent(event){if(!event||!event.connection)return;this.resetUserInfo();const userInfo=event.getParser().userInfo;if(!userInfo)return;this._userId=userInfo.userId;this._name=userInfo.username;this._figure=userInfo.figure;this._gender=userInfo.gender;this._realName=userInfo.realName;this._respectsReceived=userInfo.respectsReceived;this._respectsLeft=userInfo.respectsRemaining;this._respectsPetLeft=userInfo.respectsPetRemaining;this._canChangeName=userInfo.canChangeName;this._ignoredUsersManager&&this._ignoredUsersManager.requestIgnoredUsers();}onUserPermissionsEvent(event){if(!event||!event.connection)return;this._clubLevel=event.getParser().clubLevel;this._securityLevel=event.getParser().securityLevel;this._isAmbassador=event.getParser().isAmbassador;}onAvailabilityStatusMessageEvent(event){if(!event||!event.connection)return;const parser=event.getParser();if(!parser)return;this._systemOpen=parser.isOpen;this._systemShutdown=parser.onShutdown;this._isAuthenticHabbo=parser.isAuthenticUser;}onChangeNameUpdateEvent(event){if(!event||!event.connection)return;const parser=event.getParser();if(!parser)return;if(parser.resultCode!==ChangeUserNameResultMessageEvent.NAME_OK)return;this._canChangeName=false;this.events.dispatchEvent(new UserNameUpdateEvent(parser.name));}onUserNameChangeMessageEvent(event){if(!event||!event.connection)return;const parser=event.getParser();if(!parser)return;if(parser.webId!==this.userId)return;this._name=parser.newName;this._canChangeName=false;this.events.dispatchEvent(new UserNameUpdateEvent(this._name));}onRoomModelNameEvent(event){if(!event)return;const parser=event.getParser();if(!parser)return;HabboWebTools.roomVisited(parser.roomId);}onFurnitureDataReadyEvent(event){this._furnitureData.removeEventListener(FurnitureDataLoader.FURNITURE_DATA_READY,this.onFurnitureDataReadyEvent);this._furnitureReady=true;if(!this._furnitureListenersNotified){this._furnitureListenersNotified=true;if(this._pendingFurnitureListeners&&this._pendingFurnitureListeners.length){for(const listener of this._pendingFurnitureListeners)listener&&listener.loadFurnitureData();}}this._pendingProductListeners=[];}onProductDataReadyEvent(event){this._productData.removeEventListener(ProductDataLoader.PDP_PRODUCT_DATA_READY,this.onProductDataReadyEvent);this._productsReady=true;for(const listener of this._pendingProductListeners)listener&&listener.loadProductData();this._pendingProductListeners=[];}onInClientLinkEvent(event){if(!event)return;const parser=event.getParser();if(!parser)return;Nitro.instance.createLinkEvent(parser.link);}onMysteryBoxKeysEvent(event){if(!event)return;const parser=event.getParser();if(!parser)return;this.events.dispatchEvent(new MysteryBoxKeysUpdateEvent(parser.boxColor,parser.keyColor));}onNoobnessLevelMessageEvent(event){this._noobnessLevel=event.getParser().noobnessLevel;if(this._noobnessLevel!==NoobnessLevelEnum.OLD_IDENTITY){Nitro.instance.core.configuration.setValue('new.identity',1);}}onNitroSettingsEvent(event){this._isRoomCameraFollowDisabled=event.cameraFollow;this._chatStyle=event.chatType;this._uiFlags=event.flags;this.events.dispatchEvent(new SessionDataPreferencesEvent(this._uiFlags));}destroyFurnitureData(){if(!this._furnitureData)return;this._furnitureData.dispose();this._furnitureData=null;}destroyProductData(){if(!this._productData)return;this._productData.dispose();this._productData=null;}getFloorItemData(id){const existing=this._floorItems.get(id);if(!existing)return null;return existing;}getFloorItemDataByName(name){if(!name||!this._floorItems||!this._floorItems.size)return null;for(const item of this._floorItems.values()){if(!item||item.className!==name)continue;return item;}}getWallItemData(id){const existing=this._wallItems.get(id);if(!existing)return null;return existing;}getWallItemDataByName(name){if(!name||!this._wallItems||!this._wallItems.size)return null;for(const item of this._wallItems.values()){if(!item||item.className!==name)continue;return item;}}getProductData(type){if(!this._productsReady)this.loadProductData();return this._products.get(type);}getBadgeUrl(name){return this._badgeImageManager.getBadgeUrl(name);}getGroupBadgeUrl(name){return this._badgeImageManager.getBadgeUrl(name,BadgeImageManager.GROUP_BADGE);}getBadgeImage(name){return this._badgeImageManager.getBadgeImage(name);}getGroupBadgeImage(name){return this._badgeImageManager.getBadgeImage(name,BadgeImageManager.GROUP_BADGE);}loadBadgeImage(name){return this._badgeImageManager.loadBadgeImage(name);}loadGroupBadgeImage(name){return this._badgeImageManager.loadBadgeImage(name,BadgeImageManager.GROUP_BADGE);}hasSecurity(level){return this._securityLevel>=level;}giveRespect(userId){if(userId<0||this._respectsLeft<=0)return;this.send(new UserRespectComposer(userId));this._respectsLeft--;}givePetRespect(petId){if(petId<0||this._respectsPetLeft<=0)return;this.send(new PetRespectComposer(petId));this._respectsPetLeft--;}sendSpecialCommandMessage(text){let styleId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this.send(new RoomUnitChatComposer(text));}sendChatStyleUpdate(styleId){this._chatStyle=styleId;this.send(new RoomUnitChatStyleComposer(styleId));}ignoreUser(name){this._ignoredUsersManager&&this._ignoredUsersManager.ignoreUser(name);}unignoreUser(name){this._ignoredUsersManager&&this._ignoredUsersManager.unignoreUser(name);}isUserIgnored(name){return this._ignoredUsersManager&&this._ignoredUsersManager.isIgnored(name);}getGroupBadge(groupId){return this._groupInformationManager&&this._groupInformationManager.getGroupBadge(groupId);}send(composer){this._communication.connection.send(composer);}get communication(){return this._communication;}get userId(){return this._userId;}get userName(){return this._name;}get figure(){return this._figure;}get gender(){return this._gender;}get realName(){return this._realName;}get ignoredUsersManager(){return this._ignoredUsersManager;}get groupInformationManager(){return this._groupInformationManager;}get respectsReceived(){return this._respectsReceived;}get respectsLeft(){return this._respectsLeft;}get respectsPetLeft(){return this._respectsPetLeft;}get canChangeName(){return this._canChangeName;}get clubLevel(){return this._clubLevel;}get securityLevel(){return this._securityLevel;}get isAmbassador(){return this._isAmbassador;}get isNoob(){return this._noobnessLevel!==NoobnessLevelEnum.OLD_IDENTITY;}get isRealNoob(){return this._noobnessLevel===NoobnessLevelEnum.REAL_NOOB;}get isSystemOpen(){return this._systemOpen;}get isSystemShutdown(){return this._systemShutdown;}get isAuthenticHabbo(){return this._isAuthenticHabbo;}get isModerator(){return this._securityLevel>=SecurityLevel.MODERATOR;}get isCameraFollowDisabled(){return this._isRoomCameraFollowDisabled;}get chatStyle(){return this._chatStyle;}get uiFlags(){return this._uiFlags;}}","map":null,"metadata":{},"sourceType":"module"}