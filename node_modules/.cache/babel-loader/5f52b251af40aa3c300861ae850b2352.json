{"ast":null,"code":"import{GuideSessionGetRequesterRoomMessageComposer,GuideSessionInviteRequesterMessageComposer,GuideSessionMessageMessageComposer,GuideSessionRequesterRoomMessageEvent,GuideSessionResolvedMessageComposer}from'@nitrots/nitro-renderer';import{useCallback,useState}from'react';import{GetSessionDataManager,LocalizeText,SendMessageComposer,TryVisitRoom}from'../../../api';import{Base,Button,ButtonGroup,Column,Flex,LayoutAvatarImageView,Text}from'../../../common';import{UseMessageEventHook}from'../../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const GuideToolOngoingView=props=>{const{isGuide=false,userId=0,userName=null,userFigure=null,isTyping=false,messageGroups=[]}=props;const[messageText,setMessageText]=useState('');const visit=useCallback(()=>{SendMessageComposer(new GuideSessionGetRequesterRoomMessageComposer());},[]);const invite=useCallback(()=>{SendMessageComposer(new GuideSessionInviteRequesterMessageComposer());},[]);const resolve=useCallback(()=>{SendMessageComposer(new GuideSessionResolvedMessageComposer());},[]);const onGuideSessionRequesterRoomMessageEvent=useCallback(event=>{const parser=event.getParser();TryVisitRoom(parser.requesterRoomId);},[]);UseMessageEventHook(GuideSessionRequesterRoomMessageEvent,onGuideSessionRequesterRoomMessageEvent);const sendMessage=useCallback(()=>{if(!messageText||!messageText.length)return;SendMessageComposer(new GuideSessionMessageMessageComposer(messageText));setMessageText('');},[messageText]);const onKeyDown=useCallback(event=>{if(event.key!=='Enter')return;sendMessage();},[sendMessage]);const isOwnChat=useCallback(userId=>{return userId===GetSessionDataManager().userId;},[]);return/*#__PURE__*/_jsxs(Column,{fullHeight:true,children:[/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"between\",gap:1,className:\"bg-muted p-2 rounded\",children:[isGuide&&/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{onClick:visit,children:LocalizeText('guide.help.request.guide.ongoing.visit.button')}),/*#__PURE__*/_jsx(Button,{disabled:true,onClick:invite,children:LocalizeText('guide.help.request.guide.ongoing.invite.button')})]}),!isGuide&&/*#__PURE__*/_jsxs(Column,{gap:0,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:userName}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('guide.help.request.user.ongoing.guide.desc')})]}),/*#__PURE__*/_jsx(Button,{variant:\"danger\",disabled:true,children:LocalizeText('guide.help.common.report.link')})]}),/*#__PURE__*/_jsx(Column,{overflow:\"hidden\",gap:1,className:\"bg-muted rounded chat-messages p-2\",children:/*#__PURE__*/_jsx(Column,{overflow:\"auto\",children:messageGroups.map((group,index)=>{return/*#__PURE__*/_jsxs(Flex,{fullWidth:true,justifyContent:isOwnChat(group.userId)?'end':'start',gap:2,children:[/*#__PURE__*/_jsx(Base,{shrink:true,className:\"message-avatar\",children:!isOwnChat(group.userId)&&/*#__PURE__*/_jsx(LayoutAvatarImageView,{figure:userFigure,direction:2})}),/*#__PURE__*/_jsxs(Base,{className:'bg-light text-black border-radius mb-2 rounded py-1 px-2 messages-group-'+(isOwnChat(group.userId)?'right':'left'),children:[/*#__PURE__*/_jsxs(Text,{bold:true,children:[isOwnChat(group.userId)&&GetSessionDataManager().userName,!isOwnChat(group.userId)&&userName]}),group.messages.map((chat,index)=>/*#__PURE__*/_jsx(Base,{className:\"text-break\",children:chat.message},index))]}),isOwnChat(group.userId)&&/*#__PURE__*/_jsx(Base,{className:\"message-avatar flex-shrink-0\",children:/*#__PURE__*/_jsx(LayoutAvatarImageView,{figure:GetSessionDataManager().figure,direction:4})})]},index);})})}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-sm\",placeholder:LocalizeText('guide.help.request.guide.ongoing.input.empty',['name'],[userName]),value:messageText,onChange:event=>setMessageText(event.target.value),onKeyDown:onKeyDown}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:sendMessage,children:LocalizeText('widgets.chatinput.say')})]}),isTyping&&/*#__PURE__*/_jsx(Text,{variant:\"muted\",children:LocalizeText('guide.help.common.typing')})]}),/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"success\",onClick:resolve,children:LocalizeText('guide.help.request.'+(isGuide?'guide':'user')+'.ongoing.close.link')})]});};","map":null,"metadata":{},"sourceType":"module"}