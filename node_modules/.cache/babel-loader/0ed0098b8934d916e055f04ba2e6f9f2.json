{"ast":null,"code":"import{RoomEngineObjectEvent,RoomObjectCategory,RoomObjectType}from'@nitrots/nitro-renderer';import{useCallback,useReducer,useRef,useState}from'react';import{GetRoomSession,GetSessionDataManager}from'../../api';import{Base,DraggableWindowPosition,NitroCardContentView,NitroCardHeaderView,NitroCardView}from'../../common';import{ButtonModtool}from'../../common/ButtonModtool';import{ModToolsEvent,ModToolsOpenRoomChatlogEvent,ModToolsOpenRoomInfoEvent,ModToolsOpenUserInfoEvent}from'../../events';import{DispatchUiEvent,UseRoomEngineEvent,UseUiEvent}from'../../hooks';import{ModToolsContextProvider}from'./ModToolsContext';import{ModToolsMessageHandler}from'./ModToolsMessageHandler';import{initialModTools,ModToolsActions,ModToolsReducer}from'./reducers/ModToolsReducer';import{ModToolsChatlogView}from'./views/room/ModToolsChatlogView';import{ModToolsRoomView}from'./views/room/ModToolsRoomView';import{ModToolsTicketsView}from'./views/tickets/ModToolsTicketsView';import{ModToolsUserChatlogView}from'./views/user/ModToolsUserChatlogView';import{ModToolsUserView}from'./views/user/ModToolsUserView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const ModToolsView=props=>{const[isVisible,setIsVisible]=useState(true);const[selectedUser,setSelectedUser]=useState(null);const[isTicketsVisible,setIsTicketsVisible]=useState(false);const[modToolsState,dispatchModToolsState]=useReducer(ModToolsReducer,initialModTools);const{currentRoomId=null,openRooms=null,openRoomChatlogs=null,openUserChatlogs=null,openUserInfo=null}=modToolsState;const elementRef=useRef(null);const isMod=GetSessionDataManager().isModerator;const onModToolsEvent=useCallback(event=>{switch(event.type){case ModToolsEvent.SHOW_MOD_TOOLS:setIsVisible(true);return;case ModToolsEvent.HIDE_MOD_TOOLS:setIsVisible(false);return;case ModToolsEvent.TOGGLE_MOD_TOOLS:setIsVisible(value=>!value);return;}},[]);UseUiEvent(ModToolsEvent.SHOW_MOD_TOOLS,onModToolsEvent);UseUiEvent(ModToolsEvent.HIDE_MOD_TOOLS,onModToolsEvent);UseUiEvent(ModToolsEvent.TOGGLE_MOD_TOOLS,onModToolsEvent);const onRoomEngineObjectEvent=useCallback(event=>{if(event.category!==RoomObjectCategory.UNIT)return;const roomSession=GetRoomSession();if(!roomSession)return;const userData=roomSession.userDataManager.getUserDataByIndex(event.objectId);if(!userData||userData.type!==RoomObjectType.USER)return;setSelectedUser({userId:userData.webID,username:userData.name});},[]);UseRoomEngineEvent(RoomEngineObjectEvent.SELECTED,onRoomEngineObjectEvent);const handleClick=useCallback((action,value)=>{if(!action)return;switch(action){case'toggle_room':{if(!openRooms){DispatchUiEvent(new ModToolsOpenRoomInfoEvent(currentRoomId));return;}if(openRooms.indexOf(currentRoomId)>-1){handleClick('close_room',currentRoomId.toString());}else{DispatchUiEvent(new ModToolsOpenRoomInfoEvent(currentRoomId));}return;}case'close_room':{const itemIndex=openRooms.indexOf(Number(value));const clone=Array.from(openRooms);clone.splice(itemIndex,1);dispatchModToolsState({type:ModToolsActions.SET_OPEN_ROOMS,payload:{openRooms:clone}});return;}case'toggle_room_chatlog':{if(!openRoomChatlogs){DispatchUiEvent(new ModToolsOpenRoomChatlogEvent(currentRoomId));return;}if(openRoomChatlogs.indexOf(currentRoomId)>-1){handleClick('close_room_chatlog',currentRoomId.toString());}else{DispatchUiEvent(new ModToolsOpenRoomChatlogEvent(currentRoomId));}return;}case'close_room_chatlog':{const itemIndex=openRoomChatlogs.indexOf(Number(value));const clone=Array.from(openRoomChatlogs);clone.splice(itemIndex,1);dispatchModToolsState({type:ModToolsActions.SET_OPEN_ROOM_CHATLOGS,payload:{openRoomChatlogs:clone}});return;}case'toggle_user_info':{if(!selectedUser)return;const userId=selectedUser.userId;if(!openUserInfo){DispatchUiEvent(new ModToolsOpenUserInfoEvent(userId));return;}if(openUserInfo.indexOf(userId)>-1){handleClick('close_user_info',userId.toString());}else{DispatchUiEvent(new ModToolsOpenUserInfoEvent(userId));}return;}case'close_user_info':{const itemIndex=openUserInfo.indexOf(Number(value));const clone=Array.from(openUserInfo);clone.splice(itemIndex,1);dispatchModToolsState({type:ModToolsActions.SET_OPEN_USERINFO,payload:{openUserInfo:clone}});return;}case'close_user_chatlog':{const itemIndex=openUserChatlogs.indexOf(Number(value));const clone=Array.from(openUserChatlogs);clone.splice(itemIndex,1);dispatchModToolsState({type:ModToolsActions.SET_OPEN_USER_CHATLOGS,payload:{openUserChatlogs:clone}});return;}}},[openRooms,currentRoomId,openRoomChatlogs,selectedUser,openUserInfo,openUserChatlogs]);return/*#__PURE__*/_jsxs(ModToolsContextProvider,{value:{modToolsState,dispatchModToolsState},children:[/*#__PURE__*/_jsx(ModToolsMessageHandler,{}),isVisible&&isMod&&/*#__PURE__*/_jsxs(NitroCardView,{uniqueKey:\"mod-tools\",className:\"nitro-mod-tools\",windowPosition:DraggableWindowPosition.TOP_LEFT,theme:\"primary-modtool\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:'Mod Tools',onCloseClick:event=>setIsVisible(false)}),/*#__PURE__*/_jsxs(NitroCardContentView,{className:\"text-black pb-3 pt-2\",gap:3,children:[/*#__PURE__*/_jsxs(ButtonModtool,{gap:1,onClick:event=>handleClick('toggle_room'),disabled:!currentRoomId,className:\"position-relative\",children:[/*#__PURE__*/_jsx(Base,{className:\"icon icon-small-room position-absolute start-1\"}),\" Room tool\"]}),/*#__PURE__*/_jsxs(ButtonModtool,{innerRef:elementRef,gap:1,onClick:event=>handleClick('toggle_room_chatlog'),disabled:!currentRoomId,className:\"position-relative\",children:[/*#__PURE__*/_jsx(Base,{className:\"icon icon-chat-history position-absolute start-1\"}),\" Chatlog Tool\"]}),/*#__PURE__*/_jsxs(ButtonModtool,{gap:1,onClick:()=>handleClick('toggle_user_info'),disabled:!selectedUser,className:\"position-relative\",children:[/*#__PURE__*/_jsx(Base,{className:\"icon icon-user position-absolute start-1\"}),\" User: \",selectedUser?selectedUser.username:'']}),/*#__PURE__*/_jsxs(ButtonModtool,{gap:1,onClick:()=>setIsTicketsVisible(value=>!value),className:\"position-relative\",children:[/*#__PURE__*/_jsx(Base,{className:\"icon icon-tickets position-absolute start-1\"}),\" Report Tool\"]})]})]}),openRooms&&openRooms.map(roomId=>{return/*#__PURE__*/_jsx(ModToolsRoomView,{roomId:roomId,onCloseClick:()=>handleClick('close_room',roomId.toString())},roomId);}),openRoomChatlogs&&openRoomChatlogs.map(roomId=>{return/*#__PURE__*/_jsx(ModToolsChatlogView,{roomId:roomId,onCloseClick:()=>handleClick('close_room_chatlog',roomId.toString())},roomId);}),openUserInfo&&openUserInfo.map(userId=>{return/*#__PURE__*/_jsx(ModToolsUserView,{userId:userId,onCloseClick:()=>handleClick('close_user_info',userId.toString())},userId);}),openUserChatlogs&&openUserChatlogs.map(userId=>{return/*#__PURE__*/_jsx(ModToolsUserChatlogView,{userId:userId,onCloseClick:()=>handleClick('close_user_chatlog',userId.toString())},userId);}),isTicketsVisible&&/*#__PURE__*/_jsx(ModToolsTicketsView,{onCloseClick:()=>setIsTicketsVisible(false)})]});};","map":null,"metadata":{},"sourceType":"module"}