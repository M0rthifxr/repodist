{"ast":null,"code":"import{CancelMarketplaceOfferMessageComposer,GetMarketplaceOwnOffersMessageComposer,MarketplaceCancelOfferResultEvent,MarketplaceOwnOffersEvent,RedeemMarketplaceOfferCreditsMessageComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{LocalizeText,NotificationAlertType,NotificationUtilities,SendMessageComposer}from'../../../../../../api';import{Button,Column,Text}from'../../../../../../common';import{UseMessageEventHook}from'../../../../../../hooks';import{CatalogLayoutMarketplaceItemView,OWN_OFFER}from'./CatalogLayoutMarketplaceItemView';import{MarketplaceOfferData}from'./common/MarketplaceOfferData';import{MarketPlaceOfferState}from'./common/MarketplaceOfferState';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const CatalogLayoutMarketplaceOwnItemsView=props=>{const[creditsWaiting,setCreditsWaiting]=useState(0);const[offers,setOffers]=useState([]);const onMarketPlaceOwnOffersEvent=useCallback(event=>{const parser=event.getParser();if(!parser)return;const offers=parser.offers.map(offer=>{const newOffer=new MarketplaceOfferData(offer.offerId,offer.furniId,offer.furniType,offer.extraData,offer.stuffData,offer.price,offer.status,offer.averagePrice,offer.offerCount);newOffer.timeLeftMinutes=offer.timeLeftMinutes;return newOffer;});setCreditsWaiting(parser.creditsWaiting);setOffers(offers);},[]);UseMessageEventHook(MarketplaceOwnOffersEvent,onMarketPlaceOwnOffersEvent);const onMarketplaceCancelOfferResultEvent=useCallback(event=>{const parser=event.getParser();if(!parser)return;if(!parser.success){NotificationUtilities.simpleAlert(LocalizeText('catalog.marketplace.cancel_failed'),NotificationAlertType.DEFAULT,null,null,LocalizeText('catalog.marketplace.operation_failed.topic'));return;}setOffers(prevValue=>prevValue.filter(value=>value.offerId!==parser.offerId));},[]);UseMessageEventHook(MarketplaceCancelOfferResultEvent,onMarketplaceCancelOfferResultEvent);const soldOffers=useMemo(()=>{return offers.filter(value=>value.status===MarketPlaceOfferState.SOLD);},[offers]);const redeemSoldOffers=useCallback(()=>{setOffers(prevValue=>{const idsToDelete=soldOffers.map(value=>value.offerId);return prevValue.filter(value=>idsToDelete.indexOf(value.offerId)===-1);});SendMessageComposer(new RedeemMarketplaceOfferCreditsMessageComposer());},[soldOffers]);const takeItemBack=offerData=>{SendMessageComposer(new CancelMarketplaceOfferMessageComposer(offerData.offerId));};useEffect(()=>{SendMessageComposer(new GetMarketplaceOwnOffersMessageComposer());},[]);return/*#__PURE__*/_jsxs(Column,{overflow:\"hidden\",children:[creditsWaiting<=0&&/*#__PURE__*/_jsx(Text,{center:true,className:\"bg-muted rounded p-1\",children:LocalizeText('catalog.marketplace.redeem.no_sold_items')}),creditsWaiting>0&&/*#__PURE__*/_jsxs(Column,{center:true,gap:1,className:\"bg-muted rounded p-2\",children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('catalog.marketplace.redeem.get_credits',['count','credits'],[soldOffers.length.toString(),creditsWaiting.toString()])}),/*#__PURE__*/_jsx(Button,{className:\"mt-1\",onClick:redeemSoldOffers,children:LocalizeText('catalog.marketplace.offer.redeem')})]}),/*#__PURE__*/_jsxs(Column,{gap:1,overflow:\"hidden\",children:[/*#__PURE__*/_jsx(Text,{truncate:true,shrink:true,fontWeight:\"bold\",children:LocalizeText('catalog.marketplace.items_found',['count'],[offers.length.toString()])}),/*#__PURE__*/_jsx(Column,{overflow:\"auto\",className:\"nitro-catalog-layout-marketplace-grid\",children:offers.length>0&&offers.map(offer=>/*#__PURE__*/_jsx(CatalogLayoutMarketplaceItemView,{offerData:offer,type:OWN_OFFER,onClick:takeItemBack},offer.offerId))})]})]});};","map":null,"metadata":{},"sourceType":"module"}