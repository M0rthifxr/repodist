{"ast":null,"code":"import{ConvertGlobalRoomIdMessageComposer,HabboWebTools,LegacyExternalInterface,NavigatorInitComposer,NavigatorSearchComposer,RoomSessionEvent}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useRef,useState}from'react';import{AddEventLinkTracker,DoorStateType,LocalizeText,RemoveLinkEventTracker,SendMessageComposer,TryVisitRoom}from'../../api';import{Base,Column,NitroCardContentView,NitroCardHeaderView,NitroCardTabsItemView,NitroCardTabsView,Text,NitroCardView,Flex}from'../../common';import{UseRoomSessionManagerEvent,useSharedNavigatorData}from'../../hooks';import{NavigatorContextProvider}from'./NavigatorContext';import{NavigatorMessageHandler}from'./NavigatorMessageHandler';import{NavigatorDoorStateView}from'./views/NavigatorDoorStateView';import{NavigatorRoomCreatorView}from'./views/NavigatorRoomCreatorView';import{NavigatorRoomInfoView}from'./views/NavigatorRoomInfoView';import{NavigatorRoomLinkView}from'./views/NavigatorRoomLinkView';import{NavigatorRoomSettingsView}from'./views/room-settings/NavigatorRoomSettingsView';import{NavigatorSearchResultView}from'./views/search/NavigatorSearchResultView';import{NavigatorSearchView}from'./views/search/NavigatorSearchView';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const NavigatorView=props=>{const[isVisible,setIsVisible]=useState(false);const[isReady,setIsReady]=useState(false);const[isCreatorOpen,setCreatorOpen]=useState(false);const[isRoomInfoOpen,setRoomInfoOpen]=useState(false);const[isRoomLinkOpen,setRoomLinkOpen]=useState(false);const[isLoading,setIsLoading]=useState(false);const[needsInit,setNeedsInit]=useState(true);const[needsSearch,setNeedsSearch]=useState(false);const[categories,setCategories]=useState(null);const[topLevelContext,setTopLevelContext]=useState(null);const[topLevelContexts,setTopLevelContexts]=useState(null);const[navigatorData,setNavigatorData]=useSharedNavigatorData();const[doorData,setDoorData]=useState({roomInfo:null,state:DoorStateType.NONE});const[searchResult,setSearchResult]=useState(null);const pendingSearch=useRef(null);const onRoomSessionEvent=useCallback(event=>{switch(event.type){case RoomSessionEvent.CREATED:setIsVisible(false);setCreatorOpen(false);return;}},[]);UseRoomSessionManagerEvent(RoomSessionEvent.CREATED,onRoomSessionEvent);const sendSearch=useCallback((searchValue,contextCode)=>{SendMessageComposer(new NavigatorSearchComposer(contextCode,searchValue));setIsLoading(true);},[]);const reloadCurrentSearch=useCallback(()=>{if(!isReady){setNeedsSearch(true);return;}if(pendingSearch.current){sendSearch(pendingSearch.current.value,pendingSearch.current.code);pendingSearch.current=null;return;}if(searchResult){sendSearch(searchResult.data,searchResult.code);return;}if(!topLevelContext)return;sendSearch('',topLevelContext.code);},[isReady,searchResult,topLevelContext,sendSearch]);const linkReceived=useCallback(url=>{const parts=url.split('/');if(parts.length<2)return;switch(parts[1]){case'show':{setIsVisible(true);setNeedsSearch(true);return;}case'hide':setIsVisible(false);return;case'toggle':{if(isVisible){setIsVisible(false);return;}setIsVisible(true);setNeedsSearch(true);return;}case'toggle-room-info':setRoomInfoOpen(value=>!value);return;case'toggle-room-link':setRoomLinkOpen(value=>!value);return;case'goto':if(parts.length<=2)return;switch(parts[2]){case'home':if(navigatorData.homeRoomId<=0)return;TryVisitRoom(navigatorData.homeRoomId);break;default:{const roomId=parseInt(parts[2]);TryVisitRoom(roomId);}}return;case'create':setCreatorOpen(value=>!value);return;case'close-creator':setCreatorOpen(false);return;case'search':if(parts.length>2){const topLevelContextCode=parts[2];let searchValue='';if(parts.length>3)searchValue=parts[3];pendingSearch.current={value:searchValue,code:topLevelContextCode};setIsVisible(true);setNeedsSearch(true);}return;}},[isVisible,navigatorData]);useEffect(()=>{const linkTracker={linkReceived,eventUrlPrefix:'navigator/'};AddEventLinkTracker(linkTracker);return()=>RemoveLinkEventTracker(linkTracker);},[linkReceived]);useEffect(()=>{if(!searchResult)return;setIsLoading(false);},[searchResult]);useEffect(()=>{if(!isVisible||!isReady||!needsSearch)return;reloadCurrentSearch();setNeedsSearch(false);},[isVisible,isReady,needsSearch,reloadCurrentSearch]);useEffect(()=>{if(isReady||!topLevelContext)return;setIsReady(true);},[isReady,topLevelContext]);useEffect(()=>{if(!isVisible||!needsInit)return;SendMessageComposer(new NavigatorInitComposer());setNeedsInit(false);},[isVisible,needsInit]);useEffect(()=>{LegacyExternalInterface.addCallback(HabboWebTools.OPENROOM,function(k){let _arg_2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let _arg_3=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return SendMessageComposer(new ConvertGlobalRoomIdMessageComposer(k));});},[]);return/*#__PURE__*/_jsxs(NavigatorContextProvider,{value:{categories,setCategories,topLevelContext,setTopLevelContext,topLevelContexts,setTopLevelContexts,navigatorData,setNavigatorData,doorData,setDoorData,searchResult,setSearchResult},children:[/*#__PURE__*/_jsx(NavigatorMessageHandler,{}),isVisible&&/*#__PURE__*/_jsxs(NitroCardView,{uniqueKey:\"navigator\",className:\"nitro-navigator\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('navigator.title'),onCloseClick:event=>setIsVisible(false)}),/*#__PURE__*/_jsx(NitroCardTabsView,{children:topLevelContexts&&topLevelContexts.length>0&&topLevelContexts.map((context,index)=>{return/*#__PURE__*/_jsx(NitroCardTabsItemView,{isActive:topLevelContext===context,onClick:event=>sendSearch('',context.code),children:LocalizeText('navigator.toplevelview.'+context.code)},index);})}),/*#__PURE__*/_jsxs(NitroCardContentView,{position:\"relative\",children:[isLoading&&/*#__PURE__*/_jsx(Base,{fit:true,position:\"absolute\",className:\"top-0 start-0 z-index-1 bg-muted opacity-0-5\"}),/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NavigatorSearchView,{sendSearch:sendSearch}),/*#__PURE__*/_jsx(Column,{overflow:\"auto\",children:searchResult&&searchResult.results.map((result,index)=>/*#__PURE__*/_jsx(NavigatorSearchResultView,{searchResult:result},index))})]}),/*#__PURE__*/_jsx(Flex,{className:\"nav-bottom\",children:/*#__PURE__*/_jsxs(Flex,{className:\"nav-bottom-buttons position-absolute\",children:[/*#__PURE__*/_jsx(Flex,{className:\"nav-create-room\",onClick:event=>setCreatorOpen(value=>!value),children:/*#__PURE__*/_jsx(Text,{variant:\"white\",bold:true,className:\"nav-bottom-buttons-text\",children:LocalizeText('navigator.createroom.create')})}),/*#__PURE__*/_jsx(Flex,{className:\"nav-random-room\",children:/*#__PURE__*/_jsx(Text,{variant:\"white\",bold:true,className:\"nav-bottom-buttons-text\",children:LocalizeText('navigator.random.room')})})]})})]})]}),isCreatorOpen&&/*#__PURE__*/_jsx(NavigatorRoomCreatorView,{}),/*#__PURE__*/_jsx(NavigatorDoorStateView,{}),isRoomInfoOpen&&/*#__PURE__*/_jsx(NavigatorRoomInfoView,{onCloseClick:()=>setRoomInfoOpen(false)}),isRoomLinkOpen&&/*#__PURE__*/_jsx(NavigatorRoomLinkView,{onCloseClick:()=>setRoomLinkOpen(false)}),/*#__PURE__*/_jsx(NavigatorRoomSettingsView,{})]});};","map":null,"metadata":{},"sourceType":"module"}