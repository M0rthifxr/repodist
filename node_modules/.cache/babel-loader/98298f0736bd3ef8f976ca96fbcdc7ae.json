{"ast":null,"code":"import{RoomObjectCategory,RoomObjectOperationType}from'@nitrots/nitro-renderer';import{useCallback,useMemo,useState}from'react';import{CreateLinkEvent,GetRoomEngine,GetSessionDataManager,LocalizeText,ProductTypeEnum,RoomWidgetPresentOpenMessage,RoomWidgetUpdatePresentDataEvent,RoomWidgetUpdateRoomObjectEvent}from'../../../../../api';import{Button,Column,Flex,LayoutGiftTagView,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../../../../common';import{UseEventDispatcherHook}from'../../../../../hooks/events/UseEventDispatcherHook';import{useRoomContext}from'../../../RoomContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const FLOOR='floor';const WALLPAPER='wallpaper';const LANDSCAPE='landscape';const ACTION_GIVE_GIFT=0;const ACTION_OPEN=1;const ACTION_PLACE=2;const ACTION_INVENTORY=3;export const FurnitureGiftOpeningView=props=>{const[objectId,setObjectId]=useState(-1);const[classId,setClassId]=useState(-1);const[itemType,setItemType]=useState(null);const[text,setText]=useState(null);const[isOwnerOfFurniture,setIsOwnerOfFurniture]=useState(false);const[senderName,setSenderName]=useState(null);const[senderFigure,setSenderFigure]=useState(null);const[placedItemId,setPlacedItemId]=useState(-1);const[placedItemType,setPlacedItemType]=useState(null);const[placedInRoom,setPlacedInRoom]=useState(false);const[imageUrl,setImageUrl]=useState(null);const[openRequested,setOpenRequested]=useState(false);const{roomSession=null,eventDispatcher=null,widgetHandler=null}=useRoomContext();const clearGift=useCallback(()=>{if(!openRequested)setObjectId(-1);setText(null);setIsOwnerOfFurniture(false);},[openRequested]);const getGiftImageUrl=useCallback(name=>{return'';},[]);const onRoomWidgetUpdatePresentDataEvent=useCallback(event=>{switch(event.type){case RoomWidgetUpdatePresentDataEvent.PACKAGEINFO:{setOpenRequested(false);setObjectId(event.objectId);setText(event.giftMessage);setIsOwnerOfFurniture(event.isController);setSenderName(event.purchaserName);setSenderFigure(event.purchaserFigure);setImageUrl(event.imageUrl);return;}case RoomWidgetUpdatePresentDataEvent.CONTENTS_FLOOR:case RoomWidgetUpdatePresentDataEvent.CONTENTS_LANDSCAPE:case RoomWidgetUpdatePresentDataEvent.CONTENTS_WALLPAPER:{let imageType=null;if(event.type===RoomWidgetUpdatePresentDataEvent.CONTENTS_FLOOR)imageType='packagecard_icon_floor';else if(event.type===RoomWidgetUpdatePresentDataEvent.CONTENTS_LANDSCAPE)imageType='packagecard_icon_landscape';else if(event.type===RoomWidgetUpdatePresentDataEvent.CONTENTS_WALLPAPER)imageType='packagecard_icon_wallpaper';setObjectId(event.objectId);setClassId(event.classId);setItemType(event.itemType);setText(event.giftMessage);setIsOwnerOfFurniture(event.isController);setPlacedItemId(event.placedItemId);setPlacedItemType(event.placedItemType);setPlacedInRoom(event.placedInRoom);setImageUrl(getGiftImageUrl(imageType));return;}case RoomWidgetUpdatePresentDataEvent.CONTENTS_CLUB:{setObjectId(event.objectId);setClassId(event.classId);setItemType(event.itemType);setText(event.giftMessage);setIsOwnerOfFurniture(event.isController);setImageUrl(getGiftImageUrl('packagecard_icon_hc'));return;}case RoomWidgetUpdatePresentDataEvent.CONTENTS:{if(!openRequested)return;setObjectId(event.objectId);setClassId(event.classId);setItemType(event.itemType);setText(event.giftMessage);setIsOwnerOfFurniture(event.isController);setPlacedItemId(event.placedItemId);setPlacedItemType(event.placedItemType);setPlacedInRoom(event.placedInRoom);setImageUrl(event.imageUrl);return;}case RoomWidgetUpdatePresentDataEvent.CONTENTS_IMAGE:{if(!openRequested)return;setImageUrl(event.imageUrl);}}},[openRequested,getGiftImageUrl]);UseEventDispatcherHook(RoomWidgetUpdatePresentDataEvent.PACKAGEINFO,eventDispatcher,onRoomWidgetUpdatePresentDataEvent);UseEventDispatcherHook(RoomWidgetUpdatePresentDataEvent.CONTENTS,eventDispatcher,onRoomWidgetUpdatePresentDataEvent);UseEventDispatcherHook(RoomWidgetUpdatePresentDataEvent.CONTENTS_FLOOR,eventDispatcher,onRoomWidgetUpdatePresentDataEvent);UseEventDispatcherHook(RoomWidgetUpdatePresentDataEvent.CONTENTS_LANDSCAPE,eventDispatcher,onRoomWidgetUpdatePresentDataEvent);UseEventDispatcherHook(RoomWidgetUpdatePresentDataEvent.CONTENTS_WALLPAPER,eventDispatcher,onRoomWidgetUpdatePresentDataEvent);UseEventDispatcherHook(RoomWidgetUpdatePresentDataEvent.CONTENTS_CLUB,eventDispatcher,onRoomWidgetUpdatePresentDataEvent);UseEventDispatcherHook(RoomWidgetUpdatePresentDataEvent.CONTENTS_IMAGE,eventDispatcher,onRoomWidgetUpdatePresentDataEvent);const onRoomWidgetRoomObjectUpdateEvent=useCallback(event=>{if(event.id===objectId)clearGift();if(event.id===placedItemId){if(placedInRoom)setPlacedInRoom(false);}},[objectId,placedItemId,placedInRoom,clearGift]);UseEventDispatcherHook(RoomWidgetUpdateRoomObjectEvent.FURNI_REMOVED,eventDispatcher,onRoomWidgetRoomObjectUpdateEvent);const close=useCallback(()=>{setObjectId(-1);setOpenRequested(false);setPlacedItemId(-1);setPlacedInRoom(false);setText(null);setIsOwnerOfFurniture(false);},[]);const isSpaces=useMemo(()=>{if(itemType!==ProductTypeEnum.WALL)return false;const furniData=GetSessionDataManager().getWallItemData(classId);if(!furniData)return false;const className=furniData.className;return className===FLOOR||className===LANDSCAPE||className===WALLPAPER;},[classId,itemType]);const productName=useMemo(()=>{if(objectId===-1)return'';if(isSpaces)return'widget.furni.present.spaces.message_opened';return'widget.furni.present.message_opened';},[objectId,isSpaces]);const handleAction=useCallback(action=>{switch(action){case ACTION_GIVE_GIFT:CreateLinkEvent('catalog/open');return;case ACTION_OPEN:setOpenRequested(true);widgetHandler.processWidgetMessage(new RoomWidgetPresentOpenMessage(RoomWidgetPresentOpenMessage.OPEN_PRESENT,objectId));return;case ACTION_PLACE:return;case ACTION_INVENTORY:if(placedItemId>0&&placedInRoom){if(placedItemType===ProductTypeEnum.PET){roomSession.pickupPet(placedItemId);}else{const roomObject=GetRoomEngine().getRoomObject(roomSession.roomId,placedItemId,RoomObjectCategory.FLOOR);if(roomObject)GetRoomEngine().processRoomObjectOperation(roomObject.id,RoomObjectCategory.FLOOR,RoomObjectOperationType.OBJECT_PICKUP);}}close();return;}},[roomSession,widgetHandler,objectId,placedInRoom,placedItemId,placedItemType,close]);if(objectId===-1)return null;return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-gift-opening\",theme:\"primary\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText(senderName?'widget.furni.present.window.title_from':'widget.furni.present.window.title',['name'],[senderName]),onCloseClick:close}),/*#__PURE__*/_jsxs(NitroCardContentView,{center:true,children:[placedItemId===-1&&/*#__PURE__*/_jsxs(Column,{overflow:\"hidden\",children:[/*#__PURE__*/_jsx(Flex,{center:true,overflow:\"auto\",children:/*#__PURE__*/_jsx(LayoutGiftTagView,{userName:senderName,figure:senderFigure,message:text})}),/*#__PURE__*/_jsxs(Flex,{gap:1,children:[senderName&&/*#__PURE__*/_jsx(Button,{fullWidth:true,onClick:event=>handleAction(ACTION_GIVE_GIFT),children:LocalizeText('widget.furni.present.give_gift',['name'],[senderName])}),/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"success\",onClick:event=>handleAction(ACTION_OPEN),children:LocalizeText('widget.furni.present.open_gift')})]})]}),placedItemId>-1&&/*#__PURE__*/_jsxs(Column,{overflow:\"hidden\",children:[/*#__PURE__*/_jsxs(Flex,{center:true,overflow:\"auto\",gap:2,children:[/*#__PURE__*/_jsx(\"img\",{src:imageUrl,className:\"no-select\",alt:\"\"}),/*#__PURE__*/_jsx(Text,{wrap:true,children:LocalizeText(productName,['product'],[text])})]}),/*#__PURE__*/_jsxs(Column,{grow:true,gap:1,children:[/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Button,{fullWidth:true,onClick:event=>handleAction(ACTION_INVENTORY),children:LocalizeText('widget.furni.present.put_in_inventory')}),/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"success\",onClick:event=>handleAction(ACTION_PLACE),children:LocalizeText(placedInRoom?'widget.furni.present.keep_in_room':'widget.furni.present.place_in_room')})]}),senderName&&senderName.length&&/*#__PURE__*/_jsx(Button,{fullWidth:true,onClick:event=>handleAction(ACTION_GIVE_GIFT),children:LocalizeText('widget.furni.present.give_gift',['name'],[senderName])})]})]})]})]});};","map":null,"metadata":{},"sourceType":"module"}