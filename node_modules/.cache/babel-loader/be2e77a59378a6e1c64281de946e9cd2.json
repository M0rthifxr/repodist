{"ast":null,"code":"import{CameraPublishStatusMessageEvent,CameraPurchaseOKMessageEvent,CameraStorageUrlMessageEvent,PublishPhotoMessageComposer,PurchasePhotoMessageComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{CreateLinkEvent,GetConfiguration,GetRoomEngine,LocalizeText,SendMessageComposer}from'../../../../api';import{Button,Column,Flex,LayoutCurrencyIcon,LayoutImage,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../../../common';import{UseMessageEventHook}from'../../../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const CameraWidgetCheckoutView=props=>{const{base64Url=null,onCloseClick=null,onCancelClick=null,price=null}=props;const[pictureUrl,setPictureUrl]=useState(null);const[publishUrl,setPublishUrl]=useState(null);const[picturesBought,setPicturesBought]=useState(0);const[wasPicturePublished,setWasPicturePublished]=useState(false);const[isWaiting,setIsWaiting]=useState(false);const[publishCooldown,setPublishCooldown]=useState(0);const publishDisabled=useMemo(()=>GetConfiguration('camera.publish.disabled',false),[]);const onCameraPurchaseOKMessageEvent=useCallback(event=>{setPicturesBought(value=>value+1);setIsWaiting(false);},[]);UseMessageEventHook(CameraPurchaseOKMessageEvent,onCameraPurchaseOKMessageEvent);const onCameraPublishStatusMessageEvent=useCallback(event=>{const parser=event.getParser();setPublishUrl(parser.extraDataId);setPublishCooldown(parser.secondsToWait);setWasPicturePublished(parser.ok);setIsWaiting(false);},[]);UseMessageEventHook(CameraPublishStatusMessageEvent,onCameraPublishStatusMessageEvent);const onCameraStorageUrlMessageEvent=useCallback(event=>{const parser=event.getParser();setPictureUrl(GetConfiguration('camera.url')+'/'+parser.url);},[]);UseMessageEventHook(CameraStorageUrlMessageEvent,onCameraStorageUrlMessageEvent);const processAction=function(type){let value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;switch(type){case'close':onCloseClick();return;case'buy':if(isWaiting)return;setIsWaiting(true);SendMessageComposer(new PurchasePhotoMessageComposer(''));return;case'publish':if(isWaiting)return;setIsWaiting(true);SendMessageComposer(new PublishPhotoMessageComposer());return;case'cancel':onCancelClick();return;}};useEffect(()=>{if(!base64Url)return;GetRoomEngine().saveBase64AsScreenshot(base64Url);},[base64Url]);if(!price)return null;return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-camera-checkout\",theme:\"primary\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('camera.confirm_phase.title'),onCloseClick:event=>processAction('close')}),/*#__PURE__*/_jsxs(NitroCardContentView,{children:[/*#__PURE__*/_jsxs(Flex,{center:true,children:[pictureUrl&&pictureUrl.length&&/*#__PURE__*/_jsx(LayoutImage,{className:\"picture-preview border\",imageUrl:pictureUrl}),(!pictureUrl||!pictureUrl.length)&&/*#__PURE__*/_jsx(Flex,{center:true,className:\"picture-preview border\",children:/*#__PURE__*/_jsx(Text,{bold:true,children:LocalizeText('camera.loading')})})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",alignItems:\"center\",className:\"bg-muted rounded p-2\",children:[/*#__PURE__*/_jsxs(Column,{size:publishDisabled?10:6,gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:LocalizeText('camera.purchase.header')}),(price.credits>0||price.duckets>0)&&/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('catalog.purchase.confirmation.dialog.cost')}),price.credits>0&&/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:price.credits}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:-1})]}),price.duckets>0&&/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:price.duckets}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:5})]})]}),picturesBought>0&&/*#__PURE__*/_jsxs(Text,{children:[/*#__PURE__*/_jsx(Text,{bold:true,children:LocalizeText('camera.purchase.count.info')}),\" \",picturesBought,/*#__PURE__*/_jsx(\"u\",{className:\"ms-1 cursor-pointer\",onClick:()=>CreateLinkEvent('inventory/toggle'),children:LocalizeText('camera.open.inventory')})]})]}),/*#__PURE__*/_jsx(Flex,{alignItems:\"center\",children:/*#__PURE__*/_jsx(Button,{variant:\"success\",disabled:isWaiting,onClick:event=>processAction('buy'),children:LocalizeText(!picturesBought?'buy':'camera.buy.another.button.text')})})]}),!publishDisabled&&/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",alignItems:\"center\",className:\"bg-muted rounded p-2\",children:[/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:LocalizeText(wasPicturePublished?'camera.publish.successful':'camera.publish.explanation')}),/*#__PURE__*/_jsx(Text,{children:LocalizeText(wasPicturePublished?'camera.publish.success.short.info':'camera.publish.detailed.explanation')}),wasPicturePublished&&/*#__PURE__*/_jsx(\"a\",{href:publishUrl,rel:\"noreferrer\",target:\"_blank\",children:LocalizeText('camera.link.to.published')}),!wasPicturePublished&&price.publishDucketPrice>0&&/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('catalog.purchase.confirmation.dialog.cost')}),/*#__PURE__*/_jsxs(Flex,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:price.publishDucketPrice}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:5})]})]}),publishCooldown>0&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-1 text-center fw-bold\",children:LocalizeText('camera.publish.wait',['minutes'],[Math.ceil(publishCooldown/60).toString()])})]}),!wasPicturePublished&&/*#__PURE__*/_jsx(Flex,{className:\"d-flex align-items-end\",children:/*#__PURE__*/_jsx(Button,{variant:\"success\",disabled:isWaiting||publishCooldown>0,onClick:event=>processAction('publish'),children:LocalizeText('camera.publish.button.text')})})]}),/*#__PURE__*/_jsx(Text,{center:true,children:LocalizeText('camera.warning.disclaimer')}),/*#__PURE__*/_jsx(Flex,{justifyContent:\"end\",children:/*#__PURE__*/_jsx(Button,{onClick:event=>processAction('cancel'),children:LocalizeText('generic.cancel')})})]})]});};","map":null,"metadata":{},"sourceType":"module"}