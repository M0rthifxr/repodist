{"ast":null,"code":"import{Nitro}from'../../../../Nitro';import{RoomObjectVariable}from'../../RoomObjectVariable';import{FurnitureVisualization}from'./FurnitureVisualization';export class FurnitureBrandedImageVisualization extends FurnitureVisualization{constructor(){super();this._imageUrl=void 0;this._shortUrl=void 0;this._imageReady=void 0;this._isAnimated=void 0;this._gifCollection=void 0;this._offsetX=void 0;this._offsetY=void 0;this._offsetZ=void 0;this._currentFrame=void 0;this._totalFrames=void 0;this._imageUrl=null;this._shortUrl=null;this._imageReady=false;this._isAnimated=false;this._gifCollection=null;this._offsetX=0;this._offsetY=0;this._offsetZ=0;this._currentFrame=-1;this._totalFrames=-1;}dispose(){super.dispose();if(this._imageUrl){this.asset&&this.asset.disposeAsset(this._imageUrl);// dispose all\n}}updateObject(scale,direction){if(!super.updateObject(scale,direction))return false;if(this._imageReady)this.checkAndCreateImageForCurrentState();return true;}updateModel(scale){const flag=super.updateModel(scale);if(flag){this._offsetX=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_OFFSET_X)||0;this._offsetY=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_OFFSET_Y)||0;this._offsetZ=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_OFFSET_Z)||0;this._isAnimated=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_IS_ANIMATED)||false;}if(!this._imageReady){this._imageReady=this.checkIfImageReady();if(this._imageReady){this.checkAndCreateImageForCurrentState();return true;}}else{if(this.checkIfImageChanged()){this._imageReady=false;this._imageUrl=null;return true;}}return flag;}checkIfImageChanged(){const imageUrl=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_URL);if(imageUrl&&imageUrl===this._imageUrl)return false;if(this._gifCollection){//\n}this.asset&&this.asset.disposeAsset(this._imageUrl);// dispose all\nreturn true;}checkIfImageReady(){const model=this.object&&this.object.model;if(!model)return false;const imageUrl=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_URL);if(!imageUrl)return false;if(this._imageUrl&&this._imageUrl===imageUrl)return false;const imageStatus=this.object.model.getValue(RoomObjectVariable.FURNITURE_BRANDING_IMAGE_STATUS);if(imageStatus===1){let texture=null;if(this._isAnimated){const gifCollection=Nitro.instance.roomEngine.roomContentLoader.getGifCollection(imageUrl);if(gifCollection){this._gifCollection=gifCollection;texture=gifCollection.textures[0];}}else{texture=Nitro.instance.core.asset.getTexture(imageUrl);}if(!texture)return false;this.imageReady(texture,imageUrl);return true;}return false;}imageReady(texture,imageUrl){if(!texture){this._imageUrl=null;return;}this._imageUrl=imageUrl;}checkAndCreateImageForCurrentState(){if(this._isAnimated){this.buildAssetsForGif();return;}if(!this._imageUrl)return;const texture=Nitro.instance.core.asset.getTexture(this._imageUrl);if(!texture)return;const state=this.object.getState(0);this.addBackgroundAsset(texture,state,0);}buildAssetsForGif(){if(!this._gifCollection)return;const textures=this._gifCollection.textures;const durations=this._gifCollection.durations;if(!textures.length||!durations.length||textures.length!==durations.length)return;const state=this.object.getState(0);for(let i=0;i<textures.length;i++){const texture=textures[i];const duration=durations[i];if(!texture)continue;this.addBackgroundAsset(texture,state,i);}this._currentFrame=-1;this._totalFrames=textures.length;}addBackgroundAsset(texture,state,frame){let x=0;let y=0;let flipH=false;let flipV=false;switch(state){case FurnitureBrandedImageVisualization.STATE_0:x=0;y=0;flipH=false;flipV=false;break;case FurnitureBrandedImageVisualization.STATE_1:x=-texture.width;y=0;flipH=true;flipV=false;break;case FurnitureBrandedImageVisualization.STATE_2:x=-texture.width;y=-texture.height;flipH=true;flipV=true;break;case FurnitureBrandedImageVisualization.STATE_3:x=0;y=-texture.height;flipH=false;flipV=true;break;}this.asset.addAsset(`${this._imageUrl}_${frame}`,texture,true,x,y,flipH,flipV);}getSpriteAssetName(scale,layerId){const tag=this.getLayerTag(scale,this._direction,layerId);if(tag===FurnitureBrandedImageVisualization.BRANDED_IMAGE&&this._imageUrl){return`${this._imageUrl}_${this.getFrameNumber(scale,layerId)}`;}return super.getSpriteAssetName(scale,layerId);}updateAnimation(scale){if(!this._imageReady||!this._isAnimated||this._totalFrames<=0)return 0;return 1;}getFrameNumber(scale,layerId){if(!this._imageReady||!this._isAnimated||this._totalFrames<=0)return 0;const tag=this.getLayerTag(scale,this._direction,layerId);if(tag===FurnitureBrandedImageVisualization.BRANDED_IMAGE&&this._imageUrl){let newFrame=this._currentFrame;if(newFrame<0){newFrame=0;}else{newFrame+=1;}if(newFrame===this._totalFrames)newFrame=0;this._currentFrame=newFrame;return this._currentFrame;}return 0;}}FurnitureBrandedImageVisualization.BRANDED_IMAGE='branded_image';FurnitureBrandedImageVisualization.STATE_0=0;FurnitureBrandedImageVisualization.STATE_1=1;FurnitureBrandedImageVisualization.STATE_2=2;FurnitureBrandedImageVisualization.STATE_3=3;","map":null,"metadata":{},"sourceType":"module"}