{"ast":null,"code":"import{Graphics}from'@pixi/graphics';import{Vector3d}from'../../../../../../../room/utils/Vector3d';import{PlaneVisualizationAnimationLayer}from'../animated/PlaneVisualizationAnimationLayer';import{PlaneVisualizationLayer}from'./PlaneVisualizationLayer';export class PlaneVisualization{constructor(size,totalLayers,geometry){this._layers=void 0;this._geometry=void 0;this._cachedBitmapData=void 0;this._cachedBitmapNormal=void 0;this._isCached=void 0;this._hasAnimationLayers=void 0;this._layers=[];this._geometry=geometry;this._cachedBitmapData=null;this._cachedBitmapNormal=new Vector3d();this._isCached=false;this._hasAnimationLayers=false;if(totalLayers<0)totalLayers=0;let index=0;while(index<totalLayers){this._layers.push(null);index++;}}get geometry(){return this._geometry;}get hasAnimationLayers(){return this._hasAnimationLayers;}dispose(){if(this._layers&&this._layers.length){for(const layer of this._layers){if(!layer)continue;layer.dispose();}this._layers=null;}this._geometry=null;if(this._cachedBitmapData){this._cachedBitmapData.destroy();this._cachedBitmapData=null;}if(this._cachedBitmapNormal)this._cachedBitmapNormal=null;}clearCache(){if(!this._isCached)return;if(this._cachedBitmapData){this._cachedBitmapData.destroy();this._cachedBitmapData=null;}if(this._cachedBitmapNormal){this._cachedBitmapNormal.assign(new Vector3d());}if(this._layers&&this._layers.length){for(const layer of this._layers){if(!layer)continue;const planeLayer=layer;planeLayer.clearCache();}}this._isCached=false;}setLayer(layerId,material,color,align){let offset=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;if(layerId<0||layerId>this._layers.length)return false;let layer=this._layers[layerId];if(layer)layer.dispose();layer=new PlaneVisualizationLayer(material,color,align,offset);this._layers[layerId]=layer;return true;}setAnimationLayer(layerId,animationItems,collection){if(layerId<0||layerId>this._layers.length)return false;let layer=this._layers[layerId];if(layer)layer.dispose();layer=new PlaneVisualizationAnimationLayer(animationItems,collection);this._layers[layerId]=layer;this._hasAnimationLayers=true;return true;}getLayers(){return this._layers;}render(canvas,width,height,normal,useTexture){let offsetX=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;let offsetY=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;let maxX=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;let maxY=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;let dimensionX=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;let dimensionY=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;let timeSinceStartMs=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;if(width<1)width=1;if(height<1)height=1;if(!canvas||canvas.width!==width||canvas.height!==height)canvas=null;if(this._cachedBitmapData){if(this._cachedBitmapData.width===width&&this._cachedBitmapData.height===height&&Vector3d.isEqual(this._cachedBitmapNormal,normal)){if(!this.hasAnimationLayers){if(canvas){canvas.addChild(this._cachedBitmapData);return canvas;// const texture = TextureUtils.generateTexture(this._cachedBitmapData, new Rectangle(0, 0, width, height));\n// if(texture)\n// {\n//     canvas\n//         .beginTextureFill({ texture })\n//         .drawRect(0, 0, texture.width, texture.height)\n//         .endFill();\n//     return canvas;\n// }\n}return this._cachedBitmapData;}}else{this._cachedBitmapData.destroy();this._cachedBitmapData=null;}}this._isCached=true;if(!this._cachedBitmapData){this._cachedBitmapData=new Graphics().beginFill(0xFFFFFF).drawRect(0,0,width,height).endFill();}else{this._cachedBitmapData.beginFill(0xFFFFFF).drawRect(0,0,width,height).endFill();}if(!canvas)canvas=this._cachedBitmapData;this._cachedBitmapNormal.assign(normal);if(this._layers&&this._layers.length){for(const layer of this._layers){if(!layer)continue;if(layer instanceof PlaneVisualizationLayer){layer.render(canvas,width,height,normal,useTexture,offsetX,offsetY);}else if(layer instanceof PlaneVisualizationAnimationLayer){layer.render(canvas,width,height,normal,offsetX,offsetY,maxX,maxY,dimensionX,dimensionY,timeSinceStartMs);}}}if(canvas&&canvas!==this._cachedBitmapData){this._cachedBitmapData.addChild(canvas.clone());// const texture = TextureUtils.generateTexture(canvas, new Rectangle(0, 0, canvas.width, canvas.height));\n// this._cachedBitmapData\n//     .beginTextureFill({ texture })\n//     .drawRect(0, 0, canvas.width, canvas.height)\n//     .endFill();\nreturn canvas;}return this._cachedBitmapData;}}","map":null,"metadata":{},"sourceType":"module"}