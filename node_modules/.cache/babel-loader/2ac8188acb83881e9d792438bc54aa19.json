{"ast":null,"code":"import{Point}from'@pixi/math';import{Vector3d}from'./Vector3d';export class RoomGeometry{constructor(scale,direction,location){let _arg_4=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;this._updateId=0;this._x=void 0;this._y=void 0;this._z=void 0;this._directionAxis=void 0;this._location=void 0;this._direction=void 0;this._depth=void 0;this._scale=1;this._x_scale=1;this._y_scale=1;this._z_scale=1;this._x_scale_internal=1;this._y_scale_internal=1;this._z_scale_internal=1;this._loc=void 0;this._dir=void 0;this._clipNear=-500;this._clipFar=500;this._displacements=null;this.scale=scale;this._x=new Vector3d();this._y=new Vector3d();this._z=new Vector3d();this._directionAxis=new Vector3d();this._location=new Vector3d();this._direction=new Vector3d();this._depth=new Vector3d();this._x_scale_internal=1;this._y_scale_internal=1;this.x_scale=1;this.y_scale=1;this._z_scale_internal=Math.sqrt(1/2)/Math.sqrt(3/4);this.z_scale=1;this.location=new Vector3d(location.x,location.y,location.z);this.direction=new Vector3d(direction.x,direction.y,direction.z);if(_arg_4!=null){this.setDepthVector(_arg_4);}else{this.setDepthVector(direction);}this._displacements=new Map();}static getIntersectionVector(k,_arg_2,_arg_3,_arg_4){const _local_5=Vector3d.dotProduct(_arg_2,_arg_4);if(Math.abs(_local_5)<1E-5){return null;}const _local_6=Vector3d.dif(k,_arg_3);const _local_7=-Vector3d.dotProduct(_arg_4,_local_6)/_local_5;const _local_8=Vector3d.sum(k,Vector3d.product(_arg_2,_local_7));return _local_8;}get updateId(){return this._updateId;}get scale(){return this._scale/Math.sqrt(0.5);}set scale(k){if(k<=1){k=1;}k=k*Math.sqrt(0.5);if(k!=this._scale){this._scale=k;this._updateId++;}}get directionAxis(){return this._directionAxis;}get location(){this._location.assign(this._loc);this._location.x=this._location.x*this._x_scale;this._location.y=this._location.y*this._y_scale;this._location.z=this._location.z*this._z_scale;return this._location;}set location(k){if(k==null){return;}if(this._loc==null){this._loc=new Vector3d();}const _local_2=this._loc.x;const _local_3=this._loc.y;const _local_4=this._loc.z;this._loc.assign(k);this._loc.x=this._loc.x/this._x_scale;this._loc.y=this._loc.y/this._y_scale;this._loc.z=this._loc.z/this._z_scale;if(!(this._loc.x==_local_2)||!(this._loc.y==_local_3)||!(this._loc.z==_local_4)){this._updateId++;}}get direction(){return this._direction;}set direction(k){let _local_21;let _local_22;let _local_23;let _local_24;let _local_25;if(k==null){return;}if(this._dir==null){this._dir=new Vector3d();}const _local_2=this._dir.x;const _local_3=this._dir.y;const _local_4=this._dir.z;this._dir.assign(k);this._direction.assign(k);if(!(this._dir.x==_local_2)||!(this._dir.y==_local_3)||!(this._dir.z==_local_4)){this._updateId++;}const _local_5=new Vector3d(0,1,0);const _local_6=new Vector3d(0,0,1);const _local_7=new Vector3d(1,0,0);const _local_8=k.x/180*Math.PI;const _local_9=k.y/180*Math.PI;const _local_10=k.z/180*Math.PI;const _local_11=Math.cos(_local_8);const _local_12=Math.sin(_local_8);const _local_13=Vector3d.sum(Vector3d.product(_local_5,_local_11),Vector3d.product(_local_7,-_local_12));const _local_14=new Vector3d(_local_6.x,_local_6.y,_local_6.z);const _local_15=Vector3d.sum(Vector3d.product(_local_5,_local_12),Vector3d.product(_local_7,_local_11));const _local_16=Math.cos(_local_9);const _local_17=Math.sin(_local_9);const _local_18=new Vector3d(_local_13.x,_local_13.y,_local_13.z);const _local_19=Vector3d.sum(Vector3d.product(_local_14,_local_16),Vector3d.product(_local_15,_local_17));const _local_20=Vector3d.sum(Vector3d.product(_local_14,-_local_17),Vector3d.product(_local_15,_local_16));if(_local_10!=0){_local_21=Math.cos(_local_10);_local_22=Math.sin(_local_10);_local_23=Vector3d.sum(Vector3d.product(_local_18,_local_21),Vector3d.product(_local_19,_local_22));_local_24=Vector3d.sum(Vector3d.product(_local_18,-_local_22),Vector3d.product(_local_19,_local_21));_local_25=new Vector3d(_local_20.x,_local_20.y,_local_20.z);this._x.assign(_local_23);this._y.assign(_local_24);this._z.assign(_local_25);this._directionAxis.assign(this._z);}else{this._x.assign(_local_18);this._y.assign(_local_19);this._z.assign(_local_20);this._directionAxis.assign(this._z);}}set x_scale(k){if(this._x_scale!=k*this._x_scale_internal){this._x_scale=k*this._x_scale_internal;this._updateId++;}}set y_scale(k){if(this._y_scale!=k*this._y_scale_internal){this._y_scale=k*this._y_scale_internal;this._updateId++;}}set z_scale(k){if(this._z_scale!=k*this._z_scale_internal){this._z_scale=k*this._z_scale_internal;this._updateId++;}}dispose(){this._x=null;this._y=null;this._z=null;this._loc=null;this._dir=null;this._directionAxis=null;this._location=null;if(this._displacements!=null){this._displacements.clear();this._displacements=null;}}setDisplacement(k,_arg_2){let _local_3;let _local_4;if(k==null||_arg_2==null){return;}if(this._displacements!=null){_local_3=Math.trunc(Math.round(k.x))+'_'+Math.trunc(Math.round(k.y))+'_'+Math.trunc(Math.round(k.z));this._displacements.delete(_local_3);_local_4=new Vector3d();_local_4.assign(_arg_2);this._displacements.set(_local_3,_local_4);this._updateId++;}}getDisplacenent(k){let _local_2;if(this._displacements!=null){_local_2=Math.trunc(Math.round(k.x))+'_'+Math.trunc(Math.round(k.y))+'_'+Math.trunc(Math.round(k.z));return this._displacements.get(_local_2);}return null;}setDepthVector(k){let _local_18;let _local_19;let _local_20;let _local_21;let _local_22;const _local_2=new Vector3d(0,1,0);const _local_3=new Vector3d(0,0,1);const _local_4=new Vector3d(1,0,0);const _local_5=k.x/180*Math.PI;const _local_6=k.y/180*Math.PI;const _local_7=k.z/180*Math.PI;const _local_8=Math.cos(_local_5);const _local_9=Math.sin(_local_5);const _local_10=Vector3d.sum(Vector3d.product(_local_2,_local_8),Vector3d.product(_local_4,-_local_9));const _local_11=new Vector3d(_local_3.x,_local_3.y,_local_3.z);const _local_12=Vector3d.sum(Vector3d.product(_local_2,_local_9),Vector3d.product(_local_4,_local_8));const _local_13=Math.cos(_local_6);const _local_14=Math.sin(_local_6);const _local_15=new Vector3d(_local_10.x,_local_10.y,_local_10.z);const _local_16=Vector3d.sum(Vector3d.product(_local_11,_local_13),Vector3d.product(_local_12,_local_14));const _local_17=Vector3d.sum(Vector3d.product(_local_11,-_local_14),Vector3d.product(_local_12,_local_13));if(_local_7!=0){_local_18=Math.cos(_local_7);_local_19=Math.sin(_local_7);_local_20=Vector3d.sum(Vector3d.product(_local_15,_local_18),Vector3d.product(_local_16,_local_19));_local_21=Vector3d.sum(Vector3d.product(_local_15,-_local_19),Vector3d.product(_local_16,_local_18));_local_22=new Vector3d(_local_17.x,_local_17.y,_local_17.z);this._depth.assign(_local_22);}else{this._depth.assign(_local_17);}this._updateId++;}adjustLocation(k,_arg_2){if(k==null||this._z==null){return;}const _local_3=Vector3d.product(this._z,-_arg_2);const _local_4=new Vector3d(k.x+_local_3.x,k.y+_local_3.y,k.z+_local_3.z);this.location=_local_4;}getCoordinatePosition(k){if(k==null){return null;}const _local_2=Vector3d.scalarProjection(k,this._x);const _local_3=Vector3d.scalarProjection(k,this._y);const _local_4=Vector3d.scalarProjection(k,this._z);const _local_5=new Vector3d(_local_2,_local_3,_local_4);return _local_5;}getScreenPosition(k){let _local_2=Vector3d.dif(k,this._loc);_local_2.x=_local_2.x*this._x_scale;_local_2.y=_local_2.y*this._y_scale;_local_2.z=_local_2.z*this._z_scale;let _local_3=Vector3d.scalarProjection(_local_2,this._depth);if(_local_3<this._clipNear||_local_3>this._clipFar){return null;}let _local_4=Vector3d.scalarProjection(_local_2,this._x);let _local_5=-Vector3d.scalarProjection(_local_2,this._y);_local_4=_local_4*this._scale;_local_5=_local_5*this._scale;const _local_6=this.getDisplacenent(k);if(_local_6!=null){_local_2=Vector3d.dif(k,this._loc);_local_2.add(_local_6);_local_2.x=_local_2.x*this._x_scale;_local_2.y=_local_2.y*this._y_scale;_local_2.z=_local_2.z*this._z_scale;_local_3=Vector3d.scalarProjection(_local_2,this._depth);}_local_2.x=_local_4;_local_2.y=_local_5;_local_2.z=_local_3;return _local_2;}getScreenPoint(k){const _local_2=this.getScreenPosition(k);if(_local_2==null){return null;}const _local_3=new Point(_local_2.x,_local_2.y);return _local_3;}getPlanePosition(k,_arg_2,_arg_3,_arg_4){let _local_15;let _local_16;const _local_5=k.x/this._scale;const _local_6=-k.y/this._scale;const _local_7=Vector3d.product(this._x,_local_5);_local_7.add(Vector3d.product(this._y,_local_6));const _local_8=new Vector3d(this._loc.x*this._x_scale,this._loc.y*this._y_scale,this._loc.z*this._z_scale);_local_8.add(_local_7);const _local_9=this._z;const _local_10=new Vector3d(_arg_2.x*this._x_scale,_arg_2.y*this._y_scale,_arg_2.z*this._z_scale);const _local_11=new Vector3d(_arg_3.x*this._x_scale,_arg_3.y*this._y_scale,_arg_3.z*this._z_scale);const _local_12=new Vector3d(_arg_4.x*this._x_scale,_arg_4.y*this._y_scale,_arg_4.z*this._z_scale);const _local_13=Vector3d.crossProduct(_local_11,_local_12);const _local_14=new Vector3d();_local_14.assign(RoomGeometry.getIntersectionVector(_local_8,_local_9,_local_10,_local_13));if(_local_14!=null){_local_14.subtract(_local_10);_local_15=Vector3d.scalarProjection(_local_14,_arg_3)/_local_11.length*_arg_3.length;_local_16=Vector3d.scalarProjection(_local_14,_arg_4)/_local_12.length*_arg_4.length;return new Point(_local_15,_local_16);}return null;}performZoom(){if(this.isZoomedIn()){this.scale=RoomGeometry.SCALE_ZOOMED_OUT;}else{this.scale=RoomGeometry.SCALE_ZOOMED_IN;}}isZoomedIn(){return this.scale==RoomGeometry.SCALE_ZOOMED_IN;}performZoomOut(){this.scale=RoomGeometry.SCALE_ZOOMED_OUT;}performZoomIn(){this.scale=RoomGeometry.SCALE_ZOOMED_IN;}}RoomGeometry.SCALE_ZOOMED_IN=64;RoomGeometry.SCALE_ZOOMED_OUT=32;","map":null,"metadata":{},"sourceType":"module"}