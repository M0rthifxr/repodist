{"ast":null,"code":"import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{GroupAdminGiveComposer,GroupAdminTakeComposer,GroupConfirmMemberRemoveEvent,GroupConfirmRemoveMemberComposer,GroupMembersComposer,GroupMembersEvent,GroupMembershipAcceptComposer,GroupMembershipDeclineComposer,GroupRank,GroupRemoveMemberComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{AddEventLinkTracker,GetSessionDataManager,GetUserProfile,LocalizeText,NotificationUtilities,RemoveLinkEventTracker,SendMessageComposer}from'../../../api';import{Base,Button,Column,Flex,Grid,LayoutAvatarImageView,LayoutBadgeImageView,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../../common';import{UseMessageEventHook}from'../../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const GroupMembersView=props=>{const[groupId,setGroupId]=useState(-1);const[levelId,setLevelId]=useState(-1);const[membersData,setMembersData]=useState(null);const[pageId,setPageId]=useState(-1);const[totalPages,setTotalPages]=useState(0);const[searchQuery,setSearchQuery]=useState('');const[removingMemberName,setRemovingMemberName]=useState(null);const getRankDescription=member=>{if(member.rank===GroupRank.OWNER)return'group.members.owner';if(membersData.admin){if(member.rank===GroupRank.ADMIN)return'group.members.removerights';if(member.rank===GroupRank.MEMBER)return'group.members.giverights';}return'';};const refreshMembers=useCallback(()=>{if(groupId===-1||levelId===-1||pageId===-1)return;SendMessageComposer(new GroupMembersComposer(groupId,pageId,searchQuery,levelId));},[groupId,levelId,pageId,searchQuery]);const toggleAdmin=member=>{if(!membersData.admin||member.rank===GroupRank.OWNER)return;if(member.rank!==GroupRank.ADMIN)SendMessageComposer(new GroupAdminGiveComposer(membersData.groupId,member.id));else SendMessageComposer(new GroupAdminTakeComposer(membersData.groupId,member.id));refreshMembers();};const acceptMembership=member=>{if(!membersData.admin||member.rank!==GroupRank.REQUESTED)return;SendMessageComposer(new GroupMembershipAcceptComposer(membersData.groupId,member.id));refreshMembers();};const removeMemberOrDeclineMembership=member=>{if(!membersData.admin)return;if(member.rank===GroupRank.REQUESTED){SendMessageComposer(new GroupMembershipDeclineComposer(membersData.groupId,member.id));refreshMembers();return;}setRemovingMemberName(member.name);SendMessageComposer(new GroupConfirmRemoveMemberComposer(membersData.groupId,member.id));};const onGroupMembersEvent=useCallback(event=>{const parser=event.getParser();setMembersData(parser);setLevelId(parser.level);setTotalPages(Math.ceil(parser.totalMembersCount/parser.pageSize));},[]);UseMessageEventHook(GroupMembersEvent,onGroupMembersEvent);const onGroupConfirmMemberRemoveEvent=useCallback(event=>{const parser=event.getParser();NotificationUtilities.confirm(LocalizeText(parser.furnitureCount>0?'group.kickconfirm.desc':'group.kickconfirm_nofurni.desc',['user','amount'],[removingMemberName,parser.furnitureCount.toString()]),()=>{SendMessageComposer(new GroupRemoveMemberComposer(membersData.groupId,parser.userId));refreshMembers();},null);setRemovingMemberName(null);},[membersData,removingMemberName,refreshMembers]);UseMessageEventHook(GroupConfirmMemberRemoveEvent,onGroupConfirmMemberRemoveEvent);const linkReceived=useCallback(url=>{const parts=url.split('/');if(parts.length<2)return;const groupId=parseInt(parts[1])||-1;const levelId=parseInt(parts[2])||3;setGroupId(groupId);setLevelId(levelId);},[]);useEffect(()=>{const linkTracker={linkReceived,eventUrlPrefix:'group-members/'};AddEventLinkTracker(linkTracker);return()=>RemoveLinkEventTracker(linkTracker);},[linkReceived]);useEffect(()=>{setPageId(0);},[groupId,levelId,searchQuery]);useEffect(()=>{if(groupId===-1||levelId===-1||pageId===-1)return;SendMessageComposer(new GroupMembersComposer(groupId,pageId,searchQuery,levelId));},[groupId,levelId,pageId,searchQuery]);useEffect(()=>{if(groupId===-1)return;setLevelId(-1);setMembersData(null);setTotalPages(0);setSearchQuery('');setRemovingMemberName(null);},[groupId]);if(groupId===-1||!membersData)return null;return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-group-members\",theme:\"primary\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('group.members.title',['groupName'],[membersData?membersData.groupTitle:'']),onCloseClick:event=>setGroupId(-1)}),/*#__PURE__*/_jsxs(NitroCardContentView,{overflow:\"hidden\",children:[/*#__PURE__*/_jsxs(Flex,{gap:2,children:[/*#__PURE__*/_jsx(Flex,{center:true,className:\"group-badge\",children:/*#__PURE__*/_jsx(LayoutBadgeImageView,{badgeCode:membersData.badge,isGroup:true,className:\"mx-auto d-block\"})}),/*#__PURE__*/_jsxs(Column,{fullWidth:true,gap:1,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-sm w-100\",placeholder:LocalizeText('group.members.searchinfo'),value:searchQuery,onChange:event=>setSearchQuery(event.target.value)}),/*#__PURE__*/_jsxs(\"select\",{className:\"form-select form-select-sm w-100\",value:levelId,onChange:event=>setLevelId(parseInt(event.target.value)),children:[/*#__PURE__*/_jsx(\"option\",{value:\"0\",children:LocalizeText('group.members.search.all')}),/*#__PURE__*/_jsx(\"option\",{value:\"1\",children:LocalizeText('group.members.search.admins')}),/*#__PURE__*/_jsx(\"option\",{value:\"2\",children:LocalizeText('group.members.search.pending')})]})]})]}),/*#__PURE__*/_jsx(Grid,{columnCount:2,overflow:\"auto\",className:\"nitro-group-members-list-grid\",children:membersData.result.map((member,index)=>{return/*#__PURE__*/_jsxs(Flex,{gap:2,alignItems:\"center\",overflow:\"hidden\",className:\"member-list-item bg-white rounded p-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"avatar-head cursor-pointer\",onClick:()=>GetUserProfile(member.id),children:/*#__PURE__*/_jsx(LayoutAvatarImageView,{figure:member.figure,headOnly:true,direction:2})}),/*#__PURE__*/_jsxs(Column,{grow:true,gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,small:true,pointer:true,onClick:event=>GetUserProfile(member.id),children:member.name}),member.rank!==GroupRank.REQUESTED&&/*#__PURE__*/_jsx(Text,{small:true,italics:true,variant:\"muted\",children:LocalizeText('group.members.since',['date'],[member.joinedAt])})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[member.rank!==GroupRank.REQUESTED&&/*#__PURE__*/_jsx(Flex,{center:true,children:/*#__PURE__*/_jsx(Base,{pointer:membersData.admin,className:`icon icon-group-small-${member.rank===GroupRank.OWNER?'owner':member.rank===GroupRank.ADMIN?'admin':membersData.admin&&member.rank===GroupRank.MEMBER?'not-admin':''}`,title:LocalizeText(getRankDescription(member)),onClick:event=>toggleAdmin(member)})}),membersData.admin&&member.rank===GroupRank.REQUESTED&&/*#__PURE__*/_jsx(Flex,{alignItems:\"center\",children:/*#__PURE__*/_jsx(Base,{pointer:true,className:\"nitro-friends-spritesheet icon-accept\",title:LocalizeText('group.members.accept'),onClick:event=>acceptMembership(member)})}),membersData.admin&&member.rank!==GroupRank.OWNER&&member.id!==GetSessionDataManager().userId&&/*#__PURE__*/_jsx(Flex,{alignItems:\"center\",children:/*#__PURE__*/_jsx(Base,{pointer:true,className:\"nitro-friends-spritesheet icon-deny\",title:LocalizeText(member.rank===GroupRank.REQUESTED?'group.members.reject':'group.members.kick'),onClick:event=>removeMemberOrDeclineMembership(member)})})]})]},index);})}),/*#__PURE__*/_jsxs(Flex,{gap:1,justifyContent:\"between\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(Button,{disabled:membersData.pageIndex===0,onClick:event=>setPageId(prevValue=>prevValue-1),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\"})}),/*#__PURE__*/_jsx(Text,{small:true,children:LocalizeText('group.members.pageinfo',['amount','page','totalPages'],[membersData.totalMembersCount.toString(),(membersData.pageIndex+1).toString(),totalPages.toString()])}),/*#__PURE__*/_jsx(Button,{disabled:membersData.pageIndex===totalPages-1,onClick:event=>setPageId(prevValue=>prevValue+1),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\"})})]})]})]});};","map":null,"metadata":{},"sourceType":"module"}