{"ast":null,"code":"import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{GetOccupiedTilesMessageComposer,GetRoomEntryTileMessageComposer,NitroPoint,RoomEntryTileMessageEvent,RoomOccupiedTilesMessageEvent}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useRef,useState}from'react';import{SendMessageComposer}from'../../../api';import{Base,Button,Column,Flex,Grid}from'../../../common';import{UseMessageEventHook}from'../../../hooks';import{FloorplanEditor}from'../common/FloorplanEditor';import{useFloorplanEditorContext}from'../FloorplanEditorContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const FloorplanCanvasView=props=>{const{gap=1,children=null,...rest}=props;const[occupiedTilesReceived,setOccupiedTilesReceived]=useState(false);const[entryTileReceived,setEntryTileReceived]=useState(false);const{originalFloorplanSettings=null,setOriginalFloorplanSettings=null,setVisualizationSettings=null}=useFloorplanEditorContext();const elementRef=useRef(null);const onRoomOccupiedTilesMessageEvent=useCallback(event=>{const parser=event.getParser();setOriginalFloorplanSettings(prevValue=>{const newValue={...prevValue};newValue.reservedTiles=parser.blockedTilesMap;FloorplanEditor.instance.setTilemap(newValue.tilemap,newValue.reservedTiles);return newValue;});setOccupiedTilesReceived(true);elementRef.current.scrollTo(FloorplanEditor.instance.view.width/3,0);},[setOriginalFloorplanSettings]);UseMessageEventHook(RoomOccupiedTilesMessageEvent,onRoomOccupiedTilesMessageEvent);const onRoomEntryTileMessageEvent=useCallback(event=>{const parser=event.getParser();setOriginalFloorplanSettings(prevValue=>{const newValue={...prevValue};newValue.entryPoint=[parser.x,parser.y];newValue.entryPointDir=parser.direction;return newValue;});setVisualizationSettings(prevValue=>{const newValue={...prevValue};newValue.entryPointDir=parser.direction;return newValue;});FloorplanEditor.instance.doorLocation=new NitroPoint(parser.x,parser.y);setEntryTileReceived(true);},[setOriginalFloorplanSettings,setVisualizationSettings]);UseMessageEventHook(RoomEntryTileMessageEvent,onRoomEntryTileMessageEvent);const onClickArrowButton=scrollDirection=>{const element=elementRef.current;if(!element)return;switch(scrollDirection){case'up':element.scrollBy({top:-10});break;case'down':element.scrollBy({top:10});break;case'left':element.scrollBy({left:-10});break;case'right':element.scrollBy({left:10});break;}};useEffect(()=>{return()=>{FloorplanEditor.instance.clear();setVisualizationSettings(prevValue=>{return{wallHeight:originalFloorplanSettings.wallHeight,thicknessWall:originalFloorplanSettings.thicknessWall,thicknessFloor:originalFloorplanSettings.thicknessFloor,entryPointDir:prevValue.entryPointDir};});};},[originalFloorplanSettings.thicknessFloor,originalFloorplanSettings.thicknessWall,originalFloorplanSettings.wallHeight,setVisualizationSettings]);useEffect(()=>{if(!entryTileReceived||!occupiedTilesReceived)return;FloorplanEditor.instance.renderTiles();},[entryTileReceived,occupiedTilesReceived]);useEffect(()=>{SendMessageComposer(new GetRoomEntryTileMessageComposer());SendMessageComposer(new GetOccupiedTilesMessageComposer());FloorplanEditor.instance.tilemapRenderer.interactive=true;if(!elementRef.current)return;elementRef.current.appendChild(FloorplanEditor.instance.renderer.view);},[]);return/*#__PURE__*/_jsxs(Column,{gap:gap,...rest,children:[/*#__PURE__*/_jsxs(Grid,{overflow:\"hidden\",gap:1,children:[/*#__PURE__*/_jsx(Column,{center:true,size:1,children:/*#__PURE__*/_jsx(Button,{className:\"d-md-none\",onClick:event=>onClickArrowButton('left'),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"arrow-left\"})})}),/*#__PURE__*/_jsxs(Column,{overflow:\"hidden\",size:10,gap:1,children:[/*#__PURE__*/_jsx(Flex,{justifyContent:\"center\",className:\"d-md-none\",children:/*#__PURE__*/_jsx(Button,{shrink:true,onClick:event=>onClickArrowButton('up'),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"arrow-up\"})})}),/*#__PURE__*/_jsx(Base,{overflow:\"auto\",innerRef:elementRef}),/*#__PURE__*/_jsx(Flex,{justifyContent:\"center\",className:\"d-md-none\",children:/*#__PURE__*/_jsx(Button,{shrink:true,onClick:event=>onClickArrowButton('down'),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"arrow-down\"})})})]}),/*#__PURE__*/_jsx(Column,{center:true,size:1,children:/*#__PURE__*/_jsx(Button,{className:\"d-md-none\",onClick:event=>onClickArrowButton('right'),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"arrow-right\"})})})]}),children]});};","map":null,"metadata":{},"sourceType":"module"}