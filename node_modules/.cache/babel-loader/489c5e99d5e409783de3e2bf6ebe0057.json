{"ast":null,"code":"import{RoomObjectVariable,Vector3d}from'@nitrots/nitro-renderer';import{useEffect,useState}from'react';import{attemptItemPlacement,FurniCategory,GetRoomEngine,GetSessionDataManager,LocalizeText,UnseenItemCategory}from'../../../../api';import{AutoGrid,Button,Column,Grid,LayoutLimitedEditionCompactPlateView,LayoutRarityLevelView,LayoutRoomPreviewerView,Text}from'../../../../common';import{CatalogPostMarketplaceOfferEvent}from'../../../../events';import{DispatchUiEvent,useInventoryFurni,useInventoryUnseenTracker}from'../../../../hooks';import{InventoryCategoryEmptyView}from'../InventoryCategoryEmptyView';import{InventoryFurnitureItemView}from'./InventoryFurnitureItemView';import{InventoryFurnitureSearchView}from'./InventoryFurnitureSearchView';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const attemptPlaceMarketplaceOffer=groupItem=>{const item=groupItem.getLastItem();if(!item)return false;if(!item.sellable)return false;DispatchUiEvent(new CatalogPostMarketplaceOfferEvent(item));};export const InventoryFurnitureView=props=>{const{roomSession=null,roomPreviewer=null}=props;const[isVisible,setIsVisible]=useState(false);const[filteredGroupItems,setFilteredGroupItems]=useState([]);const{groupItems=[],selectedItem=null,activate=null,deactivate=null}=useInventoryFurni();const{resetItems=null}=useInventoryUnseenTracker();useEffect(()=>{if(!selectedItem||!roomPreviewer)return;const furnitureItem=selectedItem.getLastItem();if(!furnitureItem)return;const roomEngine=GetRoomEngine();let wallType=roomEngine.getRoomInstanceVariable(roomEngine.activeRoomId,RoomObjectVariable.ROOM_WALL_TYPE);let floorType=roomEngine.getRoomInstanceVariable(roomEngine.activeRoomId,RoomObjectVariable.ROOM_FLOOR_TYPE);let landscapeType=roomEngine.getRoomInstanceVariable(roomEngine.activeRoomId,RoomObjectVariable.ROOM_LANDSCAPE_TYPE);wallType=wallType&&wallType.length?wallType:'101';floorType=floorType&&floorType.length?floorType:'101';landscapeType=landscapeType&&landscapeType.length?landscapeType:'1.1';roomPreviewer.reset(false);roomPreviewer.updateObjectRoom(floorType,wallType,landscapeType);roomPreviewer.updateRoomWallsAndFloorVisibility(true,true);if(furnitureItem.category===FurniCategory.WALL_PAPER||furnitureItem.category===FurniCategory.FLOOR||furnitureItem.category===FurniCategory.LANDSCAPE){floorType=furnitureItem.category===FurniCategory.FLOOR?selectedItem.stuffData.getLegacyString():floorType;wallType=furnitureItem.category===FurniCategory.WALL_PAPER?selectedItem.stuffData.getLegacyString():wallType;landscapeType=furnitureItem.category===FurniCategory.LANDSCAPE?selectedItem.stuffData.getLegacyString():landscapeType;roomPreviewer.updateObjectRoom(floorType,wallType,landscapeType);if(furnitureItem.category===FurniCategory.LANDSCAPE){const data=GetSessionDataManager().getWallItemDataByName('noob_window_double');if(data)roomPreviewer.addWallItemIntoRoom(data.id,new Vector3d(90,0,0),data.customParams);}}else{if(selectedItem.isWallItem){roomPreviewer.addWallItemIntoRoom(selectedItem.type,new Vector3d(90),furnitureItem.stuffData.getLegacyString());}else{roomPreviewer.addFurnitureIntoRoom(selectedItem.type,new Vector3d(90),selectedItem.stuffData,furnitureItem.extra.toString());}}},[roomPreviewer,selectedItem]);useEffect(()=>{if(!selectedItem||!selectedItem.hasUnseenItems)return;resetItems(UnseenItemCategory.FURNI,selectedItem.items.map(item=>item.id));selectedItem.hasUnseenItems=false;},[selectedItem,resetItems]);useEffect(()=>{if(!isVisible)return;const id=activate();return()=>deactivate(id);},[isVisible,activate,deactivate]);useEffect(()=>{setIsVisible(true);return()=>setIsVisible(false);},[]);if(!groupItems||!groupItems.length)return/*#__PURE__*/_jsx(InventoryCategoryEmptyView,{title:LocalizeText('inventory.empty.title'),desc:LocalizeText('inventory.empty.desc')});return/*#__PURE__*/_jsxs(Grid,{children:[/*#__PURE__*/_jsxs(Column,{size:7,overflow:\"hidden\",children:[/*#__PURE__*/_jsx(InventoryFurnitureSearchView,{groupItems:groupItems,setGroupItems:setFilteredGroupItems}),/*#__PURE__*/_jsx(AutoGrid,{columnCount:5,children:filteredGroupItems&&filteredGroupItems.length>0&&filteredGroupItems.map((item,index)=>/*#__PURE__*/_jsx(InventoryFurnitureItemView,{groupItem:item},index))})]}),/*#__PURE__*/_jsxs(Column,{size:5,overflow:\"auto\",children:[/*#__PURE__*/_jsxs(Column,{overflow:\"hidden\",position:\"relative\",children:[/*#__PURE__*/_jsx(LayoutRoomPreviewerView,{roomPreviewer:roomPreviewer,height:140}),selectedItem&&selectedItem.stuffData.isUnique&&/*#__PURE__*/_jsx(LayoutLimitedEditionCompactPlateView,{className:\"top-2 end-2\",position:\"absolute\",uniqueNumber:selectedItem.stuffData.uniqueNumber,uniqueSeries:selectedItem.stuffData.uniqueSeries}),selectedItem&&selectedItem.stuffData.rarityLevel>-1&&/*#__PURE__*/_jsx(LayoutRarityLevelView,{className:\"top-2 end-2\",position:\"absolute\",level:selectedItem.stuffData.rarityLevel})]}),selectedItem&&/*#__PURE__*/_jsxs(Column,{grow:true,justifyContent:\"between\",gap:2,children:[/*#__PURE__*/_jsx(Text,{grow:true,truncate:true,children:selectedItem.name}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[!!roomSession&&/*#__PURE__*/_jsx(Button,{onClick:event=>attemptItemPlacement(selectedItem),children:LocalizeText('inventory.furni.placetoroom')}),selectedItem&&selectedItem.isSellable&&/*#__PURE__*/_jsx(Button,{onClick:event=>attemptPlaceMarketplaceOffer(selectedItem),children:LocalizeText('inventory.marketplace.sell')})]})]})]})]});};","map":null,"metadata":{},"sourceType":"module"}