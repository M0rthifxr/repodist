{"ast":null,"code":"import{Graphics}from'@pixi/graphics';import{Vector3d}from'../../../../../../../room/utils/Vector3d';export class PlaneMaterialCellColumn{constructor(width,cells){let repeatMode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this._cells=void 0;this._repeatMode=void 0;this._width=void 0;this._cachedTexture=void 0;this._cachedBitmapData=void 0;this._cachedBitmapNormal=void 0;this._cachedBitmapDataOffsetX=void 0;this._cachedBitmapDataOffsetY=void 0;this._isCached=void 0;this._isStatic=void 0;this._cells=[];this._repeatMode=repeatMode;this._width=width<1?1:width;this._cachedBitmapData=null;this._cachedBitmapNormal=null;this._cachedBitmapDataOffsetX=0;this._cachedBitmapDataOffsetY=0;this._isCached=false;this._isStatic=true;if(cells&&cells.length){let cellIndex=0;while(cellIndex<cells.length){const cell=cells[cellIndex];if(cell){this._cells.push(cell);if(!cell.isStatic)this._isStatic=false;}cellIndex++;}}}get isStatic(){return this._isStatic;}isRepeated(){return!(this._repeatMode===PlaneMaterialCellColumn.REPEAT_MODE_NONE);}get width(){return this._width;}dispose(){if(this._cells&&this._cells.length){for(const cell of this._cells){if(!cell)continue;cell.dispose();}this._cells=null;}if(this._cachedBitmapData){this._cachedBitmapData.destroy();this._cachedBitmapData=null;}if(this._cachedBitmapNormal)this._cachedBitmapNormal=null;}clearCache(){if(!this._isCached)return;if(this._cachedBitmapData){this._cachedBitmapData.destroy();this._cachedBitmapData=null;}if(this._cachedBitmapNormal){this._cachedBitmapNormal.x=0;this._cachedBitmapNormal.y=0;this._cachedBitmapNormal.z=0;}if(this._cells&&this._cells.length){for(const cell of this._cells){if(!cell)continue;cell.clearCache();}}this._isCached=false;}render(height,normal,offsetX,offsetY){let ht=0;if(this._repeatMode==PlaneMaterialCellColumn.REPEAT_MODE_NONE){ht=this.getCellsHeight(this._cells,normal);height=ht;}if(!this._cachedBitmapNormal)this._cachedBitmapNormal=new Vector3d();if(this.isStatic){if(this._cachedBitmapData){if(this._cachedBitmapData.height===height&&Vector3d.isEqual(this._cachedBitmapNormal,normal)&&this._cachedBitmapDataOffsetX===offsetX&&this._cachedBitmapDataOffsetY===offsetY){return this._cachedBitmapData;}this._cachedBitmapData.destroy();this._cachedBitmapData=null;}}else{if(this._cachedBitmapData){if(this._cachedBitmapData.height===height){this._cachedBitmapData.beginFill(0xFFFFFF).drawRect(0,0,this._cachedBitmapData.width,height).endFill();}else{this._cachedBitmapData.destroy();this._cachedBitmapData=null;}}}this._isCached=true;if(!this._cachedBitmapData){this._cachedBitmapData=new Graphics().beginFill(0xFFFFFF).drawRect(0,0,this._width,height).endFill();}this._cachedBitmapNormal.assign(normal);this._cachedBitmapDataOffsetX=offsetX;this._cachedBitmapDataOffsetY=offsetY;if(!this._cells.length)return this._cachedBitmapData;switch(this._repeatMode){case PlaneMaterialCellColumn.REPEAT_MODE_NONE:this.renderRepeatNone(normal);break;case PlaneMaterialCellColumn.REPEAT_MODE_BORDERS:console.log('REPEAT_MODE_BORDERS');//     this.renderRepeatBorders(normal);\nbreak;case PlaneMaterialCellColumn.REPEAT_MODE_CENTER:console.log('REPEAT_MODE_CENTER');//     this.renderRepeatCenter(normal);\nbreak;case PlaneMaterialCellColumn.REPEAT_MODE_FIRST:console.log('REPEAT_MODE_FIRST');//     this.renderRepeatFirst(normal);\nbreak;case PlaneMaterialCellColumn.REPEAT_MODE_LAST:console.log('REPEAT_MODE_LAST');//     this.renderRepeatLast(normal);\nbreak;default:this.renderRepeatAll(normal,offsetX,offsetY);break;}return this._cachedBitmapData;}getCellsHeight(cells,normal){if(!cells||!cells.length)return 0;let height=0;let cellIterator=0;while(cellIterator<cells.length){const cell=cells[cellIterator];if(cell)height+=cell.getHeight(normal);cellIterator++;}return height;}renderCells(cells,index,flag,normal){let offsetX=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;let offsetY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;if(!cells||!cells.length||!this._cachedBitmapData)return index;let cellIndex=0;while(cellIndex<cells.length){let cell=null;if(flag){cell=cells[cellIndex];}else{cell=cells[cells.length-1-cellIndex];}if(cell){const graphic=cell.render(normal,offsetX,offsetY);if(graphic){if(!flag)index-=graphic.height;graphic.y=index;this._cachedBitmapData.addChild(graphic);if(flag)index=index+graphic.height;if(flag&&index>=this._cachedBitmapData.height||!flag&&index<=0)return index;}}cellIndex++;}return index;}renderRepeatNone(normal){if(!this._cells.length||!this._cachedBitmapData)return;this.renderCells(this._cells,0,true,normal);}renderRepeatAll(normal,offsetX,offsetY){if(!this._cells.length||!this._cachedBitmapData)return;let index=0;while(index<this._cachedBitmapData.height){index=this.renderCells(this._cells,index,true,normal,offsetX,offsetY);if(!index)return;}}// private renderRepeatBorders(k:IVector3D): void\n// {\n//     if (((this._cells.length == 0) || (this._cachedBitmapData == null)))\n//     {\n//         return;\n//     }\n//     var _local_2:PlaneMaterialCell;\n//     var _local_3:BitmapData;\n//     var _local_4:Array = [];\n//     var _local_5: number;\n//     var _local_6: number;\n//     var _local_7: number;\n//     _local_7 = 1;\n//     while (_local_7 < (this._cells.length - 1))\n//     {\n//         _local_2 = (this._cells[_local_7] as PlaneMaterialCell);\n//         if (_local_2 != null)\n//         {\n//             _local_6 = _local_2.getHeight(k);\n//             if (_local_6 > 0)\n//             {\n//                 _local_5 = (_local_5 + _local_6);\n//                 _local_4.push(_local_2);\n//             }\n//         }\n//         _local_7++;\n//     }\n//     if (this._cells.length == 1)\n//     {\n//         _local_2 = (this._cells[0] as PlaneMaterialCell);\n//         if (_local_2 != null)\n//         {\n//             _local_6 = _local_2.getHeight(k);\n//             if (_local_6 > 0)\n//             {\n//                 _local_5 = (_local_5 + _local_6);\n//                 _local_4.push(_local_2);\n//             }\n//         }\n//     }\n//     var _local_8:* = ((this._cachedBitmapData.height - _local_5) >> 1);\n//     var _local_9: number = this.renderCells(_local_4, _local_8, true, k);\n//     _local_2 = (this._cells[0] as PlaneMaterialCell);\n//     if (_local_2 != null)\n//     {\n//         _local_4 = [_local_2];\n//         while (_local_8 >= 0)\n//         {\n//             _local_8 = this.renderCells(_local_4, _local_8, false, k);\n//         }\n//     }\n//     _local_2 = (this._cells[(this._cells.length - 1)] as PlaneMaterialCell);\n//     if (_local_2 != null)\n//     {\n//         _local_4 = [_local_2];\n//         while (_local_9 < this._cachedBitmapData.height)\n//         {\n//             _local_9 = this.renderCells(_local_4, _local_9, true, k);\n//         }\n//     }\n// }\n// private renderRepeatCenter(k:IVector3D): void\n// {\n//     var _local_13: number;\n//     var _local_14: number;\n//     var _local_15: number;\n//     var _local_16:Array;\n//     if (((this._cells.length == 0) || (this._cachedBitmapData == null)))\n//     {\n//         return;\n//     }\n//     var _local_2:PlaneMaterialCell;\n//     var _local_3:BitmapData;\n//     var _local_4:Array = [];\n//     var _local_5:Array = [];\n//     var _local_6: number;\n//     var _local_7: number;\n//     var _local_8: number;\n//     var _local_9: number;\n//     _local_9 = 0;\n//     while (_local_9 < (this._cells.length >> 1))\n//     {\n//         _local_2 = (this._cells[_local_9] as PlaneMaterialCell);\n//         if (_local_2 != null)\n//         {\n//             _local_8 = _local_2.getHeight(k);\n//             if (_local_8 > 0)\n//             {\n//                 _local_6 = (_local_6 + _local_8);\n//                 _local_4.push(_local_2);\n//             }\n//         }\n//         _local_9++;\n//     }\n//     _local_9 = ((this._cells.length >> 1) + 1);\n//     while (_local_9 < this._cells.length)\n//     {\n//         _local_2 = (this._cells[_local_9] as PlaneMaterialCell);\n//         if (_local_2 != null)\n//         {\n//             _local_8 = _local_2.getHeight(k);\n//             if (_local_8 > 0)\n//             {\n//                 _local_7 = (_local_7 + _local_8);\n//                 _local_5.push(_local_2);\n//             }\n//         }\n//         _local_9++;\n//     }\n//     var _local_10: number;\n//     var _local_11: number;\n//     var _local_12: number = this._cachedBitmapData.height;\n//     if ((_local_6 + _local_7) > this._cachedBitmapData.height)\n//     {\n//         _local_10 = ((_local_6 + _local_7) - this._cachedBitmapData.height);\n//         _local_11 = (_local_11 - (_local_10 >> 1));\n//         _local_12 = (_local_12 + (_local_10 - (_local_10 >> 1)));\n//     }\n//     if (_local_10 == 0)\n//     {\n//         _local_2 = (this._cells[(this._cells.length >> 1)] as PlaneMaterialCell);\n//         if (_local_2 != null)\n//         {\n//             _local_8 = _local_2.getHeight(k);\n//             if (_local_8 > 0)\n//             {\n//                 _local_13 = (this._cachedBitmapData.height - (_local_6 + _local_7));\n//                 _local_14 = (Math.ceil((_local_13 / _local_8)) * _local_8);\n//                 _local_11 = (_local_6 - ((_local_14 - _local_13) >> 1));\n//                 _local_15 = (_local_11 + _local_14);\n//                 _local_16 = [_local_2];\n//                 while (_local_11 < _local_15)\n//                 {\n//                     _local_11 = this.renderCells(_local_16, _local_11, true, k);\n//                 }\n//             }\n//         }\n//     }\n//     _local_11 = 0;\n//     this.renderCells(_local_4, _local_11, true, k);\n//     this.renderCells(_local_5, _local_12, false, k);\n// }\n// private renderRepeatFirst(k:IVector3D): void\n// {\n//     var _local_4:Array;\n//     if (((this._cells.length == 0) || (this._cachedBitmapData == null)))\n//     {\n//         return;\n//     }\n//     var _local_2:PlaneMaterialCell;\n//     var _local_3: number = this._cachedBitmapData.height;\n//     _local_3 = this.renderCells(this._cells, _local_3, false, k);\n//     _local_2 = (this._cells[0] as PlaneMaterialCell);\n//     if (_local_2 != null)\n//     {\n//         _local_4 = [_local_2];\n//         while (_local_3 >= 0)\n//         {\n//             _local_3 = this.renderCells(_local_4, _local_3, false, k);\n//         }\n//     }\n// }\n// private renderRepeatLast(k: IVector3D): void\n// {\n//     if(!this._cells.length || !this._cachedBitmapData) return;\n//     var _local_4:Array;\n//     var _local_2:PlaneMaterialCell;\n//     var _local_3: number;\n//     _local_3 = this.renderCells(this._cells, _local_3, true, k);\n//     _local_2 = (this._cells[(this._cells.length - 1)] as PlaneMaterialCell);\n//     if (_local_2 != null)\n//     {\n//         _local_4 = [_local_2];\n//         while (_local_3 < this._cachedBitmapData.height)\n//         {\n//             _local_3 = this.renderCells(_local_4, _local_3, true, k);\n//         }\n//     }\n// }\ngetCells(){return this._cells;}}PlaneMaterialCellColumn.REPEAT_MODE_NONE=0;PlaneMaterialCellColumn.REPEAT_MODE_ALL=1;PlaneMaterialCellColumn.REPEAT_MODE_BORDERS=2;PlaneMaterialCellColumn.REPEAT_MODE_CENTER=3;PlaneMaterialCellColumn.REPEAT_MODE_FIRST=4;PlaneMaterialCellColumn.REPEAT_MODE_LAST=5;","map":null,"metadata":{},"sourceType":"module"}