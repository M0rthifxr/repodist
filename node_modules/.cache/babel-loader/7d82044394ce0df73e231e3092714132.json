{"ast":null,"code":"import{FloodControlEvent}from'../../communication/messages/incoming/room/unit/chat/FloodControlEvent';import{RemainingMuteEvent}from'../../communication/messages/incoming/room/unit/chat/RemainingMuteEvent';import{RoomUnitChatEvent}from'../../communication/messages/incoming/room/unit/chat/RoomUnitChatEvent';import{RoomUnitChatShoutEvent}from'../../communication/messages/incoming/room/unit/chat/RoomUnitChatShoutEvent';import{RoomUnitChatWhisperEvent}from'../../communication/messages/incoming/room/unit/chat/RoomUnitChatWhisperEvent';import{RoomUnitHandItemReceivedEvent}from'../../communication/messages/incoming/room/unit/RoomUnitHandItemReceivedEvent';import{PetRespectNoficationEvent}from'../../communication/messages/incoming/user/PetRespectNoficationEvent';import{PetSupplementedNotificationEvent}from'../../communication/messages/incoming/user/PetSupplementedNotificationEvent';import{PetSupplementTypeEnum}from'../../communication/messages/incoming/user/PetSupplementTypeEnum';import{RespectReceivedEvent}from'../../communication/messages/incoming/user/RespectReceivedEvent';import{SystemChatStyleEnum}from'../../ui/widget/enums/SystemChatStyleEnum';import{RoomSessionChatEvent}from'../events/RoomSessionChatEvent';import{BaseHandler}from'./BaseHandler';export class RoomChatHandler extends BaseHandler{constructor(connection,listener){super(connection,listener);connection.addMessageEvent(new RoomUnitChatEvent(this.onRoomUnitChatEvent.bind(this)));connection.addMessageEvent(new RoomUnitChatShoutEvent(this.onRoomUnitChatEvent.bind(this)));connection.addMessageEvent(new RoomUnitChatWhisperEvent(this.onRoomUnitChatEvent.bind(this)));connection.addMessageEvent(new RoomUnitHandItemReceivedEvent(this.onRoomUnitHandItemReceivedEvent.bind(this)));connection.addMessageEvent(new RespectReceivedEvent(this.onRespectReceivedEvent.bind(this)));connection.addMessageEvent(new PetRespectNoficationEvent(this.onPetRespectNoficationEvent.bind(this)));connection.addMessageEvent(new PetSupplementedNotificationEvent(this.onPetSupplementedNotificationEvent.bind(this)));connection.addMessageEvent(new FloodControlEvent(this.onFloodControlEvent.bind(this)));connection.addMessageEvent(new RemainingMuteEvent(this.onRemainingMuteEvent.bind(this)));}onRoomUnitChatEvent(event){if(!this.listener)return;const session=this.listener.getSession(this.roomId);if(!session)return;const parser=event.getParser();if(!parser)return;let chatType=RoomSessionChatEvent.CHAT_TYPE_SPEAK;if(event instanceof RoomUnitChatShoutEvent)chatType=RoomSessionChatEvent.CHAT_TYPE_SHOUT;else if(event instanceof RoomUnitChatWhisperEvent)chatType=RoomSessionChatEvent.CHAT_TYPE_WHISPER;const chatEvent=new RoomSessionChatEvent(RoomSessionChatEvent.CHAT_EVENT,session,parser.roomIndex,parser.message,chatType,parser.bubble);this.listener.events.dispatchEvent(chatEvent);}onRoomUnitHandItemReceivedEvent(event){if(!this.listener)return;const session=this.listener.getSession(this.roomId);if(!session)return;const parser=event.getParser();if(!parser)return;this.listener.events.dispatchEvent(new RoomSessionChatEvent(RoomSessionChatEvent.CHAT_EVENT,session,parser.giverUserId,'',RoomSessionChatEvent.CHAT_TYPE_HAND_ITEM_RECEIVED,SystemChatStyleEnum.GENERIC,null,parser.handItemType));}onRespectReceivedEvent(event){if(!this.listener)return;const session=this.listener.getSession(this.roomId);if(!session)return;const parser=event.getParser();if(!parser)return;const userData=session.userDataManager.getUserData(parser.userId);if(!userData)return;this.listener.events.dispatchEvent(new RoomSessionChatEvent(RoomSessionChatEvent.CHAT_EVENT,session,userData.roomIndex,'',RoomSessionChatEvent.CHAT_TYPE_RESPECT,SystemChatStyleEnum.GENERIC));}onPetRespectNoficationEvent(event){if(!this.listener)return;const session=this.listener.getSession(this.roomId);if(!session)return;const parser=event.getParser();if(!parser)return;const petData=session.userDataManager.getPetData(parser.petData.id);if(!petData)return;let chatType=RoomSessionChatEvent.CHAT_TYPE_PETRESPECT;if(parser.isTreat)chatType=RoomSessionChatEvent.CHAT_TYPE_PETTREAT;this.listener.events.dispatchEvent(new RoomSessionChatEvent(RoomSessionChatEvent.CHAT_EVENT,session,petData.roomIndex,'',chatType,SystemChatStyleEnum.GENERIC));}onPetSupplementedNotificationEvent(event){if(!this.listener)return;const session=this.listener.getSession(this.roomId);if(!session)return;const parser=event.getParser();if(!parser)return;const petData=session.userDataManager.getPetData(parser.petId);if(!petData)return;let userRoomIndex=-1;const userData=session.userDataManager.getUserData(parser.userId);if(userData)userRoomIndex=userData.roomIndex;let chatType=RoomSessionChatEvent.CHAT_TYPE_PETREVIVE;switch(parser.supplementType){case PetSupplementTypeEnum.REVIVE:chatType=RoomSessionChatEvent.CHAT_TYPE_PETREVIVE;break;case PetSupplementTypeEnum.REBREED_FERTILIZER:chatType=RoomSessionChatEvent.CHAT_TYPE_PET_REBREED_FERTILIZE;break;case PetSupplementTypeEnum.SPEED_FERTILIZER:chatType=RoomSessionChatEvent.CHAT_TYPE_PET_SPEED_FERTILIZE;break;}this.listener.events.dispatchEvent(new RoomSessionChatEvent(RoomSessionChatEvent.CHAT_EVENT,session,petData.roomIndex,'',chatType,SystemChatStyleEnum.GENERIC,null,userRoomIndex));}onFloodControlEvent(event){if(!this.listener)return;const session=this.listener.getSession(this.roomId);if(!session)return;const parser=event.getParser();if(!parser)return;const seconds=parser.seconds;this.listener.events.dispatchEvent(new RoomSessionChatEvent(RoomSessionChatEvent.FLOOD_EVENT,session,-1,seconds.toString(),0,0));}onRemainingMuteEvent(event){if(!this.listener)return;const session=this.listener.getSession(this.roomId);if(!session)return;const parser=event.getParser();if(!parser)return;this.listener.events.dispatchEvent(new RoomSessionChatEvent(RoomSessionChatEvent.CHAT_EVENT,session,session.ownRoomIndex,'',RoomSessionChatEvent.CHAT_TYPE_MUTE_REMAINING,SystemChatStyleEnum.GENERIC,null,parser.seconds));}}","map":null,"metadata":{},"sourceType":"module"}