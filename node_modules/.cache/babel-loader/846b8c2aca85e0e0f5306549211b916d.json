{"ast":null,"code":"import{ColorConverter,TextureUtils}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useRef,useState}from'react';import{GetNitroInstance}from'../../api';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const LayoutRoomPreviewerView=props=>{const{roomPreviewer=null,height=0,children=null}=props;const[renderingCanvas,setRenderingCanvas]=useState(null);const elementRef=useRef();const onClick=event=>{if(!roomPreviewer)return;if(event.shiftKey){roomPreviewer.changeRoomObjectDirection();}else{roomPreviewer.changeRoomObjectState();}};const update=useCallback(time=>{if(!roomPreviewer||!renderingCanvas||!elementRef.current)return;roomPreviewer.updatePreviewRoomView();if(!renderingCanvas.canvasUpdated)return;elementRef.current.style.backgroundImage=`url(${TextureUtils.generateImageUrl(renderingCanvas.master)})`;},[roomPreviewer,renderingCanvas,elementRef]);const setupPreviewer=useCallback(()=>{if(!elementRef.current||!roomPreviewer)return;const computed=document.defaultView.getComputedStyle(elementRef.current,null);let backgroundColor=computed.backgroundColor;backgroundColor=ColorConverter.rgbStringToHex(backgroundColor);backgroundColor=backgroundColor.replace('#','0x');roomPreviewer.backgroundColor=parseInt(backgroundColor,16);const width=elementRef.current.parentElement.clientWidth;roomPreviewer.getRoomCanvas(width,height);const canvas=roomPreviewer.getRenderingCanvas();setRenderingCanvas(canvas);canvas.canvasUpdated=true;update(-1);},[elementRef,height,roomPreviewer,update]);useEffect(()=>{if(!roomPreviewer)return;if(!renderingCanvas)setupPreviewer();GetNitroInstance().ticker.add(update);const resizeObserver=new ResizeObserver(()=>{if(!roomPreviewer||!elementRef.current)return;const width=elementRef.current.parentElement.offsetWidth;roomPreviewer.modifyRoomCanvas(width,height);update(-1);});resizeObserver.observe(elementRef.current);return()=>{resizeObserver.disconnect();GetNitroInstance().ticker.remove(update);};},[renderingCanvas,roomPreviewer,elementRef,height,setupPreviewer,update]);return/*#__PURE__*/_jsxs(\"div\",{className:\"room-preview-container\",children:[/*#__PURE__*/_jsx(\"div\",{ref:elementRef,className:\"room-preview-image\",style:{height},onClick:onClick}),children]});};","map":null,"metadata":{},"sourceType":"module"}