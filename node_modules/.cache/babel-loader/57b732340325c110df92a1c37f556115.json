{"ast":null,"code":"import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{GiftReceiverNotFoundEvent,PurchaseFromCatalogAsGiftComposer}from'@nitrots/nitro-renderer';import classNames from'classnames';import{useCallback,useEffect,useMemo,useState}from'react';import{GetSessionDataManager,LocalizeText,ProductTypeEnum,SendMessageComposer}from'../../../../api';import{Base,Button,ButtonGroup,Column,Flex,FormGroup,LayoutCurrencyIcon,LayoutFurniImageView,LayoutGiftTagView,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../../../common';import{GiftColorButton}from'../../../../common/GiftColorButton';import{CatalogEvent,CatalogPurchasedEvent}from'../../../../events';import{useCatalog,UseMessageEventHook,UseUiEvent}from'../../../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const CatalogGiftView=props=>{const[isVisible,setIsVisible]=useState(false);const[pageId,setPageId]=useState(0);const[offerId,setOfferId]=useState(0);const[extraData,setExtraData]=useState('');const[receiverName,setReceiverName]=useState('');const[showMyFace,setShowMyFace]=useState(true);const[message,setMessage]=useState('');const[colors,setColors]=useState([]);const[selectedBoxIndex,setSelectedBoxIndex]=useState(0);const[selectedRibbonIndex,setSelectedRibbonIndex]=useState(0);const[selectedColorId,setSelectedColorId]=useState(0);const[maxBoxIndex,setMaxBoxIndex]=useState(0);const[maxRibbonIndex,setMaxRibbonIndex]=useState(0);const[receiverNotFound,setReceiverNotFound]=useState(false);const{catalogOptions=null}=useCatalog();const{giftConfiguration=null}=catalogOptions;const close=useCallback(()=>{setIsVisible(false);setPageId(0);setOfferId(0);setExtraData('');setReceiverName('');setShowMyFace(true);setMessage('');setSelectedBoxIndex(0);setSelectedRibbonIndex(0);if(colors.length)setSelectedColorId(colors[0].id);},[colors]);const onCatalogEvent=useCallback(event=>{switch(event.type){case CatalogPurchasedEvent.PURCHASE_SUCCESS:close();return;case CatalogEvent.INIT_GIFT:const castedEvent=event;close();setPageId(castedEvent.pageId);setOfferId(castedEvent.offerId);setExtraData(castedEvent.extraData);setIsVisible(true);return;}},[close]);UseUiEvent(CatalogPurchasedEvent.PURCHASE_SUCCESS,onCatalogEvent);UseUiEvent(CatalogEvent.INIT_GIFT,onCatalogEvent);const isBoxDefault=useMemo(()=>{return giftConfiguration?giftConfiguration.defaultStuffTypes.findIndex(s=>s===giftConfiguration.boxTypes[selectedBoxIndex])>-1:true;},[giftConfiguration,selectedBoxIndex]);const boxExtraData=useMemo(()=>{if(!giftConfiguration)return'';return(giftConfiguration.boxTypes[selectedBoxIndex]*1000+giftConfiguration.ribbonTypes[selectedRibbonIndex]).toString();},[giftConfiguration,selectedBoxIndex,selectedRibbonIndex]);const isColorable=useMemo(()=>{if(!giftConfiguration)return false;const boxType=giftConfiguration.boxTypes[selectedBoxIndex];return boxType===8||boxType>=3&&boxType<=6?false:true;},[giftConfiguration,selectedBoxIndex]);const handleAction=useCallback(action=>{switch(action){case'prev_box':setSelectedBoxIndex(value=>value===0?maxBoxIndex:value-1);return;case'next_box':setSelectedBoxIndex(value=>value===maxBoxIndex?0:value+1);return;case'prev_ribbon':setSelectedRibbonIndex(value=>value===0?maxRibbonIndex:value-1);return;case'next_ribbon':setSelectedRibbonIndex(value=>value===maxRibbonIndex?0:value+1);return;case'buy':if(!receiverName||receiverName.length===0){setReceiverNotFound(true);return;}SendMessageComposer(new PurchaseFromCatalogAsGiftComposer(pageId,offerId,extraData,receiverName,message,selectedColorId,selectedBoxIndex,selectedRibbonIndex,showMyFace));return;}},[extraData,maxBoxIndex,maxRibbonIndex,message,offerId,pageId,receiverName,selectedBoxIndex,selectedColorId,selectedRibbonIndex,showMyFace]);const onGiftReceiverNotFoundEvent=useCallback(()=>{setReceiverNotFound(true);},[]);UseMessageEventHook(GiftReceiverNotFoundEvent,onGiftReceiverNotFoundEvent);useEffect(()=>{setReceiverNotFound(false);},[receiverName]);useEffect(()=>{if(!giftConfiguration)return;const newColors=[];for(const colorId of giftConfiguration.stuffTypes){const giftData=GetSessionDataManager().getFloorItemData(colorId);if(!giftData)continue;if(giftData.colors&&giftData.colors.length>0)newColors.push({id:colorId,color:`#${giftData.colors[0].toString(16)}`});}setMaxBoxIndex(giftConfiguration.boxTypes.length-1);setMaxRibbonIndex(giftConfiguration.ribbonTypes.length-1);if(newColors.length){setSelectedColorId(newColors[0].id);setColors(newColors);}},[giftConfiguration]);if(!giftConfiguration||!giftConfiguration.isEnabled||!isVisible)return null;const boxName='catalog.gift_wrapping_new.box.'+(isBoxDefault?'default':selectedBoxIndex);const ribbonName=`catalog.gift_wrapping_new.ribbon.${selectedRibbonIndex}`;const priceText='catalog.gift_wrapping_new.'+(isBoxDefault?'freeprice':'price');return/*#__PURE__*/_jsxs(NitroCardView,{uniqueKey:\"catalog-gift\",className:\"nitro-catalog-gift\",theme:\"primary\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('catalog.gift_wrapping.title'),onCloseClick:close}),/*#__PURE__*/_jsxs(NitroCardContentView,{className:\"text-black\",children:[/*#__PURE__*/_jsxs(FormGroup,{column:true,children:[/*#__PURE__*/_jsx(Text,{children:LocalizeText('catalog.gift_wrapping.receiver')}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:'form-control form-control-sm'+classNames({' is-invalid':receiverNotFound}),value:receiverName,onChange:e=>setReceiverName(e.target.value)}),receiverNotFound&&/*#__PURE__*/_jsx(Base,{className:\"invalid-feedback\",children:LocalizeText('catalog.gift_wrapping.receiver_not_found.title')})]}),/*#__PURE__*/_jsx(LayoutGiftTagView,{figure:GetSessionDataManager().figure,userName:GetSessionDataManager().userName,message:message,editable:true,onChange:value=>setMessage(value)}),/*#__PURE__*/_jsxs(Base,{className:\"form-check\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input\",type:\"checkbox\",name:\"showMyFace\",checked:showMyFace,onChange:e=>setShowMyFace(value=>!value)}),/*#__PURE__*/_jsx(\"label\",{className:\"form-check-label\",children:LocalizeText('catalog.gift_wrapping.show_face.title')})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:2,children:[selectedColorId&&/*#__PURE__*/_jsx(Base,{className:\"gift-preview\",children:/*#__PURE__*/_jsx(LayoutFurniImageView,{productType:ProductTypeEnum.FLOOR,productClassId:selectedColorId,extraData:boxExtraData})}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsxs(Flex,{gap:2,children:[/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:()=>handleAction('prev_box'),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\"})}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:()=>handleAction('next_box'),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\"})})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{fontWeight:\"bold\",children:LocalizeText(boxName)}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:1,children:[LocalizeText(priceText,['price'],[giftConfiguration.price.toString()]),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:-1})]})]})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",gap:2,children:[/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:()=>handleAction('prev_ribbon'),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-left\"})}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:()=>handleAction('next_ribbon'),children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:\"chevron-right\"})})]}),/*#__PURE__*/_jsx(Text,{fontWeight:\"bold\",children:LocalizeText(ribbonName)})]})]})]}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{fontWeight:\"bold\",children:LocalizeText('catalog.gift_wrapping.pick_color')}),/*#__PURE__*/_jsx(ButtonGroup,{fullWidth:true,className:\"gap-2\",children:colors.map(color=>/*#__PURE__*/_jsx(GiftColorButton,{variant:\"dark\",active:color.id===selectedColorId,disabled:!isColorable,style:{backgroundColor:color.color},onClick:()=>setSelectedColorId(color.id)},color.id))})]}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"between\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(Button,{variant:\"link\",onClick:close,className:\"text-black\",children:LocalizeText('cancel')}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:()=>handleAction('buy'),children:LocalizeText('catalog.gift_wrapping.give_gift')})]})]})]});};","map":null,"metadata":{},"sourceType":"module"}