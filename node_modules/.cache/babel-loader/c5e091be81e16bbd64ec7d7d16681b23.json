{"ast":null,"code":"import{AvatarFigurePartType,FurnitureMannequinSaveLookComposer,FurnitureMannequinSaveNameComposer,FurnitureMultiStateComposer,HabboClubLevelEnum,RoomControllerLevel}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useState}from'react';import{GetAvatarRenderManager,GetClubMemberLevel,GetSessionDataManager,LocalizeText,RoomWidgetUpdateMannequinEvent,SendMessageComposer}from'../../../../../api';import{Base,Button,Column,Flex,LayoutAvatarImageView,LayoutCurrencyIcon,NitroCardContentView,NitroCardHeaderView,NitroCardView,Text}from'../../../../../common';import{UseEventDispatcherHook}from'../../../../../hooks';import{useRoomContext}from'../../../RoomContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const MODE_NONE=-1;const MODE_CONTROLLER=0;const MODE_UPDATE=1;const MODE_PEER=2;const MODE_NO_CLUB=3;const MODE_WRONG_GENDER=4;const ACTION_SET_NAME=1;const ACTION_WEAR=2;const ACTION_SAVE=3;const MANNEQUIN_FIGURE=['hd',99999,[99998]];const MANNEQUIN_CLOTHING_PART_TYPES=[AvatarFigurePartType.CHEST_ACCESSORY,AvatarFigurePartType.COAT_CHEST,AvatarFigurePartType.CHEST,AvatarFigurePartType.LEGS,AvatarFigurePartType.SHOES,AvatarFigurePartType.WAIST_ACCESSORY];export const FurnitureMannequinView=props=>{const[objectId,setObjectId]=useState(-1);const[figure,setFigure]=useState(null);const[gender,setGender]=useState(null);const[name,setName]=useState(null);const[clubLevel,setClubLevel]=useState(HabboClubLevelEnum.NO_CLUB);const[renderedFigure,setRenderedFigure]=useState(null);const[renderedClubLevel,setRenderedClubLevel]=useState(HabboClubLevelEnum.NO_CLUB);const[mode,setMode]=useState(MODE_NONE);const{roomSession=null,eventDispatcher=null}=useRoomContext();const onRoomWidgetUpdateMannequinEvent=useCallback(event=>{const figureContainer=GetAvatarRenderManager().createFigureContainer(event.figure);const figureClubLevel=GetAvatarRenderManager().getFigureClubLevel(figureContainer,event.gender,MANNEQUIN_CLOTHING_PART_TYPES);setObjectId(event.objectId);setFigure(event.figure);setGender(event.gender);setName(event.name);setClubLevel(figureClubLevel);if(roomSession.isRoomOwner||roomSession.controllerLevel>=RoomControllerLevel.GUEST||GetSessionDataManager().isModerator){setMode(MODE_CONTROLLER);}else if(GetSessionDataManager().gender.toLowerCase()!==event.gender.toLowerCase()){setMode(MODE_WRONG_GENDER);}else if(GetClubMemberLevel()<figureClubLevel){setMode(MODE_NO_CLUB);}else{setMode(MODE_PEER);}},[roomSession]);UseEventDispatcherHook(RoomWidgetUpdateMannequinEvent.MANNEQUIN_UPDATE,eventDispatcher,onRoomWidgetUpdateMannequinEvent);const getMergedFigureContainer=(figure,targetFigure)=>{const figureContainer=GetAvatarRenderManager().createFigureContainer(figure);const targetFigureContainer=GetAvatarRenderManager().createFigureContainer(targetFigure);for(const part of MANNEQUIN_CLOTHING_PART_TYPES)figureContainer.removePart(part);for(const part of targetFigureContainer.getPartTypeIds()){figureContainer.updatePart(part,targetFigureContainer.getPartSetId(part),targetFigureContainer.getPartColorIds(part));}return figureContainer;};const transformAsMannequinFigure=figureContainer=>{for(const part of figureContainer.getPartTypeIds()){if(MANNEQUIN_CLOTHING_PART_TYPES.indexOf(part)>=0)continue;figureContainer.removePart(part);}figureContainer.updatePart(MANNEQUIN_FIGURE[0],MANNEQUIN_FIGURE[1],MANNEQUIN_FIGURE[2]);};const processAction=useCallback(function(action){let value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;switch(action){case ACTION_SAVE:SendMessageComposer(new FurnitureMannequinSaveLookComposer(objectId));break;case ACTION_WEAR:SendMessageComposer(new FurnitureMultiStateComposer(objectId));break;case ACTION_SET_NAME:SendMessageComposer(new FurnitureMannequinSaveNameComposer(objectId,name));return;}setMode(MODE_NONE);},[objectId,name]);const handleKeyDown=event=>{if(event.key!=='Enter')return;processAction(ACTION_SET_NAME);};useEffect(()=>{switch(mode){case MODE_CONTROLLER:case MODE_WRONG_GENDER:{const figureContainer=GetAvatarRenderManager().createFigureContainer(figure);transformAsMannequinFigure(figureContainer);setRenderedFigure(figureContainer.getFigureString());setRenderedClubLevel(clubLevel);break;}case MODE_UPDATE:{const figureContainer=GetAvatarRenderManager().createFigureContainer(GetSessionDataManager().figure);transformAsMannequinFigure(figureContainer);setRenderedFigure(figureContainer.getFigureString());setRenderedClubLevel(GetAvatarRenderManager().getFigureClubLevel(figureContainer,GetSessionDataManager().gender,MANNEQUIN_CLOTHING_PART_TYPES));break;}case MODE_PEER:case MODE_NO_CLUB:{const figureContainer=getMergedFigureContainer(GetSessionDataManager().figure,figure);setRenderedFigure(figureContainer.getFigureString());setRenderedClubLevel(clubLevel);break;}}},[mode,figure,clubLevel]);if(mode===MODE_NONE)return null;return/*#__PURE__*/_jsxs(NitroCardView,{className:\"nitro-mannequin\",theme:\"primary\",children:[/*#__PURE__*/_jsx(NitroCardHeaderView,{headerText:LocalizeText('mannequin.widget.title'),onCloseClick:event=>setMode(MODE_NONE)}),/*#__PURE__*/_jsx(NitroCardContentView,{center:true,children:/*#__PURE__*/_jsxs(Flex,{gap:2,overflow:\"hidden\",children:[/*#__PURE__*/_jsx(Column,{children:/*#__PURE__*/_jsxs(Base,{position:\"relative\",className:\"mannequin-preview\",children:[/*#__PURE__*/_jsx(LayoutAvatarImageView,{figure:renderedFigure,direction:2}),clubLevel>0&&/*#__PURE__*/_jsx(LayoutCurrencyIcon,{className:\"position-absolute end-2 bottom-2\",type:\"hc\"})]})}),/*#__PURE__*/_jsxs(Column,{justifyContent:\"between\",overflow:\"auto\",children:[mode===MODE_CONTROLLER&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",value:name,onChange:event=>setName(event.target.value),onKeyDown:event=>handleKeyDown(event)}),/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:event=>setMode(MODE_UPDATE),children:LocalizeText('mannequin.widget.style')}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:event=>processAction(ACTION_WEAR),children:LocalizeText('mannequin.widget.wear')})]})]}),mode===MODE_UPDATE&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:name}),/*#__PURE__*/_jsx(Text,{wrap:true,children:LocalizeText('mannequin.widget.savetext')})]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"between\",children:[/*#__PURE__*/_jsx(Text,{underline:true,pointer:true,onClick:event=>setMode(MODE_CONTROLLER),children:LocalizeText('mannequin.widget.back')}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:event=>processAction(ACTION_SAVE),children:LocalizeText('mannequin.widget.save')})]})]}),mode===MODE_PEER&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Column,{gap:1,children:[/*#__PURE__*/_jsx(Text,{bold:true,children:name}),/*#__PURE__*/_jsx(Text,{children:LocalizeText('mannequin.widget.weartext')})]}),/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:event=>processAction(ACTION_WEAR),children:LocalizeText('mannequin.widget.wear')})]}),mode===MODE_NO_CLUB&&/*#__PURE__*/_jsx(Text,{children:LocalizeText('mannequin.widget.clubnotification')}),mode===MODE_WRONG_GENDER&&/*#__PURE__*/_jsx(Text,{children:LocalizeText('mannequin.widget.wronggender')})]})]})})]});};","map":null,"metadata":{},"sourceType":"module"}