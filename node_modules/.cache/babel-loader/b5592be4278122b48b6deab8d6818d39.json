{"ast":null,"code":"import{GetClubOffersMessageComposer,PurchaseFromCatalogComposer}from'@nitrots/nitro-renderer';import{useCallback,useEffect,useMemo,useState}from'react';import{CatalogPurchaseState,LocalizeText,SendMessageComposer}from'../../../../../api';import{AutoGrid,Button,Column,Flex,LayoutCurrencyIcon,LayoutGridItem,LayoutLoadingSpinnerView,Text}from'../../../../../common';import{CatalogPurchasedEvent,CatalogPurchaseFailureEvent}from'../../../../../events';import{useCatalog,usePurse,UseUiEvent}from'../../../../../hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const CatalogLayoutVipBuyView=props=>{const[pendingOffer,setPendingOffer]=useState(null);const[purchaseState,setPurchaseState]=useState(CatalogPurchaseState.NONE);const{currentPage=null,catalogOptions=null}=useCatalog();const{purse=null,getCurrencyAmount=null}=usePurse();const{clubOffers=null}=catalogOptions;const onCatalogEvent=useCallback(event=>{switch(event.type){case CatalogPurchasedEvent.PURCHASE_SUCCESS:setPurchaseState(CatalogPurchaseState.NONE);return;case CatalogPurchaseFailureEvent.PURCHASE_FAILED:setPurchaseState(CatalogPurchaseState.FAILED);return;}},[]);UseUiEvent(CatalogPurchasedEvent.PURCHASE_SUCCESS,onCatalogEvent);UseUiEvent(CatalogPurchaseFailureEvent.PURCHASE_FAILED,onCatalogEvent);const getOfferText=useCallback(offer=>{let offerText='';if(offer.months>0){offerText=LocalizeText('catalog.vip.item.header.months',['num_months'],[offer.months.toString()]);}if(offer.extraDays>0){if(offerText!=='')offerText+=' ';offerText+=' '+LocalizeText('catalog.vip.item.header.days',['num_days'],[offer.extraDays.toString()]);}return offerText;},[]);const getPurchaseHeader=useCallback(()=>{if(!purse)return'';const extensionOrSubscription=purse.clubDays>0||purse.clubPeriods>0?'extension.':'subscription.';const daysOrMonths=pendingOffer.months===0?'days':'months';const daysOrMonthsText=pendingOffer.months===0?pendingOffer.extraDays:pendingOffer.months;const locale=LocalizeText('catalog.vip.buy.confirm.'+extensionOrSubscription+daysOrMonths);return locale.replace('%NUM_'+daysOrMonths.toUpperCase()+'%',daysOrMonthsText.toString());},[pendingOffer,purse]);const getPurchaseValidUntil=useCallback(()=>{let locale=LocalizeText('catalog.vip.buy.confirm.end_date');locale=locale.replace('%month%',pendingOffer.month.toString());locale=locale.replace('%day%',pendingOffer.day.toString());locale=locale.replace('%year%',pendingOffer.year.toString());return locale;},[pendingOffer]);const getSubscriptionDetails=useMemo(()=>{const clubDays=purse.clubDays;const clubPeriods=purse.clubPeriods;const totalDays=clubPeriods*31+clubDays;return LocalizeText('catalog.vip.extend.info',['days'],[totalDays.toString()]);},[purse]);const purchaseSubscription=useCallback(()=>{if(!pendingOffer)return;setPurchaseState(CatalogPurchaseState.PURCHASE);SendMessageComposer(new PurchaseFromCatalogComposer(currentPage.pageId,pendingOffer.offerId,null,1));},[pendingOffer,currentPage]);const setOffer=useCallback(offer=>{setPurchaseState(CatalogPurchaseState.NONE);setPendingOffer(offer);},[]);const getPurchaseButton=useCallback(()=>{if(!pendingOffer)return null;if(pendingOffer.priceCredits>getCurrencyAmount(-1)){return/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"danger\",children:LocalizeText('catalog.alert.notenough.title')});}if(pendingOffer.priceActivityPoints>getCurrencyAmount(pendingOffer.priceActivityPointsType)){return/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"danger\",children:LocalizeText('catalog.alert.notenough.activitypoints.title.'+pendingOffer.priceActivityPointsType)});}switch(purchaseState){case CatalogPurchaseState.CONFIRM:return/*#__PURE__*/_jsx(Button,{variant:\"warning\",onClick:purchaseSubscription,children:LocalizeText('catalog.marketplace.confirm_title')});case CatalogPurchaseState.PURCHASE:return/*#__PURE__*/_jsx(Button,{variant:\"primary\",disabled:true,children:/*#__PURE__*/_jsx(LayoutLoadingSpinnerView,{})});case CatalogPurchaseState.FAILED:return/*#__PURE__*/_jsx(Button,{variant:\"danger\",disabled:true,children:LocalizeText('generic.failed')});case CatalogPurchaseState.NONE:default:return/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:()=>setPurchaseState(CatalogPurchaseState.CONFIRM),children:LocalizeText('buy')});}},[pendingOffer,purchaseState,purchaseSubscription,getCurrencyAmount]);useEffect(()=>{if(!clubOffers)SendMessageComposer(new GetClubOffersMessageComposer(1));},[clubOffers]);return/*#__PURE__*/_jsxs(Column,{fullHeight:true,children:[/*#__PURE__*/_jsxs(Flex,{fullHeight:true,center:true,overflow:\"hidden\",children:[currentPage.localization.getImage(1)&&/*#__PURE__*/_jsx(\"img\",{alt:\"\",src:currentPage.localization.getImage(1)}),/*#__PURE__*/_jsxs(Column,{className:\"px-2\",children:[/*#__PURE__*/_jsx(Text,{bold:true,children:LocalizeText('catalog.vip.extend.title')}),/*#__PURE__*/_jsx(Text,{small:true,overflow:\"auto\",dangerouslySetInnerHTML:{__html:getSubscriptionDetails}})]})]}),/*#__PURE__*/_jsxs(Column,{fullHeight:true,size:7,overflow:\"hidden\",justifyContent:\"between\",children:[/*#__PURE__*/_jsx(AutoGrid,{columnCount:1,className:\"nitro-catalog-layout-vip-buy-grid\",children:clubOffers&&clubOffers.length>0&&clubOffers.map((offer,index)=>{return/*#__PURE__*/_jsxs(LayoutGridItem,{column:false,center:false,alignItems:\"center\",justifyContent:\"between\",itemActive:pendingOffer===offer,className:\"p-1\",onClick:()=>setOffer(offer),children:[/*#__PURE__*/_jsx(\"i\",{className:\"icon-hc-banner\"}),/*#__PURE__*/_jsxs(Column,{justifyContent:\"end\",gap:0,children:[/*#__PURE__*/_jsx(Text,{textEnd:true,children:getOfferText(offer)}),/*#__PURE__*/_jsxs(Flex,{justifyContent:\"end\",gap:1,children:[offer.priceCredits>0&&/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"end\",gap:1,children:[/*#__PURE__*/_jsx(Text,{children:offer.priceCredits}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:-1})]}),offer.priceActivityPoints>0&&/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"end\",gap:1,children:[/*#__PURE__*/_jsx(Text,{children:offer.priceActivityPoints}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:offer.priceActivityPointsType})]})]})]})]},index);})}),/*#__PURE__*/_jsx(Column,{size:5,overflow:\"hidden\",children:pendingOffer&&/*#__PURE__*/_jsx(Column,{fullWidth:true,grow:true,justifyContent:\"end\",children:/*#__PURE__*/_jsxs(Flex,{alignItems:\"end\",children:[/*#__PURE__*/_jsxs(Column,{grow:true,gap:0,children:[/*#__PURE__*/_jsx(Text,{fontWeight:\"bold\",children:getPurchaseHeader()}),/*#__PURE__*/_jsxs(Flex,{gap:1,children:[pendingOffer.priceCredits>0&&/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"end\",gap:1,children:[/*#__PURE__*/_jsx(Text,{children:pendingOffer.priceCredits}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:-1})]}),pendingOffer.priceActivityPoints>0&&/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"end\",gap:1,children:[/*#__PURE__*/_jsx(Text,{children:pendingOffer.priceActivityPoints}),/*#__PURE__*/_jsx(LayoutCurrencyIcon,{type:pendingOffer.priceActivityPointsType})]})]})]}),getPurchaseButton()]})})}),/*#__PURE__*/_jsx(Text,{small:true,center:true,className:\"pb-2\",dangerouslySetInnerHTML:{__html:LocalizeText('catalog.vip.buy.hccenter')}})]})]});};","map":null,"metadata":{},"sourceType":"module"}